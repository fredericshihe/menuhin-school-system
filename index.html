<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>é’å²›æ¢…çº½å› éŸ³ä¹å­¦æ ¡ç»ƒç´è·Ÿè¸ªç³»ç»Ÿ</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="format-detection" content="telephone=no">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
/* ===============================================
   é’å²›æ¢…çº½å› éŸ³ä¹å­¦æ ¡ç»ƒç´è·Ÿè¸ªç³»ç»Ÿ - å®Œæ•´æ ·å¼æ–‡ä»¶
   =============================================== */

/* ===== 1. CSSå˜é‡å®šä¹‰ ===== */
:root {
    /* ä¸»è‰²è°ƒ */
    --primary-color: #3498db;
    --secondary-color: #2ecc71;
    --warning-color: #f39c12;
    --danger-color: #e74c3c;
    --success-color: #27ae60;
    
    /* èƒŒæ™¯å’Œæ–‡æœ¬ */
    --background-color: #f8f9fa;
    --card-bg: #ffffff;
    --card-hover-bg: #f8f9fa;
    --text-color: #2c3e50;
    --text-secondary: #6c757d;
    --text-muted: #adb5bd;
    --border-color: #dee2e6;
    --light-gray: #f1f3f4;
    --medium-gray: #6c757d;
    --dark-gray: #495057;
    --shadow-color: rgba(0,0,0,0.1);
    
    /* é˜´å½±å’Œåœ†è§’ */
    --shadow: 0 2px 10px rgba(0,0,0,0.1);
    --shadow-hover: 0 5px 20px rgba(0,0,0,0.15);
    --radius: 12px;
    --radius-small: 6px;
    --radius-large: 20px;
    
    /* ç§»åŠ¨ç«¯é€‚é… */
    --mobile-padding: 15px;
    --mobile-font-size: 16px;
    --touch-target-size: 44px;
    
    /* æ¸å˜è‰² */
    --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    --gradient-card: linear-gradient(135deg, #f8f9fa, #ffffff);
}


/* ===== 2. åŸºç¡€é‡ç½®å’Œå…¨å±€æ ·å¼ ===== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    background: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    overflow-x: hidden;
}

/* ===== 3. å®¹å™¨å’Œå¸ƒå±€ ===== */
/* ç¡®ä¿ä¸¤ä¸ª metric-item å®¹å™¨å¤§å°ä¸€è‡´ */
.status-metrics .metric-item {
    flex: 1;
    min-width: 0;
}

/* æˆ–è€…ç»™ç»ƒç´çŠ¶æ€å®¹å™¨æ·»åŠ ç›¸åŒçš„æ ·å¼ç±» */
.metric-item.practice-status-container {
    /* ä¸æ—¶é—´æ®µå®¹å™¨ç›¸åŒçš„æ ·å¼ */
}

.container {
    width: 100%;
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    padding-bottom: env(safe-area-inset-bottom);
    box-sizing: border-box;
}

/* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿å®æ—¶ç»ƒç´çŠ¶æ€åŒºåŸŸæ²¡æœ‰é¢å¤–çš„å†…è¾¹è· */
.container .card {
    margin-left: 0;
    margin-right: 0;
}

/* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿å­¦ç”Ÿç½‘æ ¼ä»æœ€å·¦ä¾§å¼€å§‹ */
.student-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: clamp(12px, 2vw, 20px);
    width: 100%;
    padding: 0;
    margin: 0; /* ç¡®ä¿æ²¡æœ‰å¤–è¾¹è· */
    padding-left: 0 !important; /* å¼ºåˆ¶å»é™¤å·¦å†…è¾¹è· */
}



/* å“åº”å¼å®¹å™¨ */
@media (min-width: 1500px) {
    .container {
        max-width: none;
        padding: 20px 40px;
    }
}

@media (min-width: 1800px) {
    .container {
        padding: 20px 60px;
    }
}

@media (max-width: 768px) {
    .container {
        padding: 15px;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 10px;
    }
}
/* ===== ç»ƒç´çŠ¶æ€ç´§å‡‘å¸ƒå±€æ ·å¼ - å››è¡Œæ˜¾ç¤º ===== */
/* ===== ç¡®ä¿æ—¶é—´æ®µå’Œç»ƒç´çŠ¶æ€å®¹å™¨å¤§å°å®Œå…¨ä¸€è‡´ ===== */
.status-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    align-items: stretch; /* ğŸ”¥ æ”¹ä¸º stretchï¼Œè®©æ‰€æœ‰é¡¹ç›®é«˜åº¦ä¸€è‡´ */
}

.metric-item {
    display: flex;
    align-items: flex-start; /* ğŸ”¥ é¡¶éƒ¨å¯¹é½ */
    gap: 12px;
    padding: 16px;
    background: var(--light-gray);
    border-radius: var(--radius);
    transition: transform 0.2s ease;
    height: 100%; /* ğŸ”¥ æ–°å¢ï¼šå æ»¡å®¹å™¨é«˜åº¦ */
    box-sizing: border-box; /* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿paddingè®¡ç®—æ­£ç¡® */
}

.metric-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    height: 100%; /* ğŸ”¥ æ–°å¢ï¼šå æ»¡çˆ¶å®¹å™¨é«˜åº¦ */
}

.metric-label {
    font-size: 0.85rem;
    opacity: 0.8;
    margin-bottom: 6px;
    color: var(--medium-gray);
    flex-shrink: 0; /* ğŸ”¥ æ–°å¢ï¼šæ ‡ç­¾ä¸æ”¶ç¼© */
}

.metric-value {
    flex: 1; /* ğŸ”¥ æ–°å¢ï¼šå†…å®¹åŒºåŸŸå æ»¡å‰©ä½™ç©ºé—´ */
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* ğŸ”¥ æ–°å¢ï¼šå†…å®¹ä»é¡¶éƒ¨å¼€å§‹ */
}

/* ===== ç»ƒç´çŠ¶æ€ç´§å‡‘å¸ƒå±€æ ·å¼ä¼˜åŒ– ===== */
.metric-value.practice-status-compact {
    line-height: 1.4; /* ğŸ”¥ ä» 1.3 å¢åŠ åˆ° 1.4 */
    font-size: 15px; /* ğŸ”¥ ä» 14px å¢åŠ åˆ° 15px */
    min-height: 95px; /* ğŸ”¥ ä» 80px å¢åŠ åˆ° 95pxï¼Œå®¹çº³æ›´å¤§é—´è· */
    padding: 4px 0; /* ğŸ”¥ æ–°å¢ï¼šä¸Šä¸‹å†…è¾¹è· */
}

.practice-info-row {
    display: flex;
    align-items: center;
    margin-bottom: 8px; /* ğŸ”¥ ä» 4px å¢åŠ åˆ° 8pxï¼Œæ›´å®½çš„è¡Œé—´è· */
    min-height: 22px; /* ğŸ”¥ ä» 18px å¢åŠ åˆ° 22pxï¼Œæ›´é«˜çš„è¡Œé«˜ */
    justify-content: flex-start;
    padding: 2px 0; /* ğŸ”¥ æ–°å¢ï¼šæ¯è¡Œä¸Šä¸‹å†…è¾¹è· */
}

.practice-info-row:last-child {
    margin-bottom: 0;
}

.practice-info-item {
    display: flex;
    align-items: center;
    gap: 6px; /* ğŸ”¥ ä» 4px å¢åŠ åˆ° 6px */
}

.practice-label {
    color: #666;
    font-size: 13px; /* ğŸ”¥ ä» 12px å¢åŠ åˆ° 13px */
    font-weight: 500; /* ğŸ”¥ ä» 400 å¢åŠ åˆ° 500ï¼Œæ›´æ¸…æ™° */
    white-space: nowrap;
    min-width: 60px; /* ğŸ”¥ ä» 55px å¢åŠ åˆ° 60px */
}

.practice-value {
    font-weight: 600;
    font-size: 14px; /* ğŸ”¥ ä» 13px å¢åŠ åˆ° 14px */
    color: var(--text-color);
}

.practice-value.current-practice {
    color: #2196F3;
    font-size: 14px; /* ğŸ”¥ ä¿æŒä¸å…¶ä»–å€¼ä¸€è‡´ */
}

.practice-value.total-practice {
    color: var(--primary-color);
    font-size: 15px; /* ğŸ”¥ ä» 13px å¢åŠ åˆ° 15pxï¼Œçªå‡ºæ˜¾ç¤º */
    font-weight: 700; /* ğŸ”¥ å¢åŠ å­—é‡ï¼Œæ›´çªå‡º */
}

/* ===== æ—¶é—´æ®µå®¹å™¨å¯¹é½ä¼˜åŒ– ===== */
.time-slots-container .metric-value {
    margin-top: 0;
    line-height: 1.4; /* ğŸ”¥ ä» 1.3 å¢åŠ åˆ° 1.4 */
    min-height: 95px; /* ğŸ”¥ ä» 80px å¢åŠ åˆ° 95pxï¼Œä¸ç»ƒç´çŠ¶æ€å®¹å™¨ä¿æŒä¸€è‡´ */
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    padding: 4px 0; /* ğŸ”¥ æ–°å¢ï¼šä¸ç»ƒç´çŠ¶æ€ä¿æŒä¸€è‡´çš„å†…è¾¹è· */
}

.time-slots-wrapper {
    display: flex;
    flex-wrap: wrap;
    align-items: flex-start;
    gap: 4px; /* ğŸ”¥ ä» 0 å¢åŠ åˆ° 4pxï¼Œå¢åŠ æ—¶é—´æ®µæ ‡ç­¾é—´è· */
    margin-top: 4px; /* ğŸ”¥ ä» 2px å¢åŠ åˆ° 4px */
    flex: 1;
}

/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
    .status-metrics {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .metric-value.practice-status-compact {
        min-height: 85px; /* ğŸ”¥ ä» 70px å¢åŠ åˆ° 85px */
        font-size: 14px; /* ğŸ”¥ ä¿æŒè¾ƒå¤§å­—ä½“ */
        padding: 3px 0;
    }
    
    .time-slots-container .metric-value {
        min-height: 85px; /* ğŸ”¥ ä» 70px å¢åŠ åˆ° 85px */
        padding: 3px 0;
    }
    
    .practice-info-row {
        margin-bottom: 6px; /* ğŸ”¥ ä» 3px å¢åŠ åˆ° 6px */
        min-height: 20px; /* ğŸ”¥ ä» 16px å¢åŠ åˆ° 20px */
        padding: 1px 0;
    }
    
    .practice-label {
        font-size: 12px; /* ğŸ”¥ ä» 11px å¢åŠ åˆ° 12px */
        min-width: 55px; /* ğŸ”¥ ä» 50px å¢åŠ åˆ° 55px */
        font-weight: 500;
    }
    
    .practice-value {
        font-size: 13px; /* ğŸ”¥ ä» 12px å¢åŠ åˆ° 13px */
    }
    
    .practice-value.total-practice {
        font-size: 14px; /* ğŸ”¥ ä» 12px å¢åŠ åˆ° 14px */
        font-weight: 700;
    }
    
    .metric-item {
        padding: 12px;
    }
    
    .metric-label {
        margin-bottom: 4px;
    }
    
    .time-slots-wrapper {
        gap: 3px; /* ğŸ”¥ ç§»åŠ¨ç«¯æ—¶é—´æ®µé—´è· */
        margin-top: 3px;
    }
}

@media (max-width: 480px) {
    .metric-value.practice-status-compact {
        min-height: 75px; /* ğŸ”¥ ä» 60px å¢åŠ åˆ° 75px */
        font-size: 13px; /* ğŸ”¥ ä¿æŒå¯è¯»æ€§ */
        padding: 2px 0;
    }
    
    .time-slots-container .metric-value {
        min-height: 75px; /* ğŸ”¥ ä» 60px å¢åŠ åˆ° 75px */
        padding: 2px 0;
    }
    
    .practice-info-row {
        margin-bottom: 5px; /* ğŸ”¥ ä» 2px å¢åŠ åˆ° 5px */
        min-height: 18px; /* ğŸ”¥ ä» 14px å¢åŠ åˆ° 18px */
    }
    
    .practice-label {
        font-size: 11px; /* ğŸ”¥ ä» 10px å¢åŠ åˆ° 11px */
        min-width: 50px; /* ğŸ”¥ ä» 45px å¢åŠ åˆ° 50px */
        font-weight: 500;
    }
    
    .practice-value {
        font-size: 12px; /* ğŸ”¥ ä» 11px å¢åŠ åˆ° 12px */
    }
    
    .practice-value.total-practice {
        font-size: 13px; /* ğŸ”¥ ä» 11px å¢åŠ åˆ° 13px */
        font-weight: 700;
    }
    
    .metric-item {
        padding: 10px;
    }
    
    .time-slots-wrapper {
        gap: 2px;
        margin-top: 2px;
    }
}

/* æ·±è‰²æ¨¡å¼é€‚é… */
@media (prefers-color-scheme: dark) {
    .practice-label {
        color: var(--medium-gray);
        font-weight: 500; /* ğŸ”¥ ç¡®ä¿æ·±è‰²æ¨¡å¼ä¸‹ä¹Ÿæœ‰è¶³å¤Ÿå­—é‡ */
    }
    
    .practice-value {
        color: var(--text-color);
    }
    
    .practice-value.current-practice {
        color: #58a6ff;
    }
    
    .practice-value.total-practice {
        color: var(--primary-color);
        font-weight: 700; /* ğŸ”¥ ç¡®ä¿æ·±è‰²æ¨¡å¼ä¸‹ä¹Ÿä¿æŒç²—ä½“ */
    }
}

/* ğŸ”¥ æ–°å¢ï¼šä¸ºäº†æ›´å¥½çš„è§†è§‰æ•ˆæœï¼Œå¯ä»¥æ·»åŠ ä¸€äº›å¾®å¦™çš„æ ·å¼ */
.practice-info-row {
    transition: all 0.2s ease; /* ğŸ”¥ å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
}

.practice-info-row:hover {
    transform: translateX(2px); /* ğŸ”¥ æ‚¬åœæ—¶è½»å¾®ç§»åŠ¨ */
}

.practice-value.total-practice {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); /* ğŸ”¥ æ–‡å­—é˜´å½±ï¼Œå¢å¼ºå¯è¯»æ€§ */
}

/* ğŸ”¥ ä¸ºå½“å‰ç»ƒä¹ æ—¶é•¿æ·»åŠ ä¸€äº›è§†è§‰å¼ºè°ƒ */
.practice-value.current-practice {
    position: relative;
}

.practice-value.current-practice::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #2196F3, rgba(33, 150, 243, 0.3));
    border-radius: 1px;
    animation: pulse-underline 2s infinite;
}

@keyframes pulse-underline {
    0%, 100% {
        opacity: 0.6;
        transform: scaleX(1);
    }
    50% {
        opacity: 1;
        transform: scaleX(1.05);
    }
}

/* ===== 4. è¯­è¨€åˆ‡æ¢å™¨ ===== */
.language-switcher {
    position: fixed;
    bottom: max(20px, env(safe-area-inset-bottom) + 10px);
    left: 20px;
    z-index: 1001;
    display: flex;
    background: white;
    border-radius: var(--radius-large);
    box-shadow: var(--shadow);
    overflow: hidden;
}

.lang-btn {
    padding: 8px 12px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.3s ease;
    min-width: 40px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.lang-btn.active {
    background: var(--primary-color);
    color: white;
}

.lang-btn:hover:not(.active) {
    background: rgba(52, 152, 219, 0.1);
}

/* ç§»åŠ¨ç«¯è¯­è¨€åˆ‡æ¢å™¨ */
@media (max-width: 768px) {
    .language-switcher {
        bottom: max(10px, env(safe-area-inset-bottom) + 5px);
        left: 10px;
        border-radius: 16px;
    }
    
    .lang-btn {
        padding: 6px 10px;
        font-size: 12px;
        min-width: 35px;
        height: 28px;
    }
}

/* ===== 5. å¤´éƒ¨æ ·å¼ ===== */
.header {
    background: var(--gradient-primary);
    color: white;
    padding: max(30px, env(safe-area-inset-top) + 20px) 20px 30px 20px;
    margin-bottom: 30px;
    border-radius: var(--radius);
    text-align: center;
    box-shadow: var(--shadow);
}

.header h1 {
    font-size: clamp(1.8rem, 4vw, 2.5rem);
    margin-bottom: 10px;
    font-weight: 300;
    line-height: 1.2;
}

.header .subtitle {
    font-size: clamp(1rem, 2.5vw, 1.2rem);
    opacity: 0.9;
    line-height: 1.3;
}

@media (max-width: 768px) {
    .header {
        padding: max(25px, env(safe-area-inset-top) + 15px) 15px 25px 15px;
        margin-bottom: 20px;
    }
}

/* ===== 6. è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ ===== */
.connection-status {
    position: fixed;
    top: max(20px, env(safe-area-inset-top) + 10px);
    right: 20px;
    padding: 8px 12px;
    border-radius: var(--radius-large);
    font-size: 13px;
    font-weight: 600;
    z-index: 1000;
    transition: all 0.3s ease;
    cursor: pointer;
    min-height: var(--touch-target-size);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.connection-status::before {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--danger-color);
}

.connection-status.online::before {
    background: var(--success-color);
}

.connection-status.syncing::before {
    background: var(--warning-color);
    animation: pulse 1.5s infinite;
}

.connection-status.online {
    background: white;
    color: var(--success-color);
    border: 1px solid var(--success-color);
}

.connection-status.offline {
    background: white;
    color: var(--danger-color);
    border: 1px solid var(--danger-color);
}

.connection-status.syncing {
    background: white;
    color: var(--warning-color);
    border: 1px solid var(--warning-color);
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

@media (max-width: 768px) {
    .connection-status {
        top: max(15px, env(safe-area-inset-top) + 5px);
        right: 15px;
        padding: 6px 10px;
        font-size: 12px;
        min-height: 36px;
    }
}

/* ===== 7. ä¸»å¯¼èˆªæ ‡ç­¾ ===== */
.nav-tabs {
    display: flex;
    background: white;
    border-radius: var(--radius);
    padding: 5px;
    margin-bottom: 30px;
    box-shadow: var(--shadow);
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.nav-tabs::-webkit-scrollbar {
    display: none;
}

.nav-tab {
    flex: 1;
    padding: 12px 16px;
    text-align: center;
    background: transparent;
    border: none;
    border-radius: calc(var(--radius) - 5px);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: clamp(14px, 3vw, 16px);
    font-weight: 500;
    white-space: nowrap;
    min-width: 120px;
    min-height: var(--touch-target-size);
    display: flex;
    align-items: center;
    justify-content: center;
    -webkit-tap-highlight-color: transparent;
}

.nav-tab:hover {
    background: rgba(52, 152, 219, 0.1);
}

.nav-tab.active {
    background: var(--primary-color);
    color: white;
}

@media (max-width: 768px) {
    .nav-tabs {
        margin-bottom: 20px;
        padding: 3px;
    }
    
    .nav-tab {
        padding: 10px 12px;
        font-size: 14px;
        min-width: 100px;
        min-height: 40px;
    }
}

/* ===== 8. å¡ç‰‡å®¹å™¨åŸºç¡€æ ·å¼ ===== */
.card {
    background: white;
    border-radius: var(--radius);
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: var(--shadow);
    border-left: 4px solid var(--primary-color);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

.card.success {
    border-left-color: var(--success-color);
}

.card.warning {
    border-left-color: var(--warning-color);
}

.card.danger {
    border-left-color: var(--danger-color);
}

@media (max-width: 768px) {
    .card {
        padding: 20px 15px;
        margin-bottom: 20px;
    }
}

/* ===== 9. ç»Ÿè®¡é¢æ¿ ===== */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
    gap: 15px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 25px;
    border-radius: var(--radius);
    text-align: center;
    box-shadow: var(--shadow);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-hover);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.stat-card:hover::before {
    left: 100%;
}

.stat-number {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 10px;
    line-height: 1;
}

.stat-label {
    font-size: 1.1rem;
    color: var(--medium-gray);
    margin-bottom: 5px;
    font-weight: 600;
}

.stat-description {
    font-size: 0.9rem;
    color: #999;
    line-height: 1.3;
}

/* ç»Ÿè®¡å¡ç‰‡é¢œè‰²ä¸»é¢˜ */
.stat-card.present .stat-number { color: var(--success-color); }
.stat-card.absent .stat-number { color: var(--danger-color); }
.stat-card.excused .stat-number { color: var(--warning-color); }
.stat-card.total .stat-number { color: var(--primary-color); }
.stat-card.unscheduled .stat-number { color: #9b59b6; }
.stat-card.weekend .stat-number { color: #95a5a6; }

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 20px;
    }
    
    .stat-card {
        padding: 20px 15px;
    }
    
    .stat-number {
        font-size: 2.2rem;
    }
    
    .stat-label {
        font-size: 1rem;
    }
    
    .stat-description {
        font-size: 0.8rem;
    }
}

@media (max-width: 480px) {
    .stats-grid {
        gap: 8px;
    }
    
    .stat-card {
        padding: 15px 10px;
    }
    
    .stat-number {
        font-size: 1.8rem;
    }
    
    .stat-label {
        font-size: 0.9rem;
    }
}

/* ===== 10. å­¦ç”Ÿç½‘æ ¼å¸ƒå±€ç³»ç»Ÿ ===== */
.student-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: clamp(12px, 2vw, 20px);
    width: 100%;
    padding: 0;
}

/* é™åˆ¶æœ€å¤§åˆ—æ•°ä¸º4åˆ— */
@media (min-width: 1400px) {
    .student-grid {
        grid-template-columns: repeat(4, 1fr);
        max-width: 1200px;
        margin: 0 auto;
        gap: 24px;
    }
}

/* ä¸åŒå±å¹•å®½åº¦çš„å“åº”å¼è®¾ç½® */
@media (max-width: 1399px) and (min-width: 1100px) {
    .student-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
    }
}

@media (max-width: 1099px) and (min-width: 800px) {
    .student-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
    }
}

@media (max-width: 799px) {
    .student-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }
}

/* å°å±å¹•ä¼˜åŒ– */
@media (max-width: 599px) {
    .student-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }
}

@media (max-width: 360px) {
    .student-grid {
        gap: 8px;
    }
}

/* å¤§å±å¹•ä¼˜åŒ– */
@media (min-width: 1600px) {
    .student-grid {
        grid-template-columns: repeat(4, 1fr);
        max-width: 1200px;
        gap: 24px;
    }
}


/* ===== 11. å­¦ç”Ÿå¡ç‰‡å’Œç»ƒç´çŠ¶æ€å¡ç‰‡ ===== */
.student-card,
.practice-status-card {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
    transition: all 0.3s ease;
    border-left: 4px solid var(--border-color);
    cursor: pointer;
    width: 100%;
    max-width: 100%;
    position: relative;
    display: flex;
    flex-direction: column;
    height: auto;
    min-height: 280px;
    box-sizing: border-box;
    justify-self: stretch;
    align-self: stretch;
    color: var(--text-color);
}

.student-card:hover,
.practice-status-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-hover);
    background: var(--card-hover-bg);
}

.practice-status-card.compact {
    min-height: 120px;
    padding: 10px 12px;
    margin-bottom: 8px;
}
/* å¾…è€ƒå‹¤çŠ¶æ€æ ·å¼ */
.student-status.pending,
.student-status-compact.pending,
.table-status-badge.pending,
.status-badge.pending {
    background: #e9ecef;
    color: #6c757d;
    border-color: #dee2e6;
}

.practice-status-card.pending,
.student-card.pending {
    border-left-color: #6c757d;
}

/* å¾…è€ƒå‹¤çŠ¶æ€çš„å¡ç‰‡ */
.practice-status-card.pending,
.student-card.pending {
    background: var(--card-bg);
    border-left-color: var(--medium-gray);
}


.compact-content {
    display: flex;
    flex-direction: column;
    gap: 4px;                     /* ä»6pxæ”¹ä¸º4px */
    flex: 1;
}


.student-name-compact {
    font-size: 1.2rem;              /* ğŸ”¥ ä»1remå¢åŠ åˆ°1.2rem */
    font-weight: 600;
    color: var(--text-color);
    margin-bottom: 2px;
}



.student-info-row {
    display: flex;
    align-items: center;
    gap: 6px;                     /* ä»8pxæ”¹ä¸º6px */
    font-size: 0.75rem;           /* ä»0.8remæ”¹ä¸º0.75rem */
    color: var(--medium-gray);
    flex-wrap: wrap;
}


.info-item {
    display: flex;
    align-items: center;
    gap: 2px;
}

.info-divider {
    opacity: 0.6;
    margin: 0 2px;
}

.status-duration-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
    gap: 10px;
}

.practice-duration-large {
    font-size: 1rem;              /* ä»1.1remæ”¹ä¸º1rem */
    font-weight: 600;
    color: var(--primary-color);
    background: rgba(52, 152, 219, 0.1);
    padding: 3px 6px;             /* ä»4px 8pxæ”¹ä¸º3px 6px */
    border-radius: var(--radius-small);
}



/* ç§»åŠ¨ç«¯å¡ç‰‡ä¼˜åŒ– */
@media (max-width: 768px) {
    .student-card,
    .practice-status-card {
        min-height: 140px;
        padding: 12px;
        margin-bottom: 12px;
    }
    
    .practice-status-card.compact {
        min-height: 120px;
        padding: 10px;
    }
    
    .student-name-compact {
        font-size: 1rem;
    }
    
    .student-info-row {
        font-size: 0.75rem;
        gap: 6px;
    }
    
    .practice-duration-large {
        font-size: 1rem;
        padding: 3px 6px;
    }
}

@media (max-width: 480px) {
    .student-card,
    .practice-status-card {
        min-height: 120px;
        padding: 8px;
    }
    
    .practice-status-card.compact {
        min-height: 100px;
        padding: 8px;
    }
    
    .student-name-compact {
        font-size: 0.95rem;
    }
    
    .student-info-row {
        font-size: 0.7rem;
        gap: 4px;
    }
    
    .practice-duration-large {
        font-size: 0.9rem;
        padding: 2px 4px;
    }
}

/* ===== 12. å¡ç‰‡è¾¹æ¡†é¢œè‰² ===== */
.practice-status-card { 
    border-left-color: #9b59b6; 
    background: white;
}

.student-card.weekend,
.practice-status-card.weekend { 
    border-left-color: #95a5a6; 
    background: var(--gradient-card);
}

.practice-status-card.present,
.student-card.present { 
    border-left-color: var(--success-color); 
}

.practice-status-card.absent,
.student-card.absent { 
    border-left-color: var(--danger-color); 
}

.practice-status-card.excused,
.student-card.excused { 
    border-left-color: var(--warning-color); 
}

.practice-status-card.low-efficiency,
.student-card.low-efficiency { 
    border-left-color: #f39c12; 
}

.practice-status-card.practicing-unscheduled,
.student-card.practicing-unscheduled { 
    border-left-color: #9b59b6; 
}

/* ===== 13. å¡ç‰‡å†…å®¹æ ·å¼ ===== */
.student-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.student-name {
    font-size: 1.5rem;              /* ğŸ”¥ ä»1.3remå¢åŠ åˆ°1.5rem */
    font-weight: 600;
    color: var(--text-color);
    line-height: 1.2;
}



.student-details,
.practice-details {
    width: 100%;
    margin-bottom: 15px;
}

/* åœ¨æ›´å¤§å±å¹•ä¸Šä½¿ç”¨ä¸¤åˆ—ï¼Œä½†å­¦ç”ŸåŒºåŸŸä»ç„¶å…¨å®½ */
@media (min-width: 1200px) {
    .student-details,
    .practice-details {
        grid-template-columns: 1fr 1fr;
    }
    
    /* å­¦ç”Ÿå¡ç‰‡åŒºåŸŸè·¨è¶Šä¸¤åˆ— */
    .student-grid,
    .department-section,
    .room-section {
        grid-column: 1 / -1;
    }
}


.detail-item {
    display: flex;
    flex-direction: column;
    padding: 4px 0;
}

.detail-label {
    font-size: 0.75rem;
    color: var(--medium-gray);
    margin-bottom: 2px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.detail-value {
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-color);
    line-height: 1.3;
}

/* çŠ¶æ€æ ‡ç­¾æ ·å¼ */
.student-status,
.student-status-compact,
.practice-duration {
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: inline-block;
    white-space: nowrap;
    text-align: center;
    vertical-align: middle;
    user-select: none;
    border: 1px solid transparent;
    transition: all 0.15s ease-in-out;
}

/* å­¦ç”ŸçŠ¶æ€é¢œè‰² */
.student-status.present,
.student-status-compact.present { 
    background: #d4edda; 
    color: #155724; 
    border-color: #c3e6cb;
}

.student-status.absent,
.student-status-compact.absent { 
    background: #f8d7da; 
    color: #721c24; 
    border-color: #f5c6cb;
}

.student-status.excused,
.student-status-compact.excused { 
    background: #fff3cd; 
    color: #856404; 
    border-color: #ffeaa7;
}

.student-status.low-efficiency,
.student-status-compact.low-efficiency { 
    background: #ffeaa7; 
    color: #b06000; 
    border-color: #ffdc7a;
}

.student-status.practicing-unscheduled,
.student-status-compact.practicing-unscheduled { 
    background: #e8d5f2; 
    color: #6a1b9a; 
    border-color: #dcc7e8;
}

.student-status.weekend,
.student-status-compact.weekend { 
    background: #ecf0f1; 
    color: #2c3e50; 
    border-color: #d5dbdb;
}

/* ç»ƒç´æ—¶é•¿æ ‡ç­¾é¢œè‰² */
.practice-duration {
    background: #e8d5f2;
    color: #6a1b9a;
    border-color: #dcc7e8;
}

@media (max-width: 768px) {
    .student-header {
        margin-bottom: 8px;
    }
    
    .student-name {
        font-size: 1.3rem;
    }
    
    .student-details,
    .practice-details {
        grid-template-columns: 1fr;
        gap: 6px;
        margin-bottom: 10px;
    }
    
    .detail-label {
        font-size: 0.7rem;
    }
    
    .detail-value {
        font-size: 0.8rem;
    }
    
    .student-status,
    .student-status-compact,
    .practice-duration {
        padding: 3px 8px;
        font-size: 0.7rem;
        border-radius: 12px;
    }
}

/* ===== 14. å®æ—¶ç»ƒç´æŒ‡ç¤ºå™¨ ===== */
.practice-indicator {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 12px;
    height: 12px;
    background: var(--success-color);
    border-radius: 50%;
    animation: pulse 2s infinite;
    box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7);
}

.practice-status-card.compact .practice-indicator {
    top: 12px;
    right: 12px;
    width: 10px;
    height: 10px;
}

@keyframes pulse {
    0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7);
    }
    
    70% {
        transform: scale(1);
        box-shadow: 0 0 0 10px rgba(39, 174, 96, 0);
    }
    
    100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(39, 174, 96, 0);
    }
}

@media (max-width: 768px) {
    .practice-indicator {
        width: 8px;
        height: 8px;
        top: 10px;
        right: 10px;
    }
    
    .practice-status-card.compact .practice-indicator {
        width: 6px;
        height: 6px;
        top: 8px;
        right: 8px;
    }
}

/* ===== 15. è€ƒå‹¤å†å²æ—¶é—´è½´ ===== */
.attendance-history {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

.history-title {
    font-size: 0.9rem;
    color: var(--medium-gray);
    margin-bottom: 10px;
    font-weight: 500;
}

.history-timeline {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 10px 0;
    justify-content: center;
}

.history-timeline-container {
    padding: 15px 0;
}

.history-day {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    border: 2px solid transparent;
}

.history-day:hover {
    transform: scale(1.15);
    z-index: 1;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.history-day.present { 
    background: var(--success-color); 
    color: white; 
    border-color: var(--success-color);
}

.history-day.absent { 
    background: var(--danger-color); 
    color: white; 
    border-color: var(--danger-color);
}

.history-day.excused { 
    background: var(--warning-color); 
    color: white; 
    border-color: var(--warning-color);
}

.history-day.no-data { 
    background: var(--light-gray); 
    color: var(--medium-gray); 
    border-color: var(--border-color);
}

.history-day.low-efficiency {
    background: #f39c12;
    border-color: #f39c12;
    color: white;
}

.history-day.practicing-unscheduled {
    background: #9b59b6;
    border-color: #9b59b6;
    color: white;
}

.history-day.weekend {
    background: #95a5a6;
    border-color: #95a5a6;
    color: white;
}

/* ç§»åŠ¨ç«¯è€ƒå‹¤å†å²ä¼˜åŒ– */
@media (max-width: 768px) {
    .attendance-history {
        margin-top: 10px;
        padding-top: 10px;
    }
    
    .history-timeline {
        gap: 6px;
    }
    
    .history-day {
        width: 35px;
        height: 35px;
        font-size: 0.8rem;
    }
}

@media (max-width: 480px) {
    .history-timeline {
        gap: 4px;
    }
    
    .history-day {
        width: 30px;
        height: 30px;
        font-size: 0.75rem;
    }
}

/* ===== 16. ç©ºçŠ¶æ€æ ·å¼ ===== */
.practice-empty-state,
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--medium-gray);
}

.practice-empty-state-icon,
.empty-state-icon {
    font-size: 3rem;
    margin-bottom: 15px;
    opacity: 0.5;
}

.practice-empty-state-title,
.empty-state-title {
    font-size: 1.2rem;
    margin-bottom: 8px;
    color: var(--text-color);
    font-weight: 600;
}

.practice-empty-state-description,
.empty-state-description {
    font-size: 0.9rem;
    line-height: 1.4;
    color: var(--medium-gray);
}

.empty-state {
    padding: 60px 20px;
}

.empty-state-icon {
    font-size: 4rem;
    margin-bottom: 20px;
}

.empty-state-title {
    font-size: 1.5rem;
    margin-bottom: 10px;
}

.empty-state-description {
    font-size: 1rem;
    line-height: 1.6;
}

/* ç§»åŠ¨ç«¯ç©ºçŠ¶æ€ä¼˜åŒ– */
@media (max-width: 768px) {
    .empty-state {
        padding: 40px 15px;
    }
    
    .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 15px;
    }
    
    .empty-state-title {
        font-size: 1.2rem;
        margin-bottom: 8px;
    }
    
    .empty-state-description {
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    .practice-empty-state {
        padding: 30px 15px;
    }
    
    .practice-empty-state-icon {
        font-size: 2.5rem;
        margin-bottom: 12px;
    }
    
    .practice-empty-state-title {
        font-size: 1.1rem;
        margin-bottom: 6px;
    }
    
    .practice-empty-state-description {
        font-size: 0.85rem;
    }
}

/* ===== 17. ç­›é€‰å™¨æ ·å¼ ===== */
.filters,
.practice-filters {
    background: white;
    padding: 20px;
    border-radius: var(--radius);
    margin-bottom: 25px;
    box-shadow: var(--shadow);
}

.filter-row,
.practice-filter-row {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: center;
}

.practice-filter-row {
    gap: 12px;
}

.filter-group,
.practice-filter-group {
    display: flex;
    flex-direction: column;
    min-width: 150px;
    flex: 1;
}

.practice-filter-group {
    min-width: 120px;
}

.filter-label,
.practice-filter-label {
    font-size: 0.9rem;
    color: var(--medium-gray);
    margin-bottom: 5px;
    font-weight: 500;
}

.practice-filter-label {
    font-size: 0.85rem;
    margin-bottom: 4px;
}

.filter-select, 
.filter-input,
.practice-filter-select,
.practice-filter-input {
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-small);
    font-size: 14px;
    transition: all 0.3s ease;
    background: white;
    color: var(--text-color);
}

.practice-filter-select,
.practice-filter-input {
    padding: 8px 10px;
}

.filter-select:focus, 
.filter-input:focus,
.practice-filter-select:focus,
.practice-filter-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
}

.filter-select:hover,
.filter-input:hover,
.practice-filter-select:hover,
.practice-filter-input:hover {
    border-color: var(--primary-color);
}

/* å¿«é€Ÿç­›é€‰æ ‡ç­¾ */
.quick-filter-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 15px;
    justify-content: flex-start;
}

.quick-filter-tag {
    padding: 8px 16px;           /* ç»Ÿä¸€å†…è¾¹è· */
    font-size: 14px;             /* ç»Ÿä¸€å­—ä½“å¤§å° */
    font-weight: 500;            /* ç»Ÿä¸€å­—é‡ */
    border-radius: 20px;         /* ç»Ÿä¸€åœ†è§’ */
    height: 36px;                /* ç»Ÿä¸€é«˜åº¦ */
    display: inline-flex;        /* ç»Ÿä¸€å¯¹é½æ–¹å¼ */
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    background: var(--light-gray);
    border: 1px solid var(--border-color);
    cursor: pointer;
    transition: all 0.3s ease;
    user-select: none;
    min-width: auto;
}

.quick-filter-tag:hover {
    background: #e9ecef;
    transform: translateY(-1px);
}

.quick-filter-tag.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}


/* ç§»åŠ¨ç«¯ç­›é€‰å™¨ä¼˜åŒ– */
@media (max-width: 768px) {
    .filters {
        padding: 15px;
        margin: 0 -5px 20px -5px;
    }
    
    .practice-filters {
        padding: 12px;
        margin: 0 -5px 15px -5px;
    }
    
    .filter-row,
    .practice-filter-row {
        flex-direction: column;
        gap: 12px;
    }
    
    .practice-filter-row {
        gap: 10px;
    }
    
    .filter-group,
    .practice-filter-group {
        min-width: auto;
        width: 100%;
    }
    
    .filter-select,
    .filter-input,
    .practice-filter-select,
    .practice-filter-input {
        width: 100%;
        padding: 12px 15px;
        font-size: 16px;
        border-radius: 8px;
        border: 2px solid var(--border-color);
    }
    
    .practice-filter-select,
    .practice-filter-input {
        padding: 10px 12px;
    }
    
    .filter-select:focus,
    .filter-input:focus,
    .practice-filter-select:focus,
    .practice-filter-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    
    .quick-filter-tags {
        justify-content: center;
        margin-top: 12px;
    }
    
    .quick-filter-tag {
        padding: 6px 12px;
        font-size: 13px;
        height: 32px;
    }
}
/* ç¡®ä¿è€ƒå‹¤å¿«ç…§ç­›é€‰å™¨ä¸å®æ—¶ç»ƒç´ç­›é€‰å™¨æ ·å¼å®Œå…¨ä¸€è‡´ */
#todaySnapshot .practice-filters,
#practiceStatusContainer .practice-filters {
    background: white;
    padding: 20px;
    border-radius: var(--radius);
    margin: 0 0 25px 0;  /* ç»Ÿä¸€å¤–è¾¹è· */
    box-shadow: var(--shadow);
    width: 100%;         /* ç¡®ä¿å®½åº¦ä¸€è‡´ */
    box-sizing: border-box;
}

/* ç§»åŠ¨ç«¯ä¹Ÿè¦ä¿æŒä¸€è‡´ */
@media (max-width: 768px) {
    #todaySnapshot .practice-filters,
    #practiceStatusContainer .practice-filters {
        padding: 15px;
        margin: 0 0 20px 0;
    }
}
/* ä»Šæ—¥è€ƒå‹¤å¿«ç…§å®¹å™¨çš„å†…è¾¹è·æ§åˆ¶ç­›é€‰å™¨ä¸¤ä¾§è·ç¦» */
#todaySnapshot {
    padding: 0 0px;  /* å·¦å³å†…è¾¹è·æ§åˆ¶ç­›é€‰å™¨ä¸¤ä¾§è·ç¦» */
    /* æˆ–è€…æ ¹æ®éœ€è¦è°ƒæ•´ï¼Œæ¯”å¦‚ï¼š*/
    /* padding: 0 15px;  å‡å°‘ä¸¤ä¾§è·ç¦» */
    /* padding: 0 30px;  å¢åŠ ä¸¤ä¾§è·ç¦» */
}

/* ç§»åŠ¨ç«¯è°ƒæ•´ */
@media (max-width: 768px) {
    #todaySnapshot {
        padding: 0 0px;  /* ç§»åŠ¨ç«¯çš„å·¦å³å†…è¾¹è· */
    }
}
/* ç­›é€‰å™¨å†…çš„å­¦ç”Ÿç½‘æ ¼æ ·å¼è°ƒæ•´ */
.practice-filters .student-grid {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
    .practice-filters .student-grid {
        margin-top: 15px;
        padding-top: 15px;
    }
}


/* ===== 18. æ“ä½œæŒ‰é’®æ ·å¼ ===== */
.action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
}

.btn {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-size: var(--mobile-font-size);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-height: var(--touch-target-size);
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    -webkit-appearance: none;
    text-decoration: none;
    line-height: 1;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.btn:active {
    transform: scale(0.95);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.btn:disabled:hover {
    transform: none;
    box-shadow: none;
}

/* æŒ‰é’®é¢œè‰²å˜ä½“ */
.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: #2980b9;
}

.btn-success {
    background: var(--success-color);
    color: white;
}

.btn-success:hover {
    background: #229954;
}

.btn-warning {
    background: var(--warning-color);
    color: white;
}

.btn-warning:hover {
    background: #e67e22;
}

.btn-danger {
    background: var(--danger-color);
    color: white;
}

.btn-danger:hover {
    background: #c0392b;
}

.btn-secondary {
    background: var(--medium-gray);
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

.btn-outline {
    background: transparent;
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
}

.btn-outline:hover {
    background: var(--primary-color);
    color: white;
}

/* å¯¼å‡ºé€‰é¡¹ */
.export-options {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
}

/* ç§»åŠ¨ç«¯æŒ‰é’®ä¼˜åŒ– */
@media (max-width: 768px) {
    .action-buttons {
        position: sticky;
        bottom: 0;
        background: white;
        padding: 15px;
        margin: 20px -15px -15px -15px;
        border-top: 1px solid #eee;
        z-index: 10;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .export-options {
        flex-direction: column;
        gap: 8px;
        margin-top: 15px;
    }
    
    .export-options .btn {
        width: 100%;
    }
    
    .btn {
        padding: 14px 20px;
        font-size: 16px;
        border-radius: 10px;
    }
}

/* ===== 19. æ¨¡æ€æ¡†æ ·å¼ä¼˜åŒ– ===== */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 2000;
    backdrop-filter: blur(4px);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
}

.modal-content {
    background: white;
    border-radius: var(--radius);
    padding: 25px;
    max-width: min(600px, 95vw);
    width: 95%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    margin: env(safe-area-inset-top) auto env(safe-area-inset-bottom) auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    transform: translateY(-20px);
    transition: transform 0.3s ease, opacity 0.3s ease;
    opacity: 0;
}

.modal.show .modal-content {
    transform: translateY(0);
    opacity: 1;
}
/* æ¨¡æ€æ¡†å¤´éƒ¨æ ·å¼ */
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 20px 15px 20px;  /* å¢åŠ åº•éƒ¨å†…è¾¹è· */
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 10px;  /* å¢åŠ ä¸‹è¾¹è· */
}

.modal-title {
    margin: 0;
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--text-color);
    flex: 1;
}

.modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--medium-gray);
    padding: 5px;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    margin-left: 15px;
    flex-shrink: 0;
}

.modal-close:hover {
    background: var(--danger-color);
    color: white;
    transform: scale(1.1);
}

/* ç§»åŠ¨ç«¯æ¨¡æ€æ¡†å¤´éƒ¨ä¼˜åŒ– */
@media (max-width: 768px) {
    .modal-header {
        padding: 15px 15px 12px 15px;  /* ç§»åŠ¨ç«¯ä¹Ÿç›¸åº”è°ƒæ•´ */
        margin-bottom: 8px;
    }
}
    
    .modal-title {
        font-size: 1.1rem;
    }
    
    .modal-close {
        font-size: 20px;
        width: 28px;
        height: 28px;
    }
}

/* è€ƒå‹¤è¯¦æƒ…æ¨¡æ€æ¡†æ¸éšåŠ¨ç”» */
#attendanceDetailModal {
    transition: opacity 0.3s ease;
}

#attendanceDetailModal .modal-content {
    transition: none; /* ç§»é™¤å†…å®¹çš„å˜æ¢åŠ¨ç”»ï¼Œåªä¿ç•™æ•´ä½“é€æ˜åº¦åŠ¨ç”» */
}

/* æ·¡å‡ºåŠ¨ç”» */
.modal.hiding {
    opacity: 0;
}

.modal.hiding .modal-content {
    transform: translateY(-20px);
    opacity: 0;
}
/* è€ƒå‹¤è¯¦æƒ…æ¨¡æ€æ¡†ç‰¹æ®Šå¤„ç† */
#attendanceDetailModal.hiding .modal-content {
    transform: translateY(-20px);
    opacity: 0;
}

/* ç§»åŠ¨ç«¯è€ƒå‹¤è¯¦æƒ…æ¨¡æ€æ¡† */
@media (max-width: 768px) {
    #attendanceDetailModal.hiding .modal-content {
        transform: translateY(100%);
        opacity: 0;
    }
}

/* ç§»åŠ¨ç«¯æ¨¡æ€æ¡†ä¼˜åŒ– */
@media (max-width: 768px) {
    .modal {
        padding: 0;
        align-items: flex-end;
    }
    
    .modal-content {
        width: 100%;
        max-width: 100%;
        max-height: 90vh;
        border-radius: var(--radius-large) var(--radius-large) 0 0;
        margin: 0;
        transform: translateY(100%);
    }
    
    .modal.show .modal-content {
        transform: translateY(0);
    }
    
    .modal.hiding .modal-content {
        transform: translateY(100%);
    }
}


/* ===== 20. è¡¨æ ¼æ ·å¼ ===== */
.data-table,
.detail-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background: white;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    font-size: 0.9rem;
}

.detail-table {
    margin: 0;
}

.data-table th,
.data-table td,
.detail-table th,
.detail-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #eee;
    white-space: nowrap;
    min-width: 80px;
    vertical-align: middle;
}

.data-table th,
.detail-table th {
    background: var(--light-gray);
    font-weight: 600;
    color: var(--text-color);
    border-bottom: 2px solid var(--border-color);
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
}

.detail-table thead {
    position: sticky;
    top: 0;
    z-index: 10;
    background: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.data-table tr:hover,
.detail-table tr:hover {
    background: var(--light-gray);
}

.detail-table tr:last-child td {
    border-bottom: none;
}

/* è¡¨æ ¼å®¹å™¨ */
.data-table-container,
.table-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    border-radius: var(--radius);
}

.history-table-card .table-container {
    max-height: 300px;
    overflow-y: auto;
    overflow-x: auto;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    background: white;
    position: relative;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
}

/* è¡¨æ ¼å•å…ƒæ ¼æ ·å¼ */
.date-cell {
    font-weight: 500;
    color: var(--dark-gray);
    min-width: 100px;
}

.table-status-badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    display: inline-block;
    border: 1px solid transparent;
}

.table-status-badge.present { 
    background: #d4edda; 
    color: #155724; 
    border-color: #c3e6cb;
}

.table-status-badge.absent { 
    background: #f8d7da; 
    color: #721c24; 
    border-color: #f5c6cb;
}

.table-status-badge.excused { 
    background: #fff3cd; 
    color: #856404; 
    border-color: #ffeaa7;
}

.table-status-badge.low-efficiency { 
    background: #ffeaa7; 
    color: #b06000; 
    border-color: #ffdc7a;
}

.table-status-badge.practicing-unscheduled { 
    background: #e8d5f2; 
    color: #6a1b9a; 
    border-color: #dcc7e8;
}

.table-status-badge.weekend { 
    background: #ecf0f1; 
    color: #2c3e50; 
    border-color: #d5dbdb;
}

.table-status-badge.no-data { 
    background: var(--light-gray); 
    color: var(--medium-gray); 
    border-color: var(--border-color);
}

.duration-cell {
    color: var(--medium-gray);
    font-weight: 500;
    text-align: right;
    min-width: 80px;
}

.total-duration-cell {
    font-weight: 600;
    color: var(--primary-color);
    text-align: right;
    min-width: 90px;
}

/* è¡¨æ ¼æ»šåŠ¨æç¤º */
.table-scroll-hint {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 5;
}

.table-container:hover .table-scroll-hint {
    opacity: 1;
}

/* è¡¨æ ¼ç©ºçŠ¶æ€ */
.table-empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--medium-gray);
}

.table-empty-state-icon {
    font-size: 2rem;
    margin-bottom: 10px;
    opacity: 0.5;
}

.table-empty-state-title {
    font-size: 1rem;
    margin-bottom: 5px;
    color: var(--text-color);
    font-weight: 600;
}

.table-empty-state-description {
    font-size: 0.85rem;
    line-height: 1.4;
}

/* ç§»åŠ¨ç«¯è¡¨æ ¼ä¼˜åŒ– */
@media (max-width: 768px) {
    .data-table-container {
        margin: 0 -20px;
        padding: 0 20px;
    }
    
    .data-table {
        min-width: 600px;
    }
    
    .data-table th,
    .data-table td {
        padding: 10px 8px;
        font-size: 13px;
    }
    
    .history-table-card .table-container {
        max-height: 250px;
        margin: 0 -10px;
        border-radius: 0;
        border-left: none;
        border-right: none;
    }
    
    .detail-table {
        font-size: 0.8rem;
        min-width: 500px;
    }
    
    .detail-table th,
    .detail-table td {
        padding: 8px 10px;
    }
    
    .detail-table th {
        font-size: 0.75rem;
        background: var(--light-gray);
    }
    
    .history-table-card .table-container::-webkit-scrollbar {
        width: 3px;
        height: 3px;
    }
}

@media (max-width: 480px) {
    .history-table-card .table-container {
        max-height: 200px;
    }
    
    .detail-table {
        font-size: 0.75rem;
        min-width: 450px;
    }
    
    .detail-table th,
    .detail-table td {
        padding: 6px 8px;
    }
}
/* ä»Šæ—¥è¡Œæ ·å¼ */
.today-row {
    background: #f0f8ff;
}

/* æ·±è‰²æ¨¡å¼ä¸‹çš„ä»Šæ—¥è¡Œ */
@media (prefers-color-scheme: dark) {
    .today-row {
        background: rgba(88, 166, 255, 0.15) !important;
    }
    
    .today-row .date-cell {
        color: var(--text-color);
    }
    
    .today-row .date-cell small {
        color: var(--primary-color) !important;
    }
}


/* ===== 21. åŠ è½½åŠ¨ç”» ===== */
.loading {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 40px;
}

.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid var(--light-gray);
    border-top: 4px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-text {
    margin-top: 15px;
    color: var(--medium-gray);
    font-size: 0.9rem;
}

/* ç§»åŠ¨ç«¯åŠ è½½åŠ¨ç”»ä¼˜åŒ– */
@media (max-width: 768px) {
    .loading {
        padding: 30px 20px;
    }
    
    .spinner {
        width: 35px;
        height: 35px;
        border-width: 3px;
    }
    
    .loading-text {
        margin-top: 12px;
        font-size: 0.85rem;
    }
}

/* ===== 22. æ—¥æœŸé€‰æ‹©å™¨æ ·å¼ ===== */
.date-picker {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.date-input {
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-small);
    font-size: 14px;
    color: var(--text-color);
    background: white;
    transition: all 0.3s ease;
}

.date-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
}

/* ç§»åŠ¨ç«¯æ—¥æœŸé€‰æ‹©å™¨ä¼˜åŒ– */
@media (max-width: 768px) {
    .date-picker {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
        padding: 15px;
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        margin-bottom: 20px;
    }
    
    .date-input {
        width: 100%;
        padding: 12px 15px;
        font-size: 16px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
    }
    
    .date-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
}

/* ===== 23. å­¦ç”Ÿè¯¦æƒ…é¡µé¢ç‰¹æ®Šæ ·å¼ ===== */
.student-detail-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
    max-width: 800px;
    margin: 0 auto;
}

/* å­¦ç”Ÿæ¡£æ¡ˆå¡ç‰‡ */
.student-profile-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: var(--radius-large);
    text-align: center;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
}

.profile-info {
    width: 100%;
}

.profile-name {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0 0 15px 0;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    line-height: 1.1;
}

.profile-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 12px;
    font-size: 1.1rem;
    opacity: 0.9;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.meta-icon {
    font-size: 1rem;
}

.meta-divider {
    opacity: 0.6;
    margin: 0 4px;
    font-size: 1.2rem;
}

/* ä»Šæ—¥çŠ¶æ€å¡ç‰‡ */
.today-status-card {
    background: white;
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border-left: 5px solid var(--primary-color);
}

.today-status-card.present { border-left-color: var(--success-color); }
.today-status-card.absent { border-left-color: var(--danger-color); }
.today-status-card.excused { border-left-color: var(--warning-color); }
.today-status-card.low-efficiency { border-left-color: #f39c12; }
.today-status-card.practicing-unscheduled { border-left-color: #9b59b6; }
.today-status-card.weekend { border-left-color: #95a5a6; }

.status-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.status-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--text-color);
    margin: 0;
}

.status-badge {
    padding: 8px 16px;
    border-radius: var(--radius-large);
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid transparent;
}

.status-badge.present { background: #d4edda; color: #155724; border-color: #c3e6cb; }
.status-badge.absent { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }
.status-badge.excused { background: #fff3cd; color: #856404; border-color: #ffeaa7; }
.status-badge.low-efficiency { background: #ffeaa7; color: #b06000; border-color: #ffdc7a; }
.status-badge.practicing-unscheduled { background: #e8d5f2; color: #6a1b9a; border-color: #dcc7e8; }
.status-badge.weekend { background: #ecf0f1; color: #2c3e50; border-color: #d5dbdb; }

.status-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.metric-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: var(--light-gray);
    border-radius: var(--radius);
    transition: transform 0.2s ease;
}

.metric-item:hover {
    transform: translateY(-2px);
}

.metric-icon {
    font-size: 1.5rem;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 50%;
}

.metric-content {
    flex: 1;
}

.metric-label {
    font-size: 0.85rem;
    opacity: 0.8;
    margin-bottom: 2px;
    color: var(--medium-gray);
}

.metric-value {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-color);
}
/* è¯·å‡ä¿¡æ¯ */
.excuse-info {
    margin-top: 20px;
    padding: 16px;
    background: rgba(243, 156, 18, 0.1);
    border-radius: var(--radius);
    border-left: 4px solid #f39c12;
}

.excuse-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
}

.excuse-icon {
    font-size: 1.2rem;
}

.excuse-title {
    font-weight: 600;
    color: #b06000;
}

.excuse-content {
    padding-left: 28px;
}

.excuse-reason {
    margin: 0 0 4px 0;
    color: #856404;
    font-weight: 500;
}

.excuse-approver {
    margin: 0;
    font-size: 0.9rem;
    color: #6c5700;
}

/* é€šç”¨å¡ç‰‡æ ·å¼ */
.card-header {
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--light-gray);
}

.card-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-color);
    margin: 0;
}

.title-icon {
    font-size: 1.3rem;
}

.title-subtitle {
    font-size: 0.85rem;
    font-weight: 400;
    color: var(--medium-gray);
    margin-left: 4px;
}

/* ç»Ÿè®¡ç½‘æ ¼è¯¦ç»†ç‰ˆ */
.stats-grid-detailed {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    max-width: 100%;
}

.stats-grid-detailed .stat-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 20px;
    border-radius: var(--radius);
    transition: transform 0.2s ease;
    min-height: 80px;
}

.stats-grid-detailed .stat-item:hover {
    transform: translateY(-3px);
}

.stats-grid-detailed .stat-item.present { 
    background: linear-gradient(135deg, #d4edda, #c3e6cb); 
}

.stats-grid-detailed .stat-item.absent { 
    background: linear-gradient(135deg, #f8d7da, #f5c6cb); 
}

.stats-grid-detailed .stat-item.excused { 
    background: linear-gradient(135deg, #fff3cd, #ffeaa7); 
}

.stats-grid-detailed .stat-item.rate { 
    background: linear-gradient(135deg, #cce7ff, #b3d9ff); 
}

.stats-grid-detailed .stat-icon {
    font-size: 1.5rem;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    flex-shrink: 0;
}

.stats-grid-detailed .stat-content {
    flex: 1;
    min-width: 0;
}

.stats-grid-detailed .stat-number {
    font-size: 1.8rem;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 4px;
    color: var(--text-color);
}

.stats-grid-detailed .stat-label {
    font-size: 0.9rem;
    color: var(--medium-gray);
    font-weight: 500;
    line-height: 1.2;
}

/* ç§»åŠ¨ç«¯å­¦ç”Ÿè¯¦æƒ…é¡µé¢ä¼˜åŒ– */
@media (max-width: 768px) {
    .student-detail-content {
        gap: 16px;
    }
    
    .student-profile-card {
        padding: 25px 20px;
    }
    
    .profile-name {
        font-size: 2rem;
    }
    
    .profile-meta {
        font-size: 1rem;
        gap: 10px;
    }
    
    .status-header {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
    }
    
    .status-metrics {
        grid-template-columns: 1fr;
    }
    
    .stats-grid-detailed {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .stats-grid-detailed .stat-item {
        padding: 16px;
        min-height: 70px;
    }
    
    .stats-grid-detailed .stat-icon {
        width: 40px;
        height: 40px;
        font-size: 1.3rem;
    }
    
    .stats-grid-detailed .stat-number {
        font-size: 1.5rem;
    }
    
    .stats-grid-detailed .stat-label {
        font-size: 0.85rem;
    }
}

@media (max-width: 480px) {
    .student-detail-content {
        gap: 16px;
    }
    
    .card {
        padding: 20px 16px;
    }
    
    .profile-name {
        font-size: 1.8rem;
    }
    
    .profile-meta {
        font-size: 0.9rem;
        gap: 8px;
    }
    
    .stats-grid-detailed .stat-item {
        padding: 14px;
        min-height: 60px;
        gap: 10px;
    }
    
    .stats-grid-detailed .stat-icon {
        width: 35px;
        height: 35px;
        font-size: 1.2rem;
    }
    
    .stats-grid-detailed .stat-number {
        font-size: 1.3rem;
    }
    
    .stats-grid-detailed .stat-label {
        font-size: 0.8rem;
    }
}

/* ä¸­ç­‰å±å¹•ç»Ÿè®¡ç½‘æ ¼ä¼˜åŒ– */
@media (min-width: 769px) and (max-width: 1024px) {
    .stats-grid-detailed {
        grid-template-columns: repeat(2, 1fr);
        gap: 14px;
    }
    
    .stats-grid-detailed .stat-item {
        padding: 18px;
    }
    
    .stats-grid-detailed .stat-number {
        font-size: 1.6rem;
    }
}

/* å¤§å±å¹•ç»Ÿè®¡ç½‘æ ¼ä¼˜åŒ– */
@media (min-width: 1200px) {
    .stats-grid-detailed {
        max-width: 600px;
        margin: 0 auto;
    }
}

/* ===== 24. åŠ è½½æ›´å¤šæç¤º ===== */
.load-more-hint {
    text-align: center;
    padding: 15px;
    color: var(--medium-gray);
    font-size: 0.85rem;
    border-top: 1px solid #eee;
    background: var(--light-gray);
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.load-more-hint:hover {
    background: #e9ecef;
}

.load-more-hint.loading {
    color: var(--primary-color);
    cursor: not-allowed;
}

/* ===== 25. è§¦æ‘¸ä¼˜åŒ– ===== */
.student-card, 
.practice-status-card, 
.stat-card, 
.btn, 
.nav-tab,
.quick-filter-tag,
.history-day {
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
    tap-highlight-color: rgba(0, 0, 0, 0.1);
}

.student-card:active, 
.practice-status-card:active, 
.stat-card:active {
    transform: scale(0.98);
}

.btn:active {
    transform: scale(0.95);
}

.quick-filter-tag:active,
.history-day:active {
    transform: scale(0.95);
}

/* ===== 26. iOSå®‰å…¨åŒºåŸŸé€‚é… ===== */
@supports (padding: max(0px)) {
    .container {
        padding-left: max(20px, env(safe-area-inset-left));
        padding-right: max(20px, env(safe-area-inset-right));
    }
    
    @media (max-width: 768px) {
        .container {
            padding-left: max(15px, env(safe-area-inset-left));
            padding-right: max(15px, env(safe-area-inset-right));
        }
    }
}

/* ===== 27. æ¨ªå±æ¨¡å¼ä¼˜åŒ– ===== */
@media (max-width: 768px) and (orientation: landscape) {
    .header {
        padding: max(15px, env(safe-area-inset-top) + 10px) 20px 15px 20px;
    }
    
    .header h1 {
        font-size: 1.8rem;
        margin-bottom: 5px;
    }
    
    .header .subtitle {
        font-size: 1rem;
    }
    
    .stats-grid {
        grid-template-columns: repeat(4, 1fr);
    }
    
    .modal-content {
        max-height: 80vh;
    }
    
    .student-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* ===== 28. iOS Safari ç‰¹æ®Šä¼˜åŒ– ===== */
@supports (-webkit-touch-callout: none) {
    .nav-tabs {
        -webkit-overflow-scrolling: touch;
    }
    
    .modal-content {
        -webkit-overflow-scrolling: touch;
    }
    
    input, select, textarea {
        -webkit-appearance: none;
        border-radius: 8px;
    }
    
    .btn {
        -webkit-appearance: none;
    }
}

/* ===== 29. æ»šåŠ¨æ¡æ ·å¼ ===== */
* {
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
}

*::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

*::-webkit-scrollbar-track {
    background: transparent;
}

*::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
}

*::-webkit-scrollbar-thumb:hover {
    background-color: rgba(0, 0, 0, 0.4);
}

/* ç§»åŠ¨ç«¯æ»šåŠ¨æ¡ */
@media (max-width: 768px) {
    *::-webkit-scrollbar {
        width: 3px;
        height: 3px;
    }
}

/* ===== 30. å¯è®¿é—®æ€§ä¼˜åŒ– ===== */
.student-card:focus,
.practice-status-card:focus,
.btn:focus,
.nav-tab:focus,
.quick-filter-tag:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

button:focus,
input:focus,
select:focus,
textarea:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 1px;
}

/* é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ */
@media (prefers-contrast: high) {
    :root {
        --border-color: #000;
        --text-color: #000;
        --background-color: #fff;
    }
    
    .card {
        border: 2px solid #000;
    }
    
    .btn {
        border: 2px solid currentColor;
    }
}

/* å‡å°‘åŠ¨ç”»åå¥½ */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    
    .practice-indicator {
        animation: none;
    }
    
    .spinner {
        animation: none;
    }
}

/* ===== 31. æ‰“å°æ ·å¼ä¼˜åŒ– ===== */
@media print {
    .language-switcher,
    .connection-status,
    .nav-tabs,
    .action-buttons,
    .btn,
    .modal,
    .practice-indicator {
        display: none !important;
    }
    
    .container {
        max-width: none;
        padding: 0;
    }
    
    .card {
        break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ddd;
        margin-bottom: 15px;
    }
    
    .student-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .student-card,
    .practice-status-card {
        break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ddd;
    }
    
    .header {
        background: none !important;
        color: #000 !important;
        box-shadow: none;
    }
    
    body {
        background: white !important;
        color: black !important;
    }
}

/* ===== 32. ç»Ÿä¸€çš„çŠ¶æ€é¢œè‰²ç³»ç»Ÿ ===== */
.present, 
.student-status.present, 
.student-status-compact.present, 
.table-status-badge.present,
.status-badge.present { 
    background: #d4edda; 
    color: #155724; 
    border-color: #c3e6cb;
}

.absent, 
.student-status.absent, 
.student-status-compact.absent, 
.table-status-badge.absent,
.status-badge.absent { 
    background: #f8d7da; 
    color: #721c24; 
    border-color: #f5c6cb;
}

.pending,
.student-status.pending,
.student-status-compact.pending,
.table-status-badge.pending,
.status-badge.pending {
    background: #f8f9fa;
    color: #6c757d;
    border-color: #dee2e6;
}


.excused, 
.student-status.excused, 
.student-status-compact.excused, 
.table-status-badge.excused,
.status-badge.excused { 
    background: #fff3cd; 
    color: #856404; 
    border-color: #ffeaa7;
}

.low-efficiency, 
.student-status.low-efficiency, 
.student-status-compact.low-efficiency, 
.table-status-badge.low-efficiency,
.status-badge.low-efficiency { 
    background: #ffeaa7; 
    color: #b06000; 
    border-color: #ffdc7a;
}

.practicing-unscheduled, 
.student-status.practicing-unscheduled, 
.student-status-compact.practicing-unscheduled, 
.table-status-badge.practicing-unscheduled,
.status-badge.practicing-unscheduled { 
    background: #e8d5f2; 
    color: #6a1b9a; 
    border-color: #dcc7e8;
}

.weekend, 
.student-status.weekend, 
.student-status-compact.weekend, 
.table-status-badge.weekend,
.status-badge.weekend { 
    background: #ecf0f1; 
    color: #2c3e50; 
    border-color: #d5dbdb;
}

/* ===== 33. æ–‡æœ¬å’Œæ’ç‰ˆä¼˜åŒ– ===== */
p, div, span {
    line-height: 1.5;
}

h1, h2, h3, h4, h5, h6 {
    line-height: 1.2;
    margin-bottom: 0.5em;
    font-weight: 600;
}

/* ç¡®ä¿æ‰€æœ‰æ–‡æœ¬è¾“å…¥æ¡†åœ¨iOSä¸Šä¸ä¼šè¢«ç¼©æ”¾ */
input, select, textarea, button {
    font-size: 16px;
    -webkit-text-size-adjust: 100%;
}

/* ç¡®ä¿è§¦æ‘¸ç›®æ ‡è¶³å¤Ÿå¤§ */
.nav-tab,
.btn,
.lang-btn,
.connection-status,
.student-card,
.practice-status-card,
.history-day,
.quick-filter-tag {
    min-height: 44px;
    min-width: 44px;
}

/* å°å±å¹•ä¸‹çš„è§¦æ‘¸ç›®æ ‡è°ƒæ•´ */
@media (max-width: 480px) {
    .nav-tab,
    .btn {
        min-height: 40px;
    }
    
    .lang-btn {
        min-height: 32px;
        min-width: 32px;
    }
    
    .history-day {
        min-height: 32px;
        min-width: 32px;
    }
}

/* ===== 34. ç‰¹æ®Šå†…å®¹å¤„ç† ===== */
.detail-item[style*="grid-column: 1 / -1"] .detail-value {
    font-size: 0.85rem;
    line-height: 1.4;
    margin-top: 2px;
}

.detail-item .detail-value[style*="color: #f39c12"] {
    background: rgba(243, 156, 18, 0.1);
    padding: 6px 8px;
    border-radius: var(--radius-small);
    font-size: 0.8rem;
    line-height: 1.3;
}
/* ===== æ—¶é—´æ®µæ ‡ç­¾ç¾åŒ–æ ·å¼ - å¢å¤§æ–‡å­—å¹¶å·¦å¯¹é½ ===== */
.time-slot-tag {
    display: inline-block;
    background: transparent;
    color: #6c757d;
    border: none;
    padding: 2px 4px;
    margin: 2px 4px 2px 0;
    border-radius: 0;
    font-size: 0.9rem;         /* ğŸ”¥ ä» 0.8rem å¢åŠ åˆ° 0.9rem */
    font-weight: 500;          /* ğŸ”¥ ä» 400 å¢åŠ åˆ° 500 */
    box-shadow: none;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.time-slot-tag:hover {
    color: #495057;
    transform: none;
    box-shadow: none;
    background: transparent;
}

.time-slots-wrapper {
    display: flex;
    flex-wrap: wrap;
    align-items: flex-start;     /* ğŸ”¥ æ”¹ä¸º flex-startï¼Œé¡¶éƒ¨å¯¹é½ */
    justify-content: flex-start; /* ğŸ”¥ å¼ºåˆ¶å·¦å¯¹é½ */
    gap: 0;
    margin-top: 4px;
    width: 100%;                 /* ğŸ”¥ ç¡®ä¿å æ»¡å®½åº¦ */
    margin-left: 0;              /* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ²¡æœ‰å·¦è¾¹è· */
    padding-left: 0;             /* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ²¡æœ‰å·¦å†…è¾¹è· */
}

.time-slots-container {
    width: 100%;                 /* ğŸ”¥ å®¹å™¨å æ»¡å®½åº¦ */
}

.time-slots-container .metric-value {
    line-height: 1.4;            /* ğŸ”¥ ä» 1.2 å¢åŠ åˆ° 1.4 */
    text-align: left;            /* ğŸ”¥ æ–‡æœ¬å·¦å¯¹é½ */
    width: 100%;                 /* ğŸ”¥ å æ»¡å®½åº¦ */
    margin-left: 0;              /* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ²¡æœ‰å·¦è¾¹è· */
    padding-left: 0;             /* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ²¡æœ‰å·¦å†…è¾¹è· */
}

/* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ—¶é—´æ®µå®¹å™¨åœ¨ç½‘æ ¼ä¸­å·¦å¯¹é½ */
.time-slots-container.metric-item {
    justify-content: flex-start;
    align-items: flex-start;
}

.time-slots-container .metric-content {
    width: 100%;
    text-align: left;
    margin-left: 0;              /* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ²¡æœ‰å·¦è¾¹è· */
    padding-left: 0;             /* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ²¡æœ‰å·¦å†…è¾¹è· */
}

/* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ ‡ç­¾è¡Œä¸æ ‡é¢˜å®Œå…¨å·¦å¯¹é½ */
.metric-content .metric-label {
    margin-left: 0;
    padding-left: 0;
    text-align: left;
}

.metric-content .metric-value.time-slots-wrapper {
    margin-left: 0 !important;   /* ğŸ”¥ å¼ºåˆ¶å»é™¤å·¦è¾¹è· */
    padding-left: 0 !important;  /* ğŸ”¥ å¼ºåˆ¶å»é™¤å·¦å†…è¾¹è· */
    text-align: left;
    justify-content: flex-start !important;
}

/* å½“å‰æ—¶é—´æ®µé«˜äº® - åªæœ‰è¿™ä¸ªçŠ¶æ€æ‰æœ‰èƒŒæ™¯å’Œå½¢çŠ¶ */
.time-slot-tag.current {
    background: linear-gradient(135deg, #d1ecf1, #bee5eb);
    color: #0c5460;
    border: 1px solid #b8daff;
    padding: 6px 14px;         /* ğŸ”¥ ä» 4px 12px å¢åŠ åˆ° 6px 14px */
    border-radius: 18px;       /* ğŸ”¥ ä» 16px å¢åŠ åˆ° 18px */
    font-weight: 600;          /* ğŸ”¥ ä» 500 å¢åŠ åˆ° 600 */
    font-size: 0.95rem;        /* ğŸ”¥ æ–°å¢ï¼šå½“å‰æ—¶é—´æ®µå­—ä½“æ›´å¤§ */
    box-shadow: 0 1px 3px rgba(12, 84, 96, 0.2);
    animation: pulse-glow 2s infinite;
}

.time-slot-tag.current:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(12, 84, 96, 0.3);
}

@keyframes pulse-glow {
    0%, 100% { 
        box-shadow: 0 1px 3px rgba(12, 84, 96, 0.2);
    }
    50% { 
        box-shadow: 0 2px 8px rgba(12, 84, 96, 0.3);
    }
}

/* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿çŠ¶æ€æŒ‡æ ‡ç½‘æ ¼ä¸­çš„å¯¹é½ */
.status-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    align-items: start;
}

.status-metrics .metric-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    background: var(--light-gray);
    border-radius: var(--radius);
    transition: transform 0.2s ease;
    text-align: left;            /* ğŸ”¥ ç¡®ä¿å†…å®¹å·¦å¯¹é½ */
}

/* ğŸ”¥ æ–°å¢ï¼šç‰¹åˆ«é’ˆå¯¹æ—¶é—´æ®µå®¹å™¨çš„å¯¹é½å¤„ç† */
.status-metrics .time-slots-container.metric-item .metric-content {
    display: flex;
    flex-direction: column;
    align-items: flex-start;     /* ğŸ”¥ å†…å®¹å·¦å¯¹é½ */
    width: 100%;
}

.status-metrics .time-slots-container.metric-item .metric-label {
    align-self: flex-start;      /* ğŸ”¥ æ ‡ç­¾å·¦å¯¹é½ */
    margin-left: 0;
    padding-left: 0;
}

.status-metrics .time-slots-container.metric-item .metric-value {
    align-self: flex-start;      /* ğŸ”¥ å€¼å·¦å¯¹é½ */
    width: 100%;
    margin-left: 0;
    padding-left: 0;
}

/* ç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
    .time-slot-tag {
        font-size: 0.85rem;      /* ğŸ”¥ ä» 0.75rem å¢åŠ åˆ° 0.85rem */
        padding: 3px 4px;        /* ğŸ”¥ ä» 2px 3px å¢åŠ åˆ° 3px 4px */
        margin: 1px 3px 1px 0;
        font-weight: 500;        /* ğŸ”¥ ç¡®ä¿ç§»åŠ¨ç«¯ä¹Ÿæœ‰è¶³å¤Ÿå­—é‡ */
    }
    
    .time-slot-tag.current {
        padding: 5px 12px;       /* ğŸ”¥ ä» 3px 10px å¢åŠ åˆ° 5px 12px */
        font-size: 0.9rem;       /* ğŸ”¥ ç§»åŠ¨ç«¯å½“å‰æ—¶é—´æ®µä¹Ÿå¢å¤§ */
    }
    
    .time-slots-container .metric-value {
        line-height: 1.5;        /* ğŸ”¥ ç§»åŠ¨ç«¯è¡Œé«˜ä¹Ÿå¢åŠ  */
        text-align: left;        /* ğŸ”¥ ç¡®ä¿ç§»åŠ¨ç«¯ä¹Ÿå·¦å¯¹é½ */
        margin-left: 0;
        padding-left: 0;
    }
    
    .time-slots-wrapper {
        justify-content: flex-start; /* ğŸ”¥ ç§»åŠ¨ç«¯ä¹Ÿå¼ºåˆ¶å·¦å¯¹é½ */
        margin-left: 0;
        padding-left: 0;
    }
    
    .status-metrics {
        grid-template-columns: 1fr;
        gap: 12px;
    }
}

@media (max-width: 480px) {
    .time-slot-tag {
        font-size: 0.8rem;       /* ğŸ”¥ è¶…å°å±å¹•é€‚å½“è°ƒæ•´ */
        padding: 2px 3px;
        margin: 1px 2px 1px 0;
    }
    
    .time-slot-tag.current {
        padding: 4px 10px;
        font-size: 0.85rem;
    }
    
    .time-slots-wrapper {
        margin-top: 2px;
        justify-content: flex-start; /* ğŸ”¥ è¶…å°å±å¹•ä¹Ÿå·¦å¯¹é½ */
        margin-left: 0;
        padding-left: 0;
    }
    
    .time-slots-container .metric-value {
        margin-left: 0;
        padding-left: 0;
    }
}

/* æ·±è‰²æ¨¡å¼é€‚é… */
@media (prefers-color-scheme: dark) {
    .time-slot-tag {
        background: transparent;
        color: #8b949e;
        border: none;
        box-shadow: none;
        font-weight: 500;        /* ğŸ”¥ ç¡®ä¿æ·±è‰²æ¨¡å¼ä¹Ÿæœ‰è¶³å¤Ÿå­—é‡ */
    }
    
    .time-slot-tag:hover {
        color: #f0f6fc;
        background: transparent;
        box-shadow: none;
    }
    
    .time-slot-tag.current {
        background: linear-gradient(135deg, #1f2937, #374151);
        color: #93c5fd;
        border: 1px solid #60a5fa;
        box-shadow: 0 1px 3px rgba(147, 197, 253, 0.2);
        font-weight: 600;        /* ğŸ”¥ æ·±è‰²æ¨¡å¼å½“å‰æ—¶é—´æ®µä¿æŒç²—ä½“ */
    }
    
    .time-slot-tag.current:hover {
        box-shadow: 0 2px 6px rgba(147, 197, 253, 0.3);
    }
    
    @keyframes pulse-glow {
        0%, 100% { 
            box-shadow: 0 1px 3px rgba(147, 197, 253, 0.2);
        }
        50% { 
            box-shadow: 0 2px 8px rgba(147, 197, 253, 0.3);
        }
    }
}

/* ğŸ”¥ æ–°å¢ï¼šRTLè¯­è¨€æ”¯æŒæ—¶çš„å¯¹é½ */
[dir="rtl"] .time-slots-wrapper {
    justify-content: flex-end;
}

[dir="rtl"] .time-slots-container .metric-value {
    text-align: right;
}

[dir="rtl"] .time-slot-tag {
    margin: 2px 0 2px 4px;
}

/* ===== 35. åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœ ===== */
.fade-in {
    animation: fadeIn 0.5s ease-in-out;
}

.slide-up {
    animation: slideUp 0.5s ease-out;
}

@keyframes slideUp {
    from {
        transform: translateY(20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.bounce-in {
    animation: bounceIn 0.6s ease-out;
}

@keyframes bounceIn {
    0% {
        transform: scale(0.3);
        opacity: 0;
    }
    50% {
        transform: scale(1.05);
    }
    70% {
        transform: scale(0.9);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}
/* ===== 36. æ·±è‰²æ¨¡å¼ ===== */
/* ===== æ·±è‰²æ¨¡å¼å˜é‡å®šä¹‰å’Œå®Œç¾é€‚é… ===== */
@media (prefers-color-scheme: dark) {
    :root {
        /* æ·±è‰²æ¨¡å¼é¢œè‰²å˜é‡é‡å®šä¹‰ */
        --background-color: #0d1117;
        --card-bg: #21262d;
        --card-hover-bg: #30363d;
        --text-color: #f0f6fc;
        --text-secondary: #8b949e;
        --text-muted: #6e7681;
        --border-color: #30363d;
        --light-gray: #21262d;
        --medium-gray: #8b949e;
        --dark-gray: #f0f6fc;
        --shadow-color: rgba(0,0,0,0.4);
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„ä¸»è‰²è°ƒè°ƒæ•´ */
        --primary-color: #58a6ff;
        --secondary-color: #3fb950;
        --warning-color: #d29922;
        --danger-color: #f85149;
        --success-color: #3fb950;
        
        /* æ·±è‰²æ¨¡å¼æ¸å˜è‰² */
        --gradient-primary: linear-gradient(135deg, #58a6ff, #3fb950);
        --gradient-card: linear-gradient(135deg, #21262d, #30363d);
        
        /* æ·±è‰²æ¨¡å¼é˜´å½± */
        --shadow: 0 2px 10px rgba(0,0,0,0.4);
        --shadow-hover: 0 5px 20px rgba(0,0,0,0.6);
    }
    
    /* åŸºç¡€å…ƒç´ æ·±è‰²é€‚é… */
    body {
        background: var(--background-color);
        color: var(--text-color);
    }
    
    /* å¡ç‰‡å’Œå®¹å™¨æ·±è‰²é€‚é… */
    .card,
    .student-card,
    .practice-status-card,
    .stat-card,
    .today-status-card {
        background: var(--card-bg);
        color: var(--text-color);
        border-color: var(--border-color);
    }
    
    .card:hover,
    .student-card:hover,
    .practice-status-card:hover {
        background: var(--card-hover-bg);
    }
    
    /* å¯¼èˆªå’Œæ ‡ç­¾æ·±è‰²é€‚é… */
    .nav-tabs {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
    }
    
    .nav-tab {
        color: var(--medium-gray);
    }
    
    .nav-tab:hover {
        background: rgba(88, 166, 255, 0.1);
        color: var(--primary-color);
    }
    
    .nav-tab.active {
        background: var(--primary-color);
        color: #0d1117;
    }
    
    /* è¯­è¨€åˆ‡æ¢å™¨æ·±è‰²é€‚é… */
    .language-switcher {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
    }
    
    .lang-btn {
        color: var(--medium-gray);
    }
    
    .lang-btn:hover:not(.active) {
        background: rgba(88, 166, 255, 0.1);
        color: var(--primary-color);
    }
    
    .lang-btn.active {
        background: var(--primary-color);
        color: #0d1117;
    }
    
    /* è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨æ·±è‰²é€‚é… */
    .connection-status.online {
        background: var(--card-bg);
        color: var(--success-color);
        border-color: var(--success-color);
    }
    
    .connection-status.offline {
        background: var(--card-bg);
        color: var(--danger-color);
        border-color: var(--danger-color);
    }
    
    .connection-status.syncing {
        background: var(--card-bg);
        color: var(--warning-color);
        border-color: var(--warning-color);
    }
    
    /* ç­›é€‰å™¨æ·±è‰²é€‚é… */
    .filters,
    .practice-filters {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
    }
    
    /* ğŸ”¥ æ–°å¢ï¼šç‰¹å®šå®¹å™¨çš„ç­›é€‰å™¨æ·±è‰²é€‚é… */
    #todaySnapshot .practice-filters,
    #practiceStatusContainer .practice-filters {
        background: var(--card-bg) !important;
        border: 1px solid var(--border-color) !important;
    }
    
    /* ç­›é€‰å™¨å†…çš„ç½‘æ ¼å®¹å™¨æ·±è‰²é€‚é… */
    .practice-filters .student-grid {
        border-top-color: var(--border-color);
    }
    
    /* ç­›é€‰å™¨æ ‡ç­¾å’Œè¾“å…¥æ¡†æ·±è‰²é€‚é… */
    .practice-filter-label,
    .filter-label {
        color: var(--medium-gray);
    }
    /* ç§»åŠ¨ç«¯ç­›é€‰å™¨æ·±è‰²é€‚é… */
    @media (max-width: 768px) {
        .filters {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        
        .practice-filters {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        
        #todaySnapshot .practice-filters,
        #practiceStatusContainer .practice-filters {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
        }
        
        .date-picker {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }
    }    
    .filter-select,
    .filter-input,
    .practice-filter-select,
    .practice-filter-input,
    .date-input {
        background: var(--background-color);
        color: var(--text-color);
        border-color: var(--border-color);
    }
    
    .filter-select:focus,
    .filter-input:focus,
    .practice-filter-select:focus,
    .practice-filter-input:focus,
    .date-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.3);
    }
    
    .filter-select:hover,
    .filter-input:hover,
    .practice-filter-select:hover,
    .practice-filter-input:hover,
    .date-input:hover {
        border-color: var(--primary-color);
    }
    
    /* å¿«é€Ÿç­›é€‰æ ‡ç­¾æ·±è‰²é€‚é… */
    .quick-filter-tag {
        background: var(--card-hover-bg);
        color: var(--text-color);
        border-color: var(--border-color);
    }
    
    .quick-filter-tag:hover {
        background: #484f58;
        transform: translateY(-1px);
    }
    
    .quick-filter-tag.active {
        background: var(--primary-color);
        color: #0d1117;
        border-color: var(--primary-color);
    }

    
    /* æŒ‰é’®æ·±è‰²é€‚é… */
    .btn-primary {
        background: var(--primary-color);
        color: #0d1117;
    }
    
    .btn-primary:hover {
        background: #1f6feb;
    }
    
    .btn-success {
        background: var(--success-color);
        color: #0d1117;
    }
    
    .btn-success:hover {
        background: #2ea043;
    }
    
    .btn-warning {
        background: var(--warning-color);
        color: #0d1117;
    }
    
    .btn-warning:hover {
        background: #bb8009;
    }
    
    .btn-danger {
        background: var(--danger-color);
        color: #0d1117;
    }
    
    .btn-danger:hover {
        background: #da3633;
    }
    
    .btn-secondary {
        background: var(--medium-gray);
        color: #0d1117;
    }
    
    .btn-secondary:hover {
        background: #6e7681;
    }
    
    .btn-outline {
        background: transparent;
        color: var(--primary-color);
        border-color: var(--primary-color);
    }
    
    .btn-outline:hover {
        background: var(--primary-color);
        color: #0d1117;
    }
    
    /* æ¨¡æ€æ¡†æ·±è‰²é€‚é… */
    .modal {
        background: rgba(0, 0, 0, 0.8);
    }
    
    .modal-content {
        background: var(--card-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
    }
    
    .modal-close {
        background: var(--card-hover-bg);
        color: var(--medium-gray);
    }
    
    .modal-close:hover {
        background: var(--danger-color);
        color: #0d1117;
    }
    
    /* è¡¨æ ¼æ·±è‰²é€‚é… */
    .data-table,
    .detail-table {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
    }
    
    .data-table th,
    .data-table td,
    .detail-table th,
    .detail-table td {
        border-bottom-color: var(--border-color);
        color: var(--text-color);
    }
    
    .data-table th,
    .detail-table th {
        background: var(--card-hover-bg);
        color: var(--text-color);
        border-bottom-color: var(--border-color);
    }
    
    .data-table tr:hover,
    .detail-table tr:hover {
        background: var(--card-hover-bg);
    }
    
    .history-table-card .table-container {
        background: var(--card-bg);
        border-color: var(--border-color);
    }
    
    /* çŠ¶æ€æ ‡ç­¾æ·±è‰²æ¨¡å¼é€‚é… */
    .student-status.present,
    .student-status-compact.present,
    .table-status-badge.present,
    .status-badge.present {
        background: #238636;
        color: #aff5b4;
        border-color: #2ea043;
    }
    
    .student-status.absent,
    .student-status-compact.absent,
    .table-status-badge.absent,
    .status-badge.absent {
        background: #da3633;
        color: #ffdcd7;
        border-color: #f85149;
    }
    
    .student-status.excused,
    .student-status-compact.excused,
    .table-status-badge.excused,
    .status-badge.excused {
        background: #bb8009;
        color: #f2cc60;
        border-color: #d29922;
    }
    
    .student-status.low-efficiency,
    .student-status-compact.low-efficiency,
    .table-status-badge.low-efficiency,
    .status-badge.low-efficiency {
        background: #9a6700;
        color: #f2cc60;
        border-color: #bb8009;
    }
    
    .student-status.practicing-unscheduled,
    .student-status-compact.practicing-unscheduled,
    .table-status-badge.practicing-unscheduled,
    .status-badge.practicing-unscheduled {
        background: #8250df;
        color: #d2a8ff;
        border-color: #a475f9;
    }
    
    .student-status.weekend,
    .student-status-compact.weekend,
    .table-status-badge.weekend,
    .status-badge.weekend {
        background: #6e7681;
        color: #f0f6fc;
        border-color: #8b949e;
    }
    
    .student-status.pending,
    .student-status-compact.pending,
    .table-status-badge.pending,
    .status-badge.pending {
        background: #30363d;
        color: #8b949e;
        border-color: #484f58;
    }
    
    /* ç»ƒç´æ—¶é•¿æ ‡ç­¾æ·±è‰²é€‚é… */
    .practice-duration,
    .practice-duration-large {
        background: #8250df;
        color: #d2a8ff;
        border-color: #a475f9;
    }
    
    /* è€ƒå‹¤å†å²æ—¶é—´è½´æ·±è‰²é€‚é… */
    .history-day.present {
        background: var(--success-color);
        border-color: var(--success-color);
    }
    
    .history-day.absent {
        background: var(--danger-color);
        border-color: var(--danger-color);
    }
    
    .history-day.excused {
        background: var(--warning-color);
        border-color: var(--warning-color);
    }
    
    .history-day.no-data {
        background: var(--card-hover-bg);
        color: var(--medium-gray);
        border-color: var(--border-color);
    }
    
    .history-day.low-efficiency {
        background: #9a6700;
        border-color: #bb8009;
    }
    
    .history-day.practicing-unscheduled {
        background: #8250df;
        border-color: #a475f9;
    }
    
    .history-day.weekend {
        background: #6e7681;
        border-color: #8b949e;
    }
    
    /* å¡ç‰‡è¾¹æ¡†é¢œè‰²æ·±è‰²é€‚é… */
    .practice-status-card.present,
    .student-card.present {
        border-left-color: var(--success-color);
    }
    
    .practice-status-card.absent,
    .student-card.absent {
        border-left-color: var(--danger-color);
    }
    
    .practice-status-card.excused,
    .student-card.excused {
        border-left-color: var(--warning-color);
    }
    
    .practice-status-card.low-efficiency,
    .student-card.low-efficiency {
        border-left-color: #bb8009;
    }
    
    .practice-status-card.practicing-unscheduled,
    .student-card.practicing-unscheduled {
        border-left-color: #8250df;
    }
    
    .practice-status-card.weekend,
    .student-card.weekend {
        border-left-color: #6e7681;
        background: var(--gradient-card);
    }
    
    .practice-status-card.pending,
    .student-card.pending {
        border-left-color: var(--medium-gray);
    }
    
    /* ç»Ÿè®¡å¡ç‰‡æ·±è‰²é€‚é… */
    .stats-grid-detailed .stat-item.present {
        background: linear-gradient(135deg, #0d2818, #238636);
    }
    
    .stats-grid-detailed .stat-item.absent {
        background: linear-gradient(135deg, #2c0e0e, #da3633);
    }
    
    .stats-grid-detailed .stat-item.excused {
        background: linear-gradient(135deg, #2d1b00, #bb8009);
    }
    
    .stats-grid-detailed .stat-item.rate {
        background: linear-gradient(135deg, #0c1929, #1f6feb);
    }
    
    /* ç»Ÿè®¡å›¾æ ‡èƒŒæ™¯æ·±è‰²é€‚é… */
    .stats-grid-detailed .stat-icon,
    .metric-icon {
        background: rgba(240, 246, 252, 0.1);
    }
    
    /* è¯·å‡ä¿¡æ¯æ·±è‰²é€‚é… */
    .excuse-info {
        background: rgba(187, 128, 9, 0.15);
        border-left-color: var(--warning-color);
    }
    
    .excuse-title {
        color: var(--warning-color);
    }
    
    .excuse-reason {
        color: #f2cc60;
    }
    
    .excuse-approver {
        color: #d29922;
    }
    
    /* ç©ºçŠ¶æ€æ·±è‰²é€‚é… */
    .empty-state,
    .practice-empty-state,
    .table-empty-state {
        color: var(--medium-gray);
    }
    
    .empty-state-title,
    .practice-empty-state-title,
    .table-empty-state-title {
        color: var(--text-color);
    }
    
    /* åŠ è½½åŠ¨ç”»æ·±è‰²é€‚é… */
    .spinner {
        border-color: var(--card-hover-bg);
        border-top-color: var(--primary-color);
    }
    
    .loading-text {
        color: var(--medium-gray);
    }
    
    /* æ»šåŠ¨æ¡æ·±è‰²é€‚é… */
    *::-webkit-scrollbar-track {
        background: var(--background-color);
    }
    
    *::-webkit-scrollbar-thumb {
        background-color: var(--card-hover-bg);
    }
    
    *::-webkit-scrollbar-thumb:hover {
        background-color: #484f58;
    }
    
    /* è¡¨æ ¼æ»šåŠ¨æç¤ºæ·±è‰²é€‚é… */
    .table-scroll-hint {
        background: rgba(13, 17, 23, 0.9);
        color: var(--text-color);
    }
    
    /* è¯¦æƒ…æ ‡ç­¾æ·±è‰²é€‚é… */
    .detail-label {
        color: var(--medium-gray);
    }
    
    .detail-value {
        color: var(--text-color);
    }
    
    /* ç‰¹æ®Šå†…å®¹å¤„ç†æ·±è‰²é€‚é… */
    .detail-item .detail-value[style*="color: #f39c12"] {
        background: rgba(187, 128, 9, 0.15) !important;
        color: #f2cc60 !important;
    }
    
    /* åŒæ­¥æ—¥å¿—æ·±è‰²é€‚é… */
    #syncLogs {
        background: var(--background-color) !important;
        color: var(--text-color);
        border: 1px solid var(--border-color);
    }
    
    /* æ—¥æœŸé€‰æ‹©å™¨æ·±è‰²é€‚é… */
    .date-picker {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
    }
    
    /* å­¦ç”Ÿæ¡£æ¡ˆå¡ç‰‡æ·±è‰²æ¸å˜ */
    .student-profile-card {
        background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
    }
    
    /* ä»Šæ—¥çŠ¶æ€å¡ç‰‡æ·±è‰²é€‚é… */
    .today-status-card.present { border-left-color: var(--success-color); }
    .today-status-card.absent { border-left-color: var(--danger-color); }
    .today-status-card.excused { border-left-color: var(--warning-color); }
    .today-status-card.low-efficiency { border-left-color: #bb8009; }
    .today-status-card.practicing-unscheduled { border-left-color: #8250df; }
    .today-status-card.weekend { border-left-color: #6e7681; }
    
    /* æŒ‡æ ‡é¡¹æ·±è‰²é€‚é… */
    .metric-item {
        background: var(--card-hover-bg);
    }
    
    .metric-content {
        color: var(--text-color);
    }
    
    .metric-label {
        color: var(--medium-gray);
    }
    
    .metric-value {
        color: var(--text-color);
    }
    
    /* å¡ç‰‡æ ‡é¢˜æ·±è‰²é€‚é… */
    .card-title,
    .status-title,
    .modal-title {
        color: var(--text-color);
    }
    
    .title-subtitle {
        color: var(--medium-gray);
    }
    
    /* è€ƒå‹¤å†å²è¾¹æ¡†æ·±è‰²é€‚é… */
    .attendance-history {
        border-top-color: var(--border-color);
    }
    
    /* å¤´éƒ¨æ·±è‰²é€‚é… */
    .header {
        background: var(--gradient-primary);
    }
    
    /* ç§»åŠ¨ç«¯æŒ‰é’®èƒŒæ™¯æ·±è‰²é€‚é… */
    @media (max-width: 768px) {
        .action-buttons {
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
        }
    }
    
    /* é«˜å¯¹æ¯”åº¦æ¨¡å¼ä¸‹çš„æ·±è‰²é€‚é… */
    @media (prefers-contrast: high) {
        :root {
            --border-color: #58a6ff;
            --text-color: #ffffff;
            --background-color: #000000;
        }
        
        .card {
            border: 2px solid var(--primary-color);
        }
        
        .btn {
            border: 2px solid currentColor;
        }
    }
}

/* ===== 37. ä¼˜åŒ–å’Œæ¸…ç† ===== */
/* ç¡®ä¿æ‰€æœ‰äº¤äº’å…ƒç´ éƒ½æœ‰åˆé€‚çš„è¿‡æ¸¡æ•ˆæœ */
button,
input,
select,
textarea,
.card,
.student-card,
.practice-status-card,
.stat-card,
.btn,
.nav-tab,
.quick-filter-tag,
.history-day {
    transition: all 0.3s ease;
}

/* é˜²æ­¢æ–‡æœ¬é€‰æ‹©åœ¨æŸäº›äº¤äº’å…ƒç´ ä¸Š */
.nav-tab,
.btn,
.student-status,
.student-status-compact,
.practice-duration,
.quick-filter-tag,
.history-day,
.stat-card {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

/* ç¡®ä¿å›¾æ ‡å’Œemojiæ­£ç¡®æ˜¾ç¤º */
.title-icon,
.meta-icon,
.metric-icon,
.excuse-icon,
.stat-icon,
.practice-indicator {
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* æœ€ç»ˆçš„å“åº”å¼ä¼˜åŒ– */
@media (max-width: 320px) {
    .container {
        padding: 8px;
    }
    
    .card {
        padding: 15px 10px;
    }
    
    .student-card,
    .practice-status-card {
        padding: 10px 8px;
        min-height: 100px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .stat-number {
        font-size: 1.5rem;
    }
}
/* ===== è€ƒå‹¤è¯¦æƒ…æ¨¡æ€æ¡†ä¼˜åŒ– ===== */
#attendanceDetailModal .modal-content {
    max-width: 800px;
    width: 95%;
}

/* å“åº”å¼ä¼˜åŒ– */
@media (max-width: 768px) {
    #attendanceDetailModal .stats-grid-detailed {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 8px;
    }
    
    #attendanceDetailModal .stat-item {
        padding: 12px;
        min-height: 60px;
    }
    
    #attendanceDetailModal .stat-number {
        font-size: 1.2rem;
    }
    
    #attendanceDetailModal .stat-label {
        font-size: 0.8rem;
    }
}

/* ç‚¹å‡»æç¤º */
.history-day {
    cursor: pointer;
    transition: all 0.3s ease;
}

.history-day:hover {
    transform: scale(1.15);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* ===== é˜²æ­¢æ¨¡æ€æ¡†èƒŒæ™¯æ»šåŠ¨ ===== */
body.modal-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100%;
}

/* ç§»åŠ¨ç«¯é˜²æ»šåŠ¨ä¼˜åŒ– */
@media (max-width: 768px) {
    body.modal-open {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        overflow: hidden;
        -webkit-overflow-scrolling: none;
    }
}
/* ===== è€ƒå‹¤è¯¦æƒ…æ¨¡æ€æ¡†è¡¨æ ¼æ»šåŠ¨ä¿®å¤ ===== */
#attendanceDetailModal .data-table-container {
    max-height: 300px;
    overflow-y: auto;
    overflow-x: auto;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    background: white;
    position: relative;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
    /* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ»šåŠ¨å®¹å™¨ä¸è¶…å‡ºè¾¹ç•Œ */
    width: 100%;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

#attendanceDetailModal .data-table {
    width: 100%;
    min-width: 500px; /* ğŸ”¥ è®¾ç½®æœ€å°å®½åº¦ç¡®ä¿è¡¨æ ¼å¯è¯»æ€§ */
    border-collapse: collapse;
    margin: 0;
    background: white;
    border-radius: 0; /* ğŸ”¥ ç§»é™¤è¡¨æ ¼åœ†è§’ï¼Œç”±å®¹å™¨æ§åˆ¶ */
    overflow: hidden;
    box-shadow: none; /* ğŸ”¥ ç§»é™¤è¡¨æ ¼é˜´å½±ï¼Œç”±å®¹å™¨æ§åˆ¶ */
    font-size: 0.85rem; /* ğŸ”¥ ç¨å¾®å‡å°å­—ä½“ä»¥é€‚åº”æ›´å¤šå†…å®¹ */
}

#attendanceDetailModal .data-table th,
#attendanceDetailModal .data-table td {
    padding: 10px 12px; /* ğŸ”¥ å‡å°‘å†…è¾¹è· */
    text-align: left;
    border-bottom: 1px solid #eee;
    white-space: nowrap;
    vertical-align: middle;
    /* ğŸ”¥ æ–°å¢ï¼šè®¾ç½®æœ€å°å’Œæœ€å¤§å®½åº¦ */
    min-width: 80px;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
}

#attendanceDetailModal .data-table th {
    background: var(--light-gray);
    font-weight: 600;
    color: var(--text-color);
    border-bottom: 2px solid var(--border-color);
    text-transform: uppercase;
    font-size: 0.75rem; /* ğŸ”¥ è¡¨å¤´å­—ä½“æ›´å° */
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
    z-index: 10;
}

/* ğŸ”¥ æ–°å¢ï¼šç‰¹å®šåˆ—å®½åº¦æ§åˆ¶ */
#attendanceDetailModal .data-table th:nth-child(1),
#attendanceDetailModal .data-table td:nth-child(1) {
    min-width: 120px; /* æ—¶é—´æ®µåˆ— */
    max-width: 150px;
}

#attendanceDetailModal .data-table th:nth-child(2),
#attendanceDetailModal .data-table td:nth-child(2) {
    min-width: 80px; /* çŠ¶æ€åˆ— */
    max-width: 100px;
}

#attendanceDetailModal .data-table th:nth-child(3),
#attendanceDetailModal .data-table td:nth-child(3) {
    min-width: 90px; /* ç»ƒç´æ—¶é•¿åˆ— */
    max-width: 120px;
}

#attendanceDetailModal .data-table th:nth-child(4),
#attendanceDetailModal .data-table td:nth-child(4) {
    min-width: 80px; /* ç´æˆ¿åˆ— */
    max-width: 100px;
}

#attendanceDetailModal .data-table th:nth-child(5),
#attendanceDetailModal .data-table td:nth-child(5) {
    min-width: 100px; /* å¤‡æ³¨åˆ— */
    max-width: 200px;
}

/* ğŸ”¥ æ–°å¢ï¼šè¡¨æ ¼è¡Œæ‚¬åœæ•ˆæœä¼˜åŒ– */
#attendanceDetailModal .data-table tr:hover {
    background: var(--light-gray);
}

#attendanceDetailModal .data-table tr:last-child td {
    border-bottom: none;
}

/* ğŸ”¥ æ–°å¢ï¼šçŠ¶æ€æ ‡ç­¾åœ¨è¡¨æ ¼ä¸­çš„æ ·å¼è°ƒæ•´ */
#attendanceDetailModal .table-status-badge {
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.65rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    white-space: nowrap;
    display: inline-block;
    border: 1px solid transparent;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* ğŸ”¥ æ–°å¢ï¼šæ»šåŠ¨æ¡æ ·å¼ä¼˜åŒ– */
#attendanceDetailModal .data-table-container::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

#attendanceDetailModal .data-table-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

#attendanceDetailModal .data-table-container::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

#attendanceDetailModal .data-table-container::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* ğŸ”¥ æ–°å¢ï¼šç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
    #attendanceDetailModal .data-table-container {
        max-height: 250px;
        margin: 0 -10px; /* ğŸ”¥ ç§»åŠ¨ç«¯æ‰©å±•åˆ°è¾¹ç¼˜ */
        border-radius: 0;
        border-left: none;
        border-right: none;
    }
    
    #attendanceDetailModal .data-table {
        min-width: 450px; /* ğŸ”¥ ç§»åŠ¨ç«¯æœ€å°å®½åº¦ */
        font-size: 0.8rem;
    }
    
    #attendanceDetailModal .data-table th,
    #attendanceDetailModal .data-table td {
        padding: 8px 6px; /* ğŸ”¥ ç§»åŠ¨ç«¯æ›´ç´§å‡‘çš„å†…è¾¹è· */
        min-width: 60px;
    }
    
    #attendanceDetailModal .data-table th {
        font-size: 0.7rem;
    }
    
    #attendanceDetailModal .table-status-badge {
        padding: 2px 6px;
        font-size: 0.6rem;
        border-radius: 8px;
    }
    
    /* ğŸ”¥ ç§»åŠ¨ç«¯åˆ—å®½è°ƒæ•´ */
    #attendanceDetailModal .data-table th:nth-child(1),
    #attendanceDetailModal .data-table td:nth-child(1) {
        min-width: 100px;
        max-width: 120px;
    }
    
    #attendanceDetailModal .data-table th:nth-child(2),
    #attendanceDetailModal .data-table td:nth-child(2) {
        min-width: 70px;
        max-width: 80px;
    }
    
    #attendanceDetailModal .data-table th:nth-child(3),
    #attendanceDetailModal .data-table td:nth-child(3) {
        min-width: 80px;
        max-width: 100px;
    }
    
    #attendanceDetailModal .data-table th:nth-child(4),
    #attendanceDetailModal .data-table td:nth-child(4) {
        min-width: 70px;
        max-width: 90px;
    }
    
    #attendanceDetailModal .data-table th:nth-child(5),
    #attendanceDetailModal .data-table td:nth-child(5) {
        min-width: 90px;
        max-width: 150px;
    }
}

@media (max-width: 480px) {
    #attendanceDetailModal .data-table-container {
        max-height: 200px;
    }
    
    #attendanceDetailModal .data-table {
        min-width: 400px;
        font-size: 0.75rem;
    }
    
    #attendanceDetailModal .data-table th,
    #attendanceDetailModal .data-table td {
        padding: 6px 4px;
        min-width: 50px;
    }
    
    #attendanceDetailModal .data-table th {
        font-size: 0.65rem;
    }
    
    #attendanceDetailModal .table-status-badge {
        padding: 1px 4px;
        font-size: 0.55rem;
        border-radius: 6px;
    }
}

/* ğŸ”¥ æ–°å¢ï¼šæ»šåŠ¨æç¤º */
#attendanceDetailModal .data-table-container::after {
    content: 'â† å·¦å³æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š â†’';
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 5;
}

#attendanceDetailModal .data-table-container:hover::after {
    opacity: 1;
}

/* ğŸ”¥ ç§»åŠ¨ç«¯æ»šåŠ¨æç¤º */
@media (max-width: 768px) {
    #attendanceDetailModal .data-table-container::after {
        content: 'â† æ»‘åŠ¨ â†’';
        font-size: 0.65rem;
        padding: 3px 6px;
        bottom: 6px;
        right: 6px;
    }
}

/* ğŸ”¥ æ–°å¢ï¼šæ·±è‰²æ¨¡å¼é€‚é… */
@media (prefers-color-scheme: dark) {
    #attendanceDetailModal .data-table-container {
        background: var(--card-bg);
        border-color: var(--border-color);
    }
    
    #attendanceDetailModal .data-table {
        background: var(--card-bg);
    }
    
    #attendanceDetailModal .data-table th,
    #attendanceDetailModal .data-table td {
        border-bottom-color: var(--border-color);
        color: var(--text-color);
    }
    
    #attendanceDetailModal .data-table th {
        background: var(--card-hover-bg);
        color: var(--text-color);
    }
    
    #attendanceDetailModal .data-table tr:hover {
        background: var(--card-hover-bg);
    }
    
    #attendanceDetailModal .data-table-container::-webkit-scrollbar-track {
        background: var(--card-hover-bg);
    }
    
    #attendanceDetailModal .data-table-container::-webkit-scrollbar-thumb {
        background: var(--medium-gray);
    }
    
    #attendanceDetailModal .data-table-container::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary);
    }
    
    #attendanceDetailModal .data-table-container::after {
        background: rgba(13, 17, 23, 0.9);
        color: var(--text-color);
    }
}
/* ===== å­¦ç”Ÿè¯¦æƒ…æ¨¡æ€æ¡†è¡¨æ ¼æ»šåŠ¨ä¿®å¤ ===== */
#studentDetailModal .data-table-container {
    max-height: 230px;
    overflow-y: auto;
    overflow-x: auto;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    background: white;
    position: relative;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
    /* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ»šåŠ¨å®¹å™¨ä¸è¶…å‡ºè¾¹ç•Œ */
    width: 100%;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

#studentDetailModal .data-table {
    width: 100%;
    min-width: 400px; /* ğŸ”¥ è®¾ç½®æœ€å°å®½åº¦ç¡®ä¿è¡¨æ ¼å¯è¯»æ€§ */
    border-collapse: collapse;
    margin: 0;
    background: white;
    border-radius: 0; /* ğŸ”¥ ç§»é™¤è¡¨æ ¼åœ†è§’ï¼Œç”±å®¹å™¨æ§åˆ¶ */
    overflow: hidden;
    box-shadow: none; /* ğŸ”¥ ç§»é™¤è¡¨æ ¼é˜´å½±ï¼Œç”±å®¹å™¨æ§åˆ¶ */
    font-size: 0.85rem; /* ğŸ”¥ ç¨å¾®å‡å°å­—ä½“ä»¥é€‚åº”æ›´å¤šå†…å®¹ */
}

#studentDetailModal .data-table th,
#studentDetailModal .data-table td {
    padding: 8px 10px; /* ğŸ”¥ å‡å°‘å†…è¾¹è· */
    text-align: left;
    border-bottom: 1px solid #eee;
    white-space: nowrap;
    vertical-align: middle;
    /* ğŸ”¥ æ–°å¢ï¼šè®¾ç½®æœ€å°å’Œæœ€å¤§å®½åº¦ */
    min-width: 70px;
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
}

#studentDetailModal .data-table th {
    background: var(--light-gray);
    font-weight: 600;
    color: var(--text-color);
    border-bottom: 2px solid var(--border-color);
    text-transform: uppercase;
    font-size: 0.75rem; /* ğŸ”¥ è¡¨å¤´å­—ä½“æ›´å° */
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
    z-index: 10;
}

/* ğŸ”¥ æ–°å¢ï¼šç»ƒç´æ˜ç»†è¡¨æ ¼ç‰¹å®šåˆ—å®½åº¦æ§åˆ¶ */
#studentDetailModal .data-table th:nth-child(1),
#studentDetailModal .data-table td:nth-child(1) {
    min-width: 120px; /* æ—¥æœŸåˆ— */
    max-width: 140px;
}

#studentDetailModal .data-table th:nth-child(2),
#studentDetailModal .data-table td:nth-child(2) {
    min-width: 60px; /* æ®µå†…åˆ— */
    max-width: 80px;
    text-align: center;
}

#studentDetailModal .data-table th:nth-child(3),
#studentDetailModal .data-table td:nth-child(3) {
    min-width: 60px; /* æ®µå¤–åˆ— */
    max-width: 80px;
    text-align: center;
}

#studentDetailModal .data-table th:nth-child(4),
#studentDetailModal .data-table td:nth-child(4) {
    min-width: 70px; /* æ€»è®¡åˆ— */
    max-width: 90px;
    text-align: center;
    font-weight: 600;
}

/* ğŸ”¥ æ–°å¢ï¼šè¡¨æ ¼è¡Œæ‚¬åœæ•ˆæœä¼˜åŒ– */
#studentDetailModal .data-table tr:hover {
    background: var(--light-gray);
}

#studentDetailModal .data-table tr:last-child td {
    border-bottom: none;
}

/* ğŸ”¥ æ–°å¢ï¼šä»Šæ—¥è¡Œç‰¹æ®Šæ ·å¼ä¿æŒ */
#studentDetailModal .data-table .today-row {
    background: #f0f8ff;
}

#studentDetailModal .data-table .today-row:hover {
    background: #e6f3ff;
}

/* ğŸ”¥ æ–°å¢ï¼šæ»šåŠ¨æ¡æ ·å¼ä¼˜åŒ– */
#studentDetailModal .data-table-container::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

#studentDetailModal .data-table-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

#studentDetailModal .data-table-container::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

#studentDetailModal .data-table-container::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* ğŸ”¥ æ–°å¢ï¼šç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
    #studentDetailModal .data-table-container {
        max-height: 200px;
        margin: 0 -15px; /* ğŸ”¥ ç§»åŠ¨ç«¯æ‰©å±•åˆ°è¾¹ç¼˜ */
        border-radius: 0;
        border-left: none;
        border-right: none;
    }
    
    #studentDetailModal .data-table {
        min-width: 350px; /* ğŸ”¥ ç§»åŠ¨ç«¯æœ€å°å®½åº¦ */
        font-size: 0.8rem;
    }
    
    #studentDetailModal .data-table th,
    #studentDetailModal .data-table td {
        padding: 6px 8px; /* ğŸ”¥ ç§»åŠ¨ç«¯æ›´ç´§å‡‘çš„å†…è¾¹è· */
        min-width: 50px;
    }
    
    #studentDetailModal .data-table th {
        font-size: 0.7rem;
    }
    
    /* ğŸ”¥ ç§»åŠ¨ç«¯åˆ—å®½è°ƒæ•´ */
    #studentDetailModal .data-table th:nth-child(1),
    #studentDetailModal .data-table td:nth-child(1) {
        min-width: 100px;
        max-width: 120px;
    }
    
    #studentDetailModal .data-table th:nth-child(2),
    #studentDetailModal .data-table td:nth-child(2) {
        min-width: 50px;
        max-width: 60px;
    }
    
    #studentDetailModal .data-table th:nth-child(3),
    #studentDetailModal .data-table td:nth-child(3) {
        min-width: 50px;
        max-width: 60px;
    }
    
    #studentDetailModal .data-table th:nth-child(4),
    #studentDetailModal .data-table td:nth-child(4) {
        min-width: 60px;
        max-width: 70px;
    }
}

@media (max-width: 480px) {
    #studentDetailModal .data-table-container {
        max-height: 180px;
    }
    
    #studentDetailModal .data-table {
        min-width: 320px;
        font-size: 0.75rem;
    }
    
    #studentDetailModal .data-table th,
    #studentDetailModal .data-table td {
        padding: 5px 6px;
        min-width: 45px;
    }
    
    #studentDetailModal .data-table th {
        font-size: 0.65rem;
    }
    
    /* ğŸ”¥ è¶…å°å±å¹•åˆ—å®½è°ƒæ•´ */
    #studentDetailModal .data-table th:nth-child(1),
    #studentDetailModal .data-table td:nth-child(1) {
        min-width: 90px;
        max-width: 100px;
    }
    
    #studentDetailModal .data-table th:nth-child(2),
    #studentDetailModal .data-table td:nth-child(2) {
        min-width: 45px;
        max-width: 50px;
    }
    
    #studentDetailModal .data-table th:nth-child(3),
    #studentDetailModal .data-table td:nth-child(3) {
        min-width: 45px;
        max-width: 50px;
    }
    
    #studentDetailModal .data-table th:nth-child(4),
    #studentDetailModal .data-table td:nth-child(4) {
        min-width: 50px;
        max-width: 60px;
    }
}

/* ğŸ”¥ æ–°å¢ï¼šæ»šåŠ¨æç¤º */
#studentDetailModal .data-table-container::after {
    content: 'â† å·¦å³æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š â†’';
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 5;
}

#studentDetailModal .data-table-container:hover::after {
    opacity: 1;
}

/* ğŸ”¥ ç§»åŠ¨ç«¯æ»šåŠ¨æç¤º */
@media (max-width: 768px) {
    #studentDetailModal .data-table-container::after {
        content: 'â† æ»‘åŠ¨ â†’';
        font-size: 0.65rem;
        padding: 3px 6px;
        bottom: 6px;
        right: 6px;
    }
}

/* ğŸ”¥ æ–°å¢ï¼šæ·±è‰²æ¨¡å¼é€‚é… */
@media (prefers-color-scheme: dark) {
    #studentDetailModal .data-table-container {
        background: var(--card-bg);
        border-color: var(--border-color);
    }
    
    #studentDetailModal .data-table {
        background: var(--card-bg);
    }
    
    #studentDetailModal .data-table th,
    #studentDetailModal .data-table td {
        border-bottom-color: var(--border-color);
        color: var(--text-color);
    }
    
    #studentDetailModal .data-table th {
        background: var(--card-hover-bg);
        color: var(--text-color);
    }
    
    #studentDetailModal .data-table tr:hover {
        background: var(--card-hover-bg);
    }
    
    #studentDetailModal .data-table .today-row {
        background: rgba(88, 166, 255, 0.15) !important;
    }
    
    #studentDetailModal .data-table .today-row:hover {
        background: rgba(88, 166, 255, 0.25) !important;
    }
    
    #studentDetailModal .data-table .today-row .date-cell small {
        color: var(--primary-color) !important;
    }
    
    #studentDetailModal .data-table-container::-webkit-scrollbar-track {
        background: var(--card-hover-bg);
    }
    
    #studentDetailModal .data-table-container::-webkit-scrollbar-thumb {
        background: var(--medium-gray);
    }
    
    #studentDetailModal .data-table-container::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary);
    }
    
    #studentDetailModal .data-table-container::after {
        background: rgba(13, 17, 23, 0.9);
        color: var(--text-color);
    }
}
/* ===== æŠ¥å‘Šé¡µé¢è¡¨æ ¼æ»šåŠ¨ä¿®å¤ ===== */
#reportsTab .data-table-container {
    max-height: 400px;
    overflow-y: auto;
    overflow-x: auto;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    background: white;
    position: relative;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
    /* ğŸ”¥ æ–°å¢ï¼šç¡®ä¿æ»šåŠ¨å®¹å™¨ä¸è¶…å‡ºè¾¹ç•Œ */
    width: 100%;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

#reportsTab .data-table {
    width: 100%;
    min-width: 500px; /* ğŸ”¥ è®¾ç½®æœ€å°å®½åº¦ç¡®ä¿è¡¨æ ¼å¯è¯»æ€§ */
    border-collapse: collapse;
    margin: 0;
    background: white;
    border-radius: 0; /* ğŸ”¥ ç§»é™¤è¡¨æ ¼åœ†è§’ï¼Œç”±å®¹å™¨æ§åˆ¶ */
    overflow: hidden;
    box-shadow: none; /* ğŸ”¥ ç§»é™¤è¡¨æ ¼é˜´å½±ï¼Œç”±å®¹å™¨æ§åˆ¶ */
    font-size: 0.85rem; /* ğŸ”¥ ç¨å¾®å‡å°å­—ä½“ä»¥é€‚åº”æ›´å¤šå†…å®¹ */
}

#reportsTab .data-table th,
#reportsTab .data-table td {
    padding: 8px 10px; /* ğŸ”¥ å‡å°‘å†…è¾¹è· */
    text-align: left;
    border-bottom: 1px solid #eee;
    white-space: nowrap;
    vertical-align: middle;
    /* ğŸ”¥ æ–°å¢ï¼šè®¾ç½®æœ€å°å’Œæœ€å¤§å®½åº¦ */
    min-width: 70px;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
}

#reportsTab .data-table th {
    background: var(--light-gray);
    font-weight: 600;
    color: var(--text-color);
    border-bottom: 2px solid var(--border-color);
    text-transform: uppercase;
    font-size: 0.75rem; /* ğŸ”¥ è¡¨å¤´å­—ä½“æ›´å° */
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
    z-index: 10;
}

/* ğŸ”¥ æ–°å¢ï¼šæ¯æ—¥è€ƒå‹¤è¶‹åŠ¿è¡¨æ ¼åˆ—å®½æ§åˆ¶ */
#reportsTab .data-table.daily-trend th:nth-child(1),
#reportsTab .data-table.daily-trend td:nth-child(1) {
    min-width: 100px; /* æ—¥æœŸåˆ— */
    max-width: 120px;
}

#reportsTab .data-table.daily-trend th:nth-child(2),
#reportsTab .data-table.daily-trend td:nth-child(2) {
    min-width: 60px; /* åˆè®¡åˆ— */
    max-width: 80px;
    text-align: center;
}

#reportsTab .data-table.daily-trend th:nth-child(3),
#reportsTab .data-table.daily-trend td:nth-child(3) {
    min-width: 60px; /* å‡ºå‹¤åˆ— */
    max-width: 80px;
    text-align: center;
}

#reportsTab .data-table.daily-trend th:nth-child(4),
#reportsTab .data-table.daily-trend td:nth-child(4) {
    min-width: 60px; /* ç¼ºå‹¤åˆ— */
    max-width: 80px;
    text-align: center;
}

#reportsTab .data-table.daily-trend th:nth-child(5),
#reportsTab .data-table.daily-trend td:nth-child(5) {
    min-width: 60px; /* è¯·å‡åˆ— */
    max-width: 80px;
    text-align: center;
}

#reportsTab .data-table.daily-trend th:nth-child(6),
#reportsTab .data-table.daily-trend td:nth-child(6) {
    min-width: 80px; /* å‡ºå‹¤ç‡åˆ— */
    max-width: 100px;
    text-align: center;
    font-weight: 600;
}

/* ğŸ”¥ æ–°å¢ï¼šå­¦ç”Ÿè€ƒå‹¤ç»Ÿè®¡è¡¨æ ¼åˆ—å®½æ§åˆ¶ */
#reportsTab .data-table.student-stats th:nth-child(1),
#reportsTab .data-table.student-stats td:nth-child(1) {
    min-width: 100px; /* å§“ååˆ— */
    max-width: 150px;
}

#reportsTab .data-table.student-stats th:nth-child(2),
#reportsTab .data-table.student-stats td:nth-child(2) {
    min-width: 80px; /* ä¸“ä¸šåˆ— */
    max-width: 120px;
}

#reportsTab .data-table.student-stats th:nth-child(3),
#reportsTab .data-table.student-stats td:nth-child(3) {
    min-width: 60px; /* å‡ºå‹¤åˆ— */
    max-width: 80px;
    text-align: center;
}

#reportsTab .data-table.student-stats th:nth-child(4),
#reportsTab .data-table.student-stats td:nth-child(4) {
    min-width: 60px; /* ç¼ºå‹¤åˆ— */
    max-width: 80px;
    text-align: center;
}

#reportsTab .data-table.student-stats th:nth-child(5),
#reportsTab .data-table.student-stats td:nth-child(5) {
    min-width: 60px; /* è¯·å‡åˆ— */
    max-width: 80px;
    text-align: center;
}

#reportsTab .data-table.student-stats th:nth-child(6),
#reportsTab .data-table.student-stats td:nth-child(6) {
    min-width: 80px; /* å‡ºå‹¤ç‡åˆ— */
    max-width: 100px;
    text-align: center;
    font-weight: 600;
}

/* ğŸ”¥ æ–°å¢ï¼šè¡¨æ ¼è¡Œæ‚¬åœæ•ˆæœä¼˜åŒ– */
#reportsTab .data-table tr:hover {
    background: var(--light-gray);
}

#reportsTab .data-table tr:last-child td {
    border-bottom: none;
}

/* ğŸ”¥ æ–°å¢ï¼šæ»šåŠ¨æ¡æ ·å¼ä¼˜åŒ– */
#reportsTab .data-table-container::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

#reportsTab .data-table-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

#reportsTab .data-table-container::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

#reportsTab .data-table-container::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* ğŸ”¥ æ–°å¢ï¼šç§»åŠ¨ç«¯ä¼˜åŒ– */
@media (max-width: 768px) {
    #reportsTab .data-table-container {
        margin: 0 -15px; /* ğŸ”¥ ç§»åŠ¨ç«¯æ‰©å±•åˆ°è¾¹ç¼˜ */
        border-radius: 0;
        border-left: none;
        border-right: none;
    }
    
    /* æ¯æ—¥è€ƒå‹¤è¶‹åŠ¿è¡¨æ ¼ç§»åŠ¨ç«¯ä¼˜åŒ– */
    #reportsTab .data-table-container:first-of-type {
        max-height: 250px;
    }
    
    /* å­¦ç”Ÿè€ƒå‹¤ç»Ÿè®¡è¡¨æ ¼ç§»åŠ¨ç«¯ä¼˜åŒ– */
    #reportsTab .data-table-container:last-of-type {
        max-height: 300px;
    }
    
    #reportsTab .data-table {
        font-size: 0.8rem;
    }
    
    #reportsTab .data-table th,
    #reportsTab .data-table td {
        padding: 6px 8px; /* ğŸ”¥ ç§»åŠ¨ç«¯æ›´ç´§å‡‘çš„å†…è¾¹è· */
        min-width: 50px;
    }
    
    #reportsTab .data-table th {
        font-size: 0.7rem;
    }
    
    /* ğŸ”¥ ç§»åŠ¨ç«¯æ¯æ—¥è¶‹åŠ¿è¡¨æ ¼åˆ—å®½è°ƒæ•´ */
    #reportsTab .data-table.daily-trend {
        min-width: 450px;
    }
    
    #reportsTab .data-table.daily-trend th:nth-child(1),
    #reportsTab .data-table.daily-trend td:nth-child(1) {
        min-width: 90px;
        max-width: 100px;
    }
    
    #reportsTab .data-table.daily-trend th:nth-child(2),
    #reportsTab .data-table.daily-trend td:nth-child(2),
    #reportsTab .data-table.daily-trend th:nth-child(3),
    #reportsTab .data-table.daily-trend td:nth-child(3),
    #reportsTab .data-table.daily-trend th:nth-child(4),
    #reportsTab .data-table.daily-trend td:nth-child(4),
    #reportsTab .data-table.daily-trend th:nth-child(5),
    #reportsTab .data-table.daily-trend td:nth-child(5) {
        min-width: 50px;
        max-width: 60px;
    }
    
    #reportsTab .data-table.daily-trend th:nth-child(6),
    #reportsTab .data-table.daily-trend td:nth-child(6) {
        min-width: 70px;
        max-width: 80px;
    }
    
    /* ğŸ”¥ ç§»åŠ¨ç«¯å­¦ç”Ÿç»Ÿè®¡è¡¨æ ¼åˆ—å®½è°ƒæ•´ */
    #reportsTab .data-table.student-stats {
        min-width: 480px;
    }
    
    #reportsTab .data-table.student-stats th:nth-child(1),
    #reportsTab .data-table.student-stats td:nth-child(1) {
        min-width: 80px;
        max-width: 100px;
    }
    
    #reportsTab .data-table.student-stats th:nth-child(2),
    #reportsTab .data-table.student-stats td:nth-child(2) {
        min-width: 70px;
        max-width: 90px;
    }
    
    #reportsTab .data-table.student-stats th:nth-child(3),
    #reportsTab .data-table.student-stats td:nth-child(3),
    #reportsTab .data-table.student-stats th:nth-child(4),
    #reportsTab .data-table.student-stats td:nth-child(4),
    #reportsTab .data-table.student-stats th:nth-child(5),
    #reportsTab .data-table.student-stats td:nth-child(5) {
        min-width: 50px;
        max-width: 60px;
    }
    
    #reportsTab .data-table.student-stats th:nth-child(6),
    #reportsTab .data-table.student-stats td:nth-child(6) {
        min-width: 70px;
        max-width: 80px;
    }
}

@media (max-width: 480px) {
    #reportsTab .data-table-container:first-of-type {
        max-height: 200px;
    }
    
    #reportsTab .data-table-container:last-of-type {
        max-height: 250px;
    }
    
    #reportsTab .data-table {
        font-size: 0.75rem;
    }
    
    #reportsTab .data-table th,
    #reportsTab .data-table td {
        padding: 5px 6px;
        min-width: 45px;
    }
    
    #reportsTab .data-table th {
        font-size: 0.65rem;
    }
    
    /* ğŸ”¥ è¶…å°å±å¹•æ¯æ—¥è¶‹åŠ¿è¡¨æ ¼ä¼˜åŒ– */
    #reportsTab .data-table.daily-trend {
        min-width: 400px;
    }
    
    #reportsTab .data-table.daily-trend th:nth-child(1),
    #reportsTab .data-table.daily-trend td:nth-child(1) {
        min-width: 80px;
        max-width: 90px;
    }
    
    #reportsTab .data-table.daily-trend th:nth-child(2),
    #reportsTab .data-table.daily-trend td:nth-child(2),
    #reportsTab .data-table.daily-trend th:nth-child(3),
    #reportsTab .data-table.daily-trend td:nth-child(3),
    #reportsTab .data-table.daily-trend th:nth-child(4),
    #reportsTab .data-table.daily-trend td:nth-child(4),
    #reportsTab .data-table.daily-trend th:nth-child(5),
    #reportsTab .data-table.daily-trend td:nth-child(5) {
        min-width: 45px;
        max-width: 50px;
    }
    
    #reportsTab .data-table.daily-trend th:nth-child(6),
    #reportsTab .data-table.daily-trend td:nth-child(6) {
        min-width: 60px;
        max-width: 70px;
    }
    
    /* ğŸ”¥ è¶…å°å±å¹•å­¦ç”Ÿç»Ÿè®¡è¡¨æ ¼ä¼˜åŒ– */
    #reportsTab .data-table.student-stats {
        min-width: 420px;
    }
    
    #reportsTab .data-table.student-stats th:nth-child(1),
    #reportsTab .data-table.student-stats td:nth-child(1) {
        min-width: 70px;
        max-width: 80px;
    }
    
    #reportsTab .data-table.student-stats th:nth-child(2),
    #reportsTab .data-table.student-stats td:nth-child(2) {
        min-width: 60px;
        max-width: 70px;
    }
    
    #reportsTab .data-table.student-stats th:nth-child(3),
    #reportsTab .data-table.student-stats td:nth-child(3),
    #reportsTab .data-table.student-stats th:nth-child(4),
    #reportsTab .data-table.student-stats td:nth-child(4),
    #reportsTab .data-table.student-stats th:nth-child(5),
    #reportsTab .data-table.student-stats td:nth-child(5) {
        min-width: 45px;
        max-width: 50px;
    }
    
    #reportsTab .data-table.student-stats th:nth-child(6),
    #reportsTab .data-table.student-stats td:nth-child(6) {
        min-width: 60px;
        max-width: 70px;
    }
}

/* ğŸ”¥ æ–°å¢ï¼šæ»šåŠ¨æç¤º */
#reportsTab .data-table-container::after {
    content: 'â† å·¦å³æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š â†’';
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 5;
}

#reportsTab .data-table-container:hover::after {
    opacity: 1;
}

/* ğŸ”¥ ç§»åŠ¨ç«¯æ»šåŠ¨æç¤º */
@media (max-width: 768px) {
    #reportsTab .data-table-container::after {
        content: 'â† æ»‘åŠ¨ â†’';
        font-size: 0.65rem;
        padding: 3px 6px;
        bottom: 6px;
        right: 6px;
    }
}

/* ğŸ”¥ æ–°å¢ï¼šæ·±è‰²æ¨¡å¼é€‚é… */
@media (prefers-color-scheme: dark) {
    #reportsTab .data-table-container {
        background: var(--card-bg);
        border-color: var(--border-color);
    }
    
    #reportsTab .data-table {
        background: var(--card-bg);
    }
    
    #reportsTab .data-table th,
    #reportsTab .data-table td {
        border-bottom-color: var(--border-color);
        color: var(--text-color);
    }
    
    #reportsTab .data-table th {
        background: var(--card-hover-bg);
        color: var(--text-color);
    }
    
    #reportsTab .data-table tr:hover {
        background: var(--card-hover-bg);
    }
    
    #reportsTab .data-table-container::-webkit-scrollbar-track {
        background: var(--card-hover-bg);
    }
    
    #reportsTab .data-table-container::-webkit-scrollbar-thumb {
        background: var(--medium-gray);
    }
    
    #reportsTab .data-table-container::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary);
    }
    
    #reportsTab .data-table-container::after {
        background: rgba(13, 17, 23, 0.9);
        color: var(--text-color);
    }
}


/* ===== æ ·å¼æ–‡ä»¶ç»“æŸ ===== */

</style>
</head>
<body>
<div class="container">
    <!-- è¯­è¨€åˆ‡æ¢å™¨ -->
    <div class="language-switcher">
        <button class="lang-btn active" onclick="switchLanguage('zh')" data-lang="zh">ä¸­æ–‡</button>
        <button class="lang-btn" onclick="switchLanguage('en')" data-lang="en">EN</button>
    </div>

    <!-- è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div id="connectionStatus" class="connection-status offline">
        <span data-i18n="status.offline">ğŸ”´ ç¦»çº¿æ¨¡å¼</span>
    </div>

    <!-- å¤´éƒ¨ -->
    <div class="header">
        <h1><span data-i18n="header.title">ğŸ¼ é’å²›è€¶èƒ¡è¿ªæ¢…çº½å› å­¦æ ¡</span></h1>
        <div class="subtitle" data-i18n="header.subtitle">å®æ—¶ç»ƒç´è·Ÿè¸ªç³»ç»Ÿ</div>
    </div>

    <!-- å¯¼èˆªæ ‡ç­¾ -->
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('dashboard')">
            <span data-i18n="nav.dashboard">ğŸ“Š è€ƒå‹¤æ¦‚è§ˆ</span>
        </button>
        <button class="nav-tab" onclick="switchTab('students')">
            <span data-i18n="nav.students">ğŸ‘¥ å­¦ç”Ÿè¯¦æƒ…</span>
        </button>
        <button class="nav-tab" onclick="switchTab('reports')">
            <span data-i18n="nav.reports">ğŸ“ˆ å†å²æŠ¥å‘Š</span>
        </button>
        <button class="nav-tab" onclick="switchTab('sync')">
            <span data-i18n="nav.sync">ğŸ”„ æ•°æ®åŒæ­¥</span>
        </button>
    </div>

    <!-- è€ƒå‹¤æ¦‚è§ˆ -->
    <div id="dashboardTab" class="tab-content">
        <div class="stats-grid">
            <div class="stat-card total">
                <div class="stat-number" id="totalStudents">0</div>
                <div class="stat-label" data-i18n="stats.total">æ€»å­¦ç”Ÿæ•°</div>
                <div class="stat-description" data-i18n="stats.total.desc">å·²ç™»è®°å­¦ç”Ÿ</div>
            </div>
            <div class="stat-card present">
                <div class="stat-number" id="presentCount">0</div>
                <div class="stat-label" data-i18n="stats.present">å‡ºå‹¤</div>
                <div class="stat-description" data-i18n="stats.present.desc">å½“å‰åœ¨ç´æˆ¿</div>
            </div>
            <div class="stat-card absent">
                <div class="stat-number" id="absentCount">0</div>
                <div class="stat-label" data-i18n="stats.absent">ç¼ºå‹¤</div>
                <div class="stat-description" data-i18n="stats.absent.desc">æœªåˆ°/æœªç™»è®°</div>
            </div>
            <div class="stat-card excused">
                <div class="stat-number" id="excusedCount">0</div>
                <div class="stat-label" data-i18n="stats.excused">è¯·å‡</div>
                <div class="stat-description" data-i18n="stats.excused.desc">å·²æ‰¹å‡†è¯·å‡</div>
            </div>
        </div>

        <!-- è¯·å‡ä¿¡æ¯ -->
        <div class="card" id="excuseInfoPanel" style="display:none;">
            <h3 data-i18n="excuse.title">ğŸ“ ä»Šæ—¥è¯·å‡ä¿¡æ¯</h3>
            <div id="excuseInfoContainer"></div>
        </div>

        <!-- å®æ—¶ç»ƒç´çŠ¶æ€ -->
        <div class="card">
            <h3 data-i18n="practice.title">ğŸ¹ å®æ—¶ç»ƒç´çŠ¶æ€</h3>
            <div class="date-picker">
                <span style="color:#666;font-size:14px;">
                    <span data-i18n="practice.current_time">å½“å‰æ—¶é—´ï¼š</span>
                    <span id="currentTime"></span>
                </span>
            </div>
            <!-- ğŸ”¥ ä¿®æ”¹ï¼šç§»é™¤ç‹¬ç«‹çš„ practiceStatusContainerï¼Œç›´æ¥åœ¨è¿™é‡Œæ¸²æŸ“ -->
            <div id="practiceStatusContainer">
                <!-- ç­›é€‰å™¨å’Œç»“æœå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ä»Šæ—¥è€ƒå‹¤å¿«ç…§ï¼ˆä» attendanceRecords è¯»å–ï¼Œå¦‚æ— åˆ™æç¤ºï¼‰ -->
        <div class="card">
            <h3 data-i18n="attendance.title">ğŸ“… ä»Šæ—¥è€ƒå‹¤å¿«ç…§</h3>
            <div class="date-picker">
                <label data-i18n="attendance.select_date">é€‰æ‹©æ—¥æœŸï¼š</label>
                <input type="date" id="dateSelect" class="date-input" onchange="loadAttendanceData()">
            </div>
            <div id="todaySnapshot" class="loading">
                <div class="spinner"></div>
                <div class="loading-text" data-i18n="msg.loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <!-- å­¦ç”Ÿè¯¦æƒ… -->
    <div id="studentsTab" class="tab-content" style="display:none;">
        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label" data-i18n="filter.major">ä¸“ä¸šç­›é€‰</label>
                    <select id="majorFilter" class="filter-select" onchange="filterStudents()">
                        <option value="" data-i18n="filter.all_majors">æ‰€æœ‰ä¸“ä¸š</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label" data-i18n="filter.grade">å¹´çº§ç­›é€‰</label>
                    <select id="gradeFilter" class="filter-select" onchange="filterStudents()">
                        <option value="" data-i18n="filter.all_grades">æ‰€æœ‰å¹´çº§</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label" data-i18n="filter.status">è€ƒå‹¤çŠ¶æ€</label>
                    <select id="statusFilter" class="filter-select" onchange="filterStudents()">
                        <option value="" data-i18n="filter.all_status">æ‰€æœ‰çŠ¶æ€</option>
                        <option value="present" data-i18n="status.present">å‡ºå‹¤</option>
                        <option value="absent" data-i18n="status.absent">ç¼ºå‹¤</option>
                        <option value="excused" data-i18n="status.excused">è¯·å‡</option>
                        <option value="pending" data-i18n="status.pending">å¾…è€ƒå‹¤</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label" data-i18n="filter.search">æœç´¢å­¦ç”Ÿ</label>
                    <input type="text" id="studentSearch" class="filter-input"
                           data-i18n-placeholder="filter.search_placeholder"
                           placeholder="è¾“å…¥å­¦ç”Ÿå§“å..." oninput="filterStudents()">
                </div>
            </div>
        </div>
        <div id="studentList" class="student-grid"></div>
    </div>

    <!-- å†å²æŠ¥å‘Š -->
    <div id="reportsTab" class="tab-content" style="display:none;">
        <div class="card">
            <h3 data-i18n="report.title">ğŸ“ˆ è€ƒå‹¤å†å²åˆ†æ</h3>
            <div class="date-picker">
                <label data-i18n="report.start_date">å¼€å§‹æ—¥æœŸï¼š</label>
                <input type="date" id="startDate" class="date-input">
                <label data-i18n="report.end_date">ç»“æŸæ—¥æœŸï¼š</label>
                <input type="date" id="endDate" class="date-input">
                <button class="btn btn-primary" onclick="generateReport()">
                    <span>ğŸ“Š</span><span data-i18n="btn.generate_report">ç”ŸæˆæŠ¥å‘Š</span>
                </button>
            </div>
            <div id="reportContent">
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“Š</div>
                    <div class="empty-state-title" data-i18n="report.empty.title">é€‰æ‹©æ—¥æœŸèŒƒå›´ç”ŸæˆæŠ¥å‘Š</div>
                    <div class="empty-state-description" data-i18n="report.empty.desc">é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸï¼Œç„¶åç‚¹å‡»"ç”ŸæˆæŠ¥å‘Š"</div>
                </div>
            </div>
        </div>
    </div>

    <!-- åŒæ­¥ä¿¡æ¯ -->
    <div id="syncTab" class="tab-content" style="display:none;">
        <div class="card">
            <h3 data-i18n="sync.title">ğŸ”„ æ•°æ®åŒæ­¥ç®¡ç†</h3>
            <div class="card success" id="syncStatus">
                <h4 data-i18n="sync.status">åŒæ­¥çŠ¶æ€</h4>
                <p id="syncStatusText" data-i18n="sync.checking">æ­£åœ¨æ£€æŸ¥è¿æ¥çŠ¶æ€...</p>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="forceSync()">
                        <span>ğŸ”„</span><span data-i18n="btn.force_sync">å¼ºåˆ¶åŒæ­¥</span>
                    </button>
                    <button class="btn btn-warning" onclick="clearLocalCache()">
                        <span>ğŸ—‘ï¸</span><span data-i18n="btn.clear_cache">æ¸…é™¤ç¼“å­˜</span>
                    </button>
                </div>
            </div>
            <div class="card">
                <h4 data-i18n="sync.logs">ğŸ“‹ åŒæ­¥æ—¥å¿—</h4>
                <div id="syncLogs" style="max-height:300px;overflow-y:auto;font-family:monospace;font-size:12px;white-space:pre-line;"></div>
            </div>
        </div>
    </div>
</div>

<!-- å­¦ç”Ÿè¯¦æƒ…æ¨¡æ€ -->
<div id="studentDetailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="studentDetailTitle" data-i18n="student.detail.title">å­¦ç”Ÿè¯¦æƒ…</h3>
            <button class="modal-close" onclick="closeModal('studentDetailModal')">&times;</button>
        </div>
        <div id="studentDetailContent"></div>
    </div>
</div>

<script>
/* =============================
   1. å›½é™…åŒ–é…ç½®ï¼ˆä¿ç•™åŸç»“æ„ï¼‰
   ============================= */
const i18n = {
  zh: {
    // å¤´éƒ¨
    'header.title': 'ğŸ¼ é’å²›è€¶èƒ¡è¿ªæ¢…çº½å› å­¦æ ¡',
    'header.subtitle': 'å®æ—¶ç»ƒç´è·Ÿè¸ªç³»ç»Ÿ',
    
    // å¯¼èˆª
    'nav.dashboard': 'ğŸ“Š è€ƒå‹¤æ¦‚è§ˆ',
    'nav.students': 'ğŸ‘¥ å­¦ç”Ÿè¯¦æƒ…', 
    'nav.reports': 'ğŸ“ˆ å†å²æŠ¥å‘Š',
    'nav.sync': 'ğŸ”„ æ•°æ®åŒæ­¥',
    
    // è¿æ¥çŠ¶æ€
    'status.online': 'ğŸŸ¢ å·²è¿æ¥',
    'status.offline': 'ğŸ”´ ç¦»çº¿æ¨¡å¼',
    'status.syncing': 'ğŸŸ¡ åŒæ­¥ä¸­',
    
    // è€ƒå‹¤çŠ¶æ€
    'status.present': 'å‡ºå‹¤',
    'status.absent': 'ç¼ºå‹¤',
    'status.excused': 'è¯·å‡',
    'status.pending': 'å¾…è€ƒå‹¤',
    'status.low_efficiency': 'ä½æ•ˆ',


    // ç»Ÿè®¡
    'stats.total': 'æ€»å­¦ç”Ÿæ•°',
    'stats.total.desc': 'å·²ç™»è®°å­¦ç”Ÿ',
    'stats.present': 'å‡ºå‹¤',
    'stats.present.desc': 'å½“å‰åœ¨ç´æˆ¿',
    'stats.absent': 'ç¼ºå‹¤',
    'stats.absent.desc': 'æœªåˆ°/æœªç™»è®°',
    'stats.excused': 'è¯·å‡',
    'stats.excused.desc': 'å·²æ‰¹å‡†è¯·å‡',
    
    // ç»ƒç´ç›¸å…³
    'practice.title': 'ğŸ¹ å®æ—¶ç»ƒç´çŠ¶æ€',
    'practice.current_time': 'å½“å‰æ—¶é—´ï¼š',
    'practice.empty.title': 'å½“å‰æ²¡æœ‰å­¦ç”Ÿåœ¨ç»ƒç´',
    'practice.empty.desc.weekday': 'ç­‰å¾…å­¦ç”Ÿå¼€å§‹ç»ƒç´',
    'practice.in_slot': 'æ®µå†…',
    'practice.out_slot': 'æ®µå¤–',
    
    // è€ƒå‹¤ç›¸å…³
    'attendance.title': 'ğŸ“… ä»Šæ—¥è€ƒå‹¤å¿«ç…§',
    'attendance.select_date': 'é€‰æ‹©æ—¥æœŸï¼š',
    'attendance.history': 'æœ€è¿‘7å¤©è€ƒå‹¤',
    'attendance.rate': 'å‡ºå‹¤ç‡',
    'attendance.detail.suffix': 'è€ƒå‹¤è¯¦æƒ…',
    'attendance.summary': 'è€ƒå‹¤æ±‡æ€»',
    'attendance.detailed_records': 'è¯¦ç»†è®°å½•',
    'attendance.remarks': 'å¤‡æ³¨',
    
    // ç­›é€‰å™¨
    'filter.major': 'ä¸“ä¸šç­›é€‰',
    'filter.grade': 'å¹´çº§ç­›é€‰',
    'filter.status': 'è€ƒå‹¤çŠ¶æ€',
    'filter.search': 'æœç´¢å­¦ç”Ÿ',
    'filter.all_majors': 'æ‰€æœ‰ä¸“ä¸š',
    'filter.all_grades': 'æ‰€æœ‰å¹´çº§',
    'filter.all_status': 'æ‰€æœ‰çŠ¶æ€',
    'filter.search_placeholder': 'è¾“å…¥å­¦ç”Ÿå§“å...',
    'filter.no_results': 'æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å­¦ç”Ÿ',
    'filter.try_different': 'è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶',
    'filter.clear': 'æ¸…é™¤',
    
    // å­¦ç”Ÿä¿¡æ¯
    'student.name': 'å§“å',
    'student.major': 'ä¸“ä¸š',
    'student.grade': 'å¹´çº§',
    'student.room': 'æ‰€åœ¨ç´æˆ¿',
    'student.time_slot': 'æ—¶é—´æ®µ',
    'student.practice_duration': 'ç»ƒç´æ—¶é•¿',
    'student.start_time': 'æœ€è¿‘å¼€å§‹',
    'student.not_in_room': 'ä¸åœ¨ç´æˆ¿',
    'student.not_started': 'æœªå¼€å§‹',
    'student.not_set': 'æœªè®¾ç½®',
    'student.unknown_major': 'æœªçŸ¥ä¸“ä¸š',
    'student.detail.title': 'å­¦ç”Ÿè¯¦æƒ…',
    'student.today_attendance': 'ä»Šæ—¥è€ƒå‹¤',
    'student.today_practice': 'ä»Šæ—¥ç»ƒç´æ—¶é•¿',
    
    // æ—¶é—´ç›¸å…³
    'time.hours': 'å°æ—¶',
    'time.minutes': 'åˆ†é’Ÿ',
    'time.seconds': 'ç§’',
    'time.no_practice': '0åˆ†é’Ÿ',
    
    // è¯·å‡ç›¸å…³
    'excuse.title': 'ğŸ“ ä»Šæ—¥è¯·å‡ä¿¡æ¯',
    'excuse.reason': 'è¯·å‡åŸå› ',
    'excuse.duration_text': 'è¯·å‡æ—¶é•¿',
    'excuse.end_date': 'ç»“æŸæ—¥æœŸ',
    'excuse.not_filled': 'æœªå¡«å†™',
    
    // æŠ¥å‘Šç›¸å…³
    'report.title': 'ğŸ“ˆ è€ƒå‹¤å†å²åˆ†æ',
    'report.start_date': 'å¼€å§‹æ—¥æœŸï¼š',
    'report.end_date': 'ç»“æŸæ—¥æœŸï¼š',
    'report.empty.title': 'é€‰æ‹©æ—¥æœŸèŒƒå›´ç”ŸæˆæŠ¥å‘Š',
    'report.empty.desc': 'é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸï¼Œç„¶åç‚¹å‡»"ç”ŸæˆæŠ¥å‘Š"',
    'report.analysis_title': 'ğŸ“Š è€ƒå‹¤åˆ†ææŠ¥å‘Š',
    'report.period': 'ç»Ÿè®¡å‘¨æœŸ',
    'report.to': 'è‡³',
    'report.days': 'å¤©',
    'report.participants': 'å‚ä¸å­¦ç”Ÿ',
    'report.people': 'äºº',
    'report.daily_trend': 'ğŸ“ˆ æ¯æ—¥è€ƒå‹¤è¶‹åŠ¿',
    'report.date': 'æ—¥æœŸ',
    'report.total': 'åˆè®¡',
    'report.student_stats': 'ğŸ‘¥ å­¦ç”Ÿè€ƒå‹¤ç»Ÿè®¡',
    'report.regenerate': 'é‡æ–°ç”Ÿæˆ',
    
    // åŒæ­¥ç›¸å…³
    'sync.title': 'ğŸ”„ æ•°æ®åŒæ­¥ç®¡ç†',
    'sync.status': 'åŒæ­¥çŠ¶æ€',
    'sync.checking': 'æ­£åœ¨æ£€æŸ¥è¿æ¥çŠ¶æ€...',
    'sync.logs': 'ğŸ“‹ åŒæ­¥æ—¥å¿—',
    'sync.force_sync': 'å¼ºåˆ¶åŒæ­¥',
    
    // æŒ‰é’®
    'btn.generate_report': 'ç”ŸæˆæŠ¥å‘Š',
    'btn.force_sync': 'å¼ºåˆ¶åŒæ­¥',
    'btn.clear_cache': 'æ¸…é™¤ç¼“å­˜',
    
    // æ¶ˆæ¯æç¤º
    'msg.loading': 'åŠ è½½ä¸­...',
    'msg.no_data': 'æš‚æ— æ•°æ®',
    'msg.select_dates': 'è¯·é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸ',
    'msg.date_range_error': 'å¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸ',
    'msg.sync_required': 'éœ€è¦ç½‘ç»œè¿æ¥æ‰èƒ½åŒæ­¥æ•°æ®',
    'msg.clear_cache_confirm': 'ç¡®å®šè¦æ¸…é™¤æœ¬åœ°ç¼“å­˜å—ï¼Ÿ',
    'msg.cache_cleared': 'æœ¬åœ°ç¼“å­˜å·²æ¸…é™¤',
    
    // ç©ºçŠ¶æ€
    'empty.no_students': 'æš‚æ— å­¦ç”Ÿæ•°æ®',
    'empty.no_attendance': 'è¿˜æ²¡æœ‰è€ƒå‹¤è®°å½•',
    'empty.load_failed': 'åŠ è½½å¤±è´¥'
  },
  
  en: {
    // å¤´éƒ¨
    'header.title': 'ğŸ¼ Qingdao Yehudi Menuhin School',
    'header.subtitle': 'Real-time Practice Tracking System',
    
    // å¯¼èˆª
    'nav.dashboard': 'ğŸ“Š Attendance Overview',
    'nav.students': 'ğŸ‘¥ Student Details',
    'nav.reports': 'ğŸ“ˆ Historical Reports',
    'nav.sync': 'ğŸ”„ Data Sync',
    
    // è¿æ¥çŠ¶æ€
    'status.online': 'ğŸŸ¢ Connected',
    'status.offline': 'ğŸ”´ Offline Mode',
    'status.syncing': 'ğŸŸ¡ Syncing',
    
    // è€ƒå‹¤çŠ¶æ€
    'status.present': 'Present',
    'status.absent': 'Absent',
    'status.excused': 'Excused',
    'status.pending': 'Pending',
    'status.low_efficiency': 'Low Efficiency',
    
    // ç»Ÿè®¡
    'stats.total': 'Total Students',
    'stats.total.desc': 'Registered Students',
    'stats.present': 'Present',
    'stats.present.desc': 'Currently in Rooms',
    'stats.absent': 'Absent',
    'stats.absent.desc': 'Not Present/Registered',
    'stats.excused': 'Excused',
    'stats.excused.desc': 'Approved Leave',
    
    // ç»ƒç´ç›¸å…³
    'practice.title': 'ğŸ¹ Real-time Practice Status',
    'practice.current_time': 'Current Time: ',
    'practice.empty.title': 'No students currently practicing',
    'practice.empty.desc.weekday': 'Waiting for students to start practicing',    
    'practice.in_slot': 'In-Slot',
    'practice.out_slot': 'Out-Slot',
    // è€ƒå‹¤ç›¸å…³
    'attendance.title': 'ğŸ“… Today\'s Attendance Snapshot',
    'attendance.select_date': 'Select Date: ',
    'attendance.history': 'Last 7 Days Attendance',
    'attendance.rate': 'Attendance Rate',
    'attendance.detail.suffix': ' Attendance Details',
    'attendance.summary': 'Attendance Summary',
    'attendance.detailed_records': 'Detailed Records',
    'attendance.remarks': 'Remarks',

    
    // ç­›é€‰å™¨
    'filter.major': 'Major Filter',
    'filter.grade': 'Grade Filter',
    'filter.status': 'Attendance Status',
    'filter.search': 'Search Students',
    'filter.all_majors': 'All Majors',
    'filter.all_grades': 'All Grades',
    'filter.all_status': 'All Status',
    'filter.search_placeholder': 'Enter student name...',
    'filter.no_results': 'No matching students found',
    'filter.try_different': 'Please try adjusting filter criteria',
    'filter.clear': 'Clear',
    
    // å­¦ç”Ÿä¿¡æ¯
    'student.name': 'Name',
    'student.major': 'Major',
    'student.grade': 'Grade',
    'student.room': 'Room',
    'student.time_slot': 'Time Slot',
    'student.practice_duration': 'Practice Duration',
    'student.start_time': 'Recent Start',
    'student.not_in_room': 'Not in Room',
    'student.not_started': 'Not Started',
    'student.not_set': 'Not Set',
    'student.unknown_major': 'Unknown Major',
    'student.detail.title': 'Student Details',
    'student.today_attendance': 'Today\'s Attendance',
    'student.today_practice': 'Today\'s Practice Time',
    
    // æ—¶é—´ç›¸å…³
    'time.hours': 'h',
    'time.minutes': 'min',
    'time.seconds': 's',
    'time.no_practice': '0 min',
    
    // è¯·å‡ç›¸å…³
    'excuse.title': 'ğŸ“ Today\'s Leave Information',
    'excuse.reason': 'Leave Reason',
    'excuse.duration_text': 'Leave Duration',
    'excuse.end_date': 'End Date',
    'excuse.not_filled': 'Not Filled',
    
    // æŠ¥å‘Šç›¸å…³
    'report.title': 'ğŸ“ˆ Attendance History Analysis',
    'report.start_date': 'Start Date: ',
    'report.end_date': 'End Date: ',
    'report.empty.title': 'Select date range to generate report',
    'report.empty.desc': 'Choose start and end dates, then click "Generate Report"',
    'report.analysis_title': 'ğŸ“Š Attendance Analysis Report',
    'report.period': 'Statistical Period',
    'report.to': 'to',
    'report.days': ' days',
    'report.participants': 'Participating Students',
    'report.people': ' students',
    'report.daily_trend': 'ğŸ“ˆ Daily Attendance Trend',
    'report.date': 'Date',
    'report.total': 'Total',
    'report.student_stats': 'ğŸ‘¥ Student Attendance Statistics',
    'report.regenerate': 'Regenerate',
    
    // åŒæ­¥ç›¸å…³
    'sync.title': 'ğŸ”„ Data Sync Management',
    'sync.status': 'Sync Status',
    'sync.checking': 'Checking connection status...',
    'sync.logs': 'ğŸ“‹ Sync Logs',
    'sync.force_sync': 'Force Sync',
    
    // æŒ‰é’®
    'btn.generate_report': 'Generate Report',
    'btn.force_sync': 'Force Sync',
    'btn.clear_cache': 'Clear Cache',
    
    // æ¶ˆæ¯æç¤º
    'msg.loading': 'Loading...',
    'msg.no_data': 'No Data',
    'msg.select_dates': 'Please select start and end dates',
    'msg.date_range_error': 'Start date cannot be later than end date',
    'msg.sync_required': 'Network connection required for data sync',
    'msg.clear_cache_confirm': 'Are you sure you want to clear local cache?',
    'msg.cache_cleared': 'Local cache cleared',
    
    // ç©ºçŠ¶æ€
    'empty.no_students': 'No student data available',
    'empty.no_attendance': 'No attendance records yet',
    'empty.load_failed': 'Loading failed'
  }
};


let currentLanguage = 'zh';
function t(key,fallback=''){const pack=i18n[currentLanguage]||{};return pack[key]||fallback||key;}
function switchLanguage(lang){
  if(lang===currentLanguage)return;
  currentLanguage=lang;
  document.querySelectorAll('.lang-btn').forEach(b=>{
    b.classList.toggle('active', b.getAttribute('data-lang')===lang);
  });
  updatePageLanguage();
  localStorage.setItem('preferred_language',lang);
  addSyncLog(`ğŸŒ ${lang==='zh'?'è¯­è¨€åˆ‡æ¢ä¸ºä¸­æ–‡':'Language switched to English'}`);
  refreshCurrentTabContent();
}

function updatePageLanguage(){
  const pack=i18n[currentLanguage]||{};
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const k=el.getAttribute('data-i18n');
    if(pack[k]) el.textContent=pack[k];
  });
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{
    const k=el.getAttribute('data-i18n-placeholder');
    if(pack[k]) el.placeholder=pack[k];
  });
  document.title = currentLanguage==='zh'?'é’å²›æ¢…çº½å› éŸ³ä¹å­¦æ ¡ç»ƒç´è·Ÿè¸ªç³»ç»Ÿ':'Qingdao Menuhin Music School Practice Tracking System';
}


/* =============================
   2. Firebaseï¼ˆä½¿ç”¨ç´æˆ¿ç³»ç»ŸåŒé…ç½®ï¼‰
   ============================= */
const firebaseConfig = {
  apiKey: "AIzaSyBfRjrAKsVUAHBl5WbBl96YONrkRe1UWUo",
  authDomain: "menuhin-studio-system.firebaseapp.com",
  databaseURL: "https://menuhin-studio-system-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "menuhin-studio-system",
  storageBucket: "menuhin-studio-system.firebasestorage.app",
  messagingSenderId: "218592951152",
  appId: "1:218592951152:web:650d080726b6c44f5a2db5",
  measurementId: "G-P49SZQTLT7"
};

let database=null;
let isOnline=false;

/* =============================
   3. æ•°æ®ç»“æ„ï¼ˆç²¾ç®€ç‰ˆï¼‰
   ============================= */
let rooms=[];                    // æ¥è‡ªç´æˆ¿ç³»ç»Ÿ
let studentDatabase={};          // { major: [ {name, grade?} or string ] }
let excuseData={};               // excuseData[YYYY-MM-DD][studentName] = { reason, ... }
let attendanceRecordsCache={};   // attendanceRecords[date] => remote snapshot
let realTimePracticeMap={};      // { studentName: {room,startTime,currentSec} } (æ´¾ç”Ÿ)
let syncLogs=[];
let currentTab='dashboard';
// ==== ç»ƒç´å†å²ç»Ÿè®¡æ–°å¢ï¼ˆæ—¶æ®µå†… / æ—¶æ®µå¤–ï¼‰ ====
let studentTimeSlots = {};                 // ä»åŒé¡¹ç›® Firebase è¯»å–çš„å­¦ç”Ÿç»ƒç´æ—¶é—´æ®µ
let dailyPracticeRecords = {};            // { dateKey: { student: { inSlot,outSlot,totalSessions,sessions[],lastUpdated }} }
let practiceSessionTracker = new Map();   // å½“å‰è¿›è¡Œä¸­çš„ç»ƒç´ä¼šè¯
let lastPracticeSessionSweep = 0;
const PRACTICE_UPDATE_INTERVAL_MS = 60000; // æ¯ 60 ç§’åˆ·æ–°ä¼šè¯ç´¯è®¡

/* ==== è¡¥ä¸ï¼šç¼ºå¤±çš„é€šç”¨è¾…åŠ©å‡½æ•°ï¼ˆcloseModal / getLastNDates / getStatusClassSimpleï¼‰ ==== */
/**
 * è·å–æœ€è¿‘ n å¤©çš„æ—¥æœŸæ•°ç»„ï¼ˆå«ä»Šå¤©ï¼‰ï¼Œæ ¼å¼ï¼šYYYY-MM-DD
 * @param {number} n - å¤©æ•°
 * @param {boolean} includeToday - æ˜¯å¦åŒ…å«ä»Šå¤©
 * @param {'asc'|'desc'} order - è¿”å›é¡ºåºï¼ˆascï¼šä»æ—©åˆ°æ™šï¼›descï¼šä»æ™šåˆ°æ—©ï¼‰
 */
if (typeof getLastNDates !== 'function') {
  function getLastNDates(n, includeToday = true, order = 'asc') {
    const today = new Date();
    const list = [];
    for (let i = 0; i < n; i++) {
      const offset = includeToday ? i : (i + 1);
      const d = new Date(today.getFullYear(), today.getMonth(), today.getDate() - (n - 1 - offset));
      const iso = d.toISOString().slice(0, 10);
      list.push(iso);
    }
    if (order === 'desc') list.reverse();
    return list;
  }
}

/**
 * å…³é—­æ¨¡æ€æ¡†çš„å®‰å…¨å‡½æ•°
 * å¸¸è§è°ƒç”¨å½¢å¼ï¼šcloseModal('studentDetailModal') æˆ–æŸäº›æ—§ä»£ç ç›´æ¥ closeModal()
 */
function closeModal(id) {
    const candidateIds = id ? [id] : ['studentDetailModal', 'studentListModal', 'queueStudentModal'];
    let hasClosedModal = false;
    
    candidateIds.forEach(cid => {
        const el = document.getElementById(cid);
        if (el && el.classList.contains('show')) {
            // æ·»åŠ éšè—åŠ¨ç”»ç±»
            el.classList.add('hiding');
            el.classList.remove('show');
            hasClosedModal = true;
            
            // ç­‰å¾…åŠ¨ç”»å®Œæˆåå†éšè—
            setTimeout(() => {
                if (el.classList.contains('hiding')) {
                    el.style.display = 'none';
                    el.classList.remove('hiding');
                }
            }, 300); // ä¸ CSS transition æ—¶é—´ä¸€è‡´
        }
    });
    
    // å¦‚æœå…³é—­äº†æ¨¡æ€æ¡†ï¼Œæ¢å¤èƒŒæ™¯æ»šåŠ¨
    if (hasClosedModal) {
        document.body.classList.remove('modal-open');
    }
}


/**
 * ç®€å•çŠ¶æ€ -> CSS classï¼ˆç”¨äºå½©è‰²æ ‡è®°æ—¶é—´çº¿ / å°åœ†ç‚¹ï¼‰
 * å¯æŒ‰è‡ªå·±ç°æœ‰çš„æ ·å¼ç³»ç»Ÿè°ƒæ•´
 */
if (typeof getStatusClassSimple !== 'function') {
  function getStatusClassSimple(status) {
    switch (status) {
      case 'present':
      case 'practicing':
        return 'present';
      case 'low_efficiency':
        return 'low_efficiency';
      case 'absent':
        return 'absent';
      case 'excused':
        return 'excused';
      case 'under_review':
      case 'preparing':
        return 'under_review';
      default:
        return 'unknown';
    }
  }
}

/* è‹¥ formatDate åœ¨æœ¬é¡µé¢æœªå®ç°ï¼Œä¹Ÿè¡¥ä¸€ä¸ªæœ€ç®€ç‰ˆæœ¬ï¼ˆé¿å… formatDate æœªå®šä¹‰æŠ¥é”™ï¼‰ */
if (typeof formatDate !== 'function') {
  function formatDate(d) {
    if (!(d instanceof Date)) d = new Date(d);
    return d.toISOString().slice(0, 10);
  }
}

/* =============================
   4. åˆå§‹åŒ–
   ============================= */
document.addEventListener('DOMContentLoaded',()=>{
  const saved=localStorage.getItem('preferred_language');
  if(saved) currentLanguage=saved;
  updatePageLanguage();
  initFirebase();
  initClock();
  const today=formatDate(new Date());
  document.getElementById('dateSelect').value=today;
  addSyncLog('ğŸš€ ç³»ç»Ÿå¯åŠ¨');
});
// ä¿®æ”¹ç‚¹å‡»èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†çš„äº‹ä»¶ç›‘å¬
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('modal') && e.target.classList.contains('show')) {
        if (e.target.id === 'attendanceDetailModal') {
            closeAttendanceDetailModal();
        } else {
            closeModal(e.target.id);
        }
    }
});

// ä¿®æ”¹ ESC é”®å…³é—­æ¨¡æ€æ¡†
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const openModals = document.querySelectorAll('.modal.show');
        if (openModals.length > 0) {
            openModals.forEach(modal => {
                if (modal.id === 'attendanceDetailModal') {
                    closeAttendanceDetailModal();
                } else {
                    closeModal(modal.id);
                }
            });
        }
    }
});


/* =============================
   5. Firebase åˆå§‹åŒ–ä¸ç›‘å¬
   ============================= */
function initFirebase(){
  try{
    firebase.initializeApp(firebaseConfig);
    database=firebase.database();
    database.ref('.info/connected').on('value',snap=>{
      isOnline = snap.val()===true;
      updateConnectionStatus();
      if(isOnline){
        addSyncLog('âœ… å·²è¿æ¥äº‘ç«¯');
        // åˆå§‹åŠ è½½
        loadAllCoreData();
      }else{
        addSyncLog('âš ï¸ å·²ç¦»çº¿');
      }
    });
    // ç›‘å¬ï¼šrooms
    database.ref('rooms').on('value',snap=>{
      const val=snap.val();
      if(Array.isArray(val)){
        rooms=val;
        buildRealTimePracticeFromRooms();
        if(currentTab==='dashboard') renderPracticeArea();
        updateStatsPanel();
      }
    });
    // ç›‘å¬ï¼šstudentDatabase
    database.ref('studentDatabase').on('value',snap=>{
      const val=snap.val();
      if(val && typeof val==='object'){
        studentDatabase=val;
        populateFilters();
        if(currentTab==='students') renderStudentList();
        updateStatsPanel();
      }
    });
    // ç›‘å¬ï¼šexcuseData
    database.ref('excuseData').on('value',snap=>{
      const val=snap.val();
      if(val && typeof val==='object'){
        excuseData=val;
        if(currentTab==='dashboard') renderExcusePanel();
        updateStatsPanel();
      }
    });
    // å­¦ç”Ÿæ—¶é—´æ®µï¼ˆç”¨äºæ—¶æ®µå†…/å¤–ç»Ÿè®¡ï¼‰
    database.ref('studentTimeSlots').on('value', snap=>{
      studentTimeSlots = snap.val() || {};
      addSyncLog('ğŸ“¥ å·²åŒæ­¥ studentTimeSlots');
    });

    // è€ƒå‹¤è®°å½•ï¼ˆä»…åŠ è½½ä»Šæ—¥ï¼Œå…¶ä»–æŒ‰éœ€åŠ è½½ï¼‰
    const today=formatDate(new Date());
    database.ref(`attendanceRecords/${today}`).on('value',snap=>{
      attendanceRecordsCache[today]=snap.val()||null;
      if(document.getElementById('dateSelect').value===today && currentTab==='dashboard'){
        renderAttendanceSnapshot(today);
      }
    });
  }catch(e){
    console.error('Firebase init error',e);
    addSyncLog('âŒ Firebase åˆå§‹åŒ–å¤±è´¥: '+e.message);
  }
}

/* =============================
   6. åŸºç¡€å·¥å…·
   ============================= */
function addSyncLog(msg){
  const time=new Date().toLocaleString();
  syncLogs.unshift(`[${time}] ${msg}`);
  if(syncLogs.length>300) syncLogs.length=300;
  const box=document.getElementById('syncLogs');
  if(box){
    box.textContent=syncLogs.join('\n');
  }
}
function updateConnectionStatus(){
  const el=document.getElementById('connectionStatus');
  if(!el) return;
  if(isOnline){
    el.className='connection-status online';
    el.innerHTML='<span>'+t('status.online','å·²è¿æ¥')+'</span>';
  }else{
    el.className='connection-status offline';
    el.innerHTML='<span>'+t('status.offline','ç¦»çº¿æ¨¡å¼')+'</span>';
  }
}
function formatDate(d){
  const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),day=String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}
function initClock(){
  function run(){
    const now=new Date();
    document.getElementById('currentTime').textContent=now.toLocaleString(currentLanguage==='zh'?'zh-CN':'en-US');
    setTimeout(run,1000);
  }
  run();
}

/* =============================
   7. æ•°æ®æ´¾ç”Ÿï¼šå®æ—¶ç»ƒç´
   ============================= */
function buildRealTimePracticeFromRooms(){
  const now=Date.now();
  const newMap={};
  const activeSessionIds=new Set();

  rooms.forEach(r=>{
    if(r && r.student && r.registerTime){
      const reg=Number(r.registerTime);
      if(!isNaN(reg) && reg>0 && (now-reg)<12*3600*1000){
        newMap[r.student]={
          room:r.name,
          startTime:reg,
          currentSec:Math.max(0,Math.floor((now-reg)/1000))
        };
        const sid = `${r.student}__${r.name}__${r.registerTime}`;
        activeSessionIds.add(sid);
        if(!practiceSessionTracker.has(sid)){
          startPracticeSession(r.student, r.name, r.registerTime);
        }
      }
    }
  });

  // ç»“æŸå·²ç»ä¸å­˜åœ¨çš„ä¼šè¯
  for(const [sid, sess] of practiceSessionTracker.entries()){
    if(!activeSessionIds.has(sid)){
      endPracticeSession(sid, Date.now(), 'æˆ¿é—´çŠ¶æ€å˜æ›´ç»“æŸ');
    }
  }

  realTimePracticeMap=newMap;
}

/* =============================
   8. ç»Ÿè®¡é¢æ¿æ›´æ–°
   ============================= */
function updateStatsPanel(){
  const allStudents = flattenStudents();
  const total=allStudents.length;
  // å‡ºå‹¤ï¼šå½“å‰åœ¨ rooms
  const presentSet=new Set();
  rooms.forEach(r=>{ if(r.student) presentSet.add(r.student); });
  const present=presentSet.size;
  // è¯·å‡ï¼šä»Šæ—¥
  const today=formatDate(new Date());
  const todayExcuses = excuseData[today]||{};
  const excused = Object.keys(todayExcuses).length;
  const absent = Math.max(0,total - present - excused);

  setText('totalStudents', total);
  setText('presentCount', present);
  setText('absentCount', absent);
  setText('excusedCount', excused);
}
function setText(id,v){const el=document.getElementById(id);if(el)el.textContent=v;}

/* =============================
   9. å®æ—¶ç»ƒç´åŒºåŸŸ
   ============================= */
function renderPracticeArea(){
  const container=document.getElementById('practiceStatusContainer');
  if(!container) return;
  const names=Object.keys(realTimePracticeMap);
  
  if(!names.length){
    container.innerHTML=`
      <div class="practice-filters">
        <div class="practice-filter-row">
          <div class="practice-filter-group">
            <label class="practice-filter-label" data-i18n="filter.major">ä¸“ä¸šç­›é€‰</label>
            <select id="practiceMajorFilter" class="practice-filter-select" onchange="filterPracticeStatus()">
              <option value="" data-i18n="filter.all_majors">æ‰€æœ‰ä¸“ä¸š</option>
            </select>
          </div>
          <div class="practice-filter-group">
            <label class="practice-filter-label" data-i18n="filter.grade">å¹´çº§ç­›é€‰</label>
            <select id="practiceGradeFilter" class="practice-filter-select" onchange="filterPracticeStatus()">
              <option value="" data-i18n="filter.all_grades">æ‰€æœ‰å¹´çº§</option>
            </select>
          </div>
          <div class="practice-filter-group">
            <label class="practice-filter-label" data-i18n="filter.search">æœç´¢å­¦ç”Ÿ</label>
            <input type="text" id="practiceStudentSearch" class="practice-filter-input"
                   data-i18n-placeholder="filter.search_placeholder"
                   placeholder="è¾“å…¥å­¦ç”Ÿå§“å..." oninput="filterPracticeStatus()">
          </div>
        </div>
        <div class="quick-filter-tags" id="practiceQuickFilters"></div>
        
        <!-- ğŸ”¥ æ–°å¢ï¼šåœ¨ç­›é€‰å™¨å†…éƒ¨åŒ…å«ç»“æœç½‘æ ¼ -->
        <div id="practiceStudentList" class="student-grid" style="margin-top: 20px;">
          <div class="practice-empty-state" style="grid-column:1/-1;">
            <div class="practice-empty-state-icon">ğŸµ</div>
            <div class="practice-empty-state-title">${t('practice.empty.title','å½“å‰æ²¡æœ‰å­¦ç”Ÿåœ¨ç»ƒç´')}</div>
            <div class="practice-empty-state-description">${t('practice.empty.desc.weekday','ç­‰å¾…å­¦ç”Ÿå¼€å§‹ç»ƒç´')}</div>
          </div>
        </div>
      </div>
    `;
    return;
  }
  
  // æŒ‰æ—¶é•¿æ’åº
  names.sort((a,b)=>realTimePracticeMap[b].currentSec - realTimePracticeMap[a].currentSec);
  
  // ç”Ÿæˆç­›é€‰å™¨HTML
  const majors=new Set(), grades=new Set();
  names.forEach(n=>{
    const info=getStudentInfo(n);
    if(info.major) majors.add(info.major);
    if(info.grade) grades.add(info.grade);
  });
  
  let quickFiltersHtml = '';
  [...majors].sort().forEach(m=>{
    quickFiltersHtml+=`<div class="quick-filter-tag" onclick="setQuickPracticeFilter('major','${m}')">${m}</div>`;
  });
  [...grades].sort().forEach(g=>{
    quickFiltersHtml+=`<div class="quick-filter-tag" onclick="setQuickPracticeFilter('grade','${g}')">${g}</div>`;
  });
  if(majors.size||grades.size){
    quickFiltersHtml+=`<div class="quick-filter-tag" style="background:#f8d7da;color:#721c24;border-color:#f5c6cb;" onclick="clearPracticeFilters()">${t('filter.clear','æ¸…é™¤')}</div>`;
  }
  
  // ç”Ÿæˆå­¦ç”Ÿå¡ç‰‡HTML
  let studentsHtml='';
  names.forEach(n=>{
    const info=getStudentInfo(n);
    const p=realTimePracticeMap[n];
    const startTime=new Date(p.startTime).toLocaleTimeString(currentLanguage==='zh'?'zh-CN':'en-US',{hour:'2-digit',minute:'2-digit'});
    studentsHtml+=`
      <div class="practice-status-card compact" onclick="openStudentDetail('${n}')">
        <div class="practice-indicator"></div>
        <div class="compact-content">
          <div class="student-name-compact">${n}</div>
          <div class="student-info-row">
            <span class="info-item">${info.major||t('student.unknown_major','æœªçŸ¥ä¸“ä¸š')}</span>
            <span class="info-divider">â€¢</span>
            <span class="info-item">${info.grade||t('student.not_set','æœªè®¾ç½®')}</span>
          </div>
          <div class="student-info-row">
            <span class="info-item">ğŸ• ${startTime}</span>
            <span class="info-divider">â€¢</span>
            <span class="info-item">ğŸ  ${p.room}</span>
          </div>
          <div class="practice-duration-large">${formatDuration(p.currentSec)}</div>
        </div>
      </div>
    `;
  });
  
  // ğŸ”¥ ä¿®æ”¹ï¼šå°†ç­›é€‰å™¨å’Œç»“æœåˆå¹¶åœ¨ä¸€ä¸ªå®¹å™¨ä¸­
  container.innerHTML=`
    <div class="practice-filters">
      <div class="practice-filter-row">
        <div class="practice-filter-group">
          <label class="practice-filter-label" data-i18n="filter.major">ä¸“ä¸šç­›é€‰</label>
          <select id="practiceMajorFilter" class="practice-filter-select" onchange="filterPracticeStatus()">
            <option value="" data-i18n="filter.all_majors">æ‰€æœ‰ä¸“ä¸š</option>
            ${[...majors].sort().map(m=>`<option value="${m}">${m}</option>`).join('')}
          </select>
        </div>
        <div class="practice-filter-group">
          <label class="practice-filter-label" data-i18n="filter.grade">å¹´çº§ç­›é€‰</label>
          <select id="practiceGradeFilter" class="practice-filter-select" onchange="filterPracticeStatus()">
            <option value="" data-i18n="filter.all_grades">æ‰€æœ‰å¹´çº§</option>
            ${[...grades].sort().map(g=>`<option value="${g}">${g}</option>`).join('')}
          </select>
        </div>
        <div class="practice-filter-group">
          <label class="practice-filter-label" data-i18n="filter.search">æœç´¢å­¦ç”Ÿ</label>
          <input type="text" id="practiceStudentSearch" class="practice-filter-input"
                 data-i18n-placeholder="filter.search_placeholder"
                 placeholder="è¾“å…¥å­¦ç”Ÿå§“å..." oninput="filterPracticeStatus()">
        </div>
      </div>
      <div class="quick-filter-tags" id="practiceQuickFilters">
        ${quickFiltersHtml}
      </div>
      
      <!-- ğŸ”¥ æ–°å¢ï¼šåœ¨ç­›é€‰å™¨å†…éƒ¨åŒ…å«ç»“æœç½‘æ ¼ -->
      <div id="practiceStudentList" class="student-grid" style="margin-top: 20px;">
        ${studentsHtml}
      </div>
    </div>
  `;
  
  // åº”ç”¨ç­›é€‰ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
  filterPracticeStatus();
}

function formatDuration(sec){
  if(sec<=0) return t('time.no_practice','0åˆ†é’Ÿ');
  const h=Math.floor(sec/3600), m=Math.floor((sec%3600)/60), s=sec%60;
  
  if(currentLanguage === 'en') {
    // è‹±æ–‡æ ¼å¼
    if(h) return `${h}h${m?` ${m}min`:''}`;
    if(m) return `${m}min${s?` ${s}s`:''}`;
    return `${s}s`;
  } else {
    // ä¸­æ–‡æ ¼å¼
    if(h) return `${h}${t('time.hours','å°æ—¶')}${m?m+t('time.minutes','åˆ†é’Ÿ'):''}`;
    if(m) return `${m}${t('time.minutes','åˆ†é’Ÿ')}${s? s+t('time.seconds','ç§’'):''}`;
    return `${s}${t('time.seconds','ç§’')}`;
  }
}



function filterPracticeStatus(){
  const majorFilter=document.getElementById('practiceMajorFilter')?.value || '';
  const gradeFilter=document.getElementById('practiceGradeFilter')?.value || '';
  const search=document.getElementById('practiceStudentSearch')?.value.trim().toLowerCase() || '';
  const container=document.getElementById('practiceStudentList');
  
  if (!container) return;
  
  const names=Object.keys(realTimePracticeMap);
  if(!names.length) {
    container.innerHTML=`<div class="practice-empty-state" style="grid-column:1/-1;">
      <div class="practice-empty-state-icon">ğŸµ</div>
      <div class="practice-empty-state-title">${t('practice.empty.title','å½“å‰æ²¡æœ‰å­¦ç”Ÿåœ¨ç»ƒç´')}</div>
      <div class="practice-empty-state-description">${t('practice.empty.desc.weekday','ç­‰å¾…å­¦ç”Ÿå¼€å§‹ç»ƒç´')}</div>
    </div>`;
    return;
  }
  
  let filtered=names.filter(n=>{
    const info=getStudentInfo(n);
    if(majorFilter && info.major!==majorFilter) return false;
    if(gradeFilter && info.grade!==gradeFilter) return false;
    if(search && !n.toLowerCase().includes(search)) return false;
    return true;
  });
  
  if(!filtered.length){
    container.innerHTML=`<div class="practice-empty-state" style="grid-column:1/-1;">
      <div class="practice-empty-state-icon">ğŸ”</div>
      <div class="practice-empty-state-title">${t('filter.no_results','æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å­¦ç”Ÿ')}</div>
      <div class="practice-empty-state-description">${t('filter.try_different','è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶')}</div>
    </div>`;
    return;
  }
  
  // é‡ç»˜ç­›é€‰åçš„ç»“æœ
  filtered.sort((a,b)=>realTimePracticeMap[b].currentSec - realTimePracticeMap[a].currentSec);
  let html='';
  filtered.forEach(n=>{
    const info=getStudentInfo(n);
    const p=realTimePracticeMap[n];
    const startTime=new Date(p.startTime).toLocaleTimeString(currentLanguage==='zh'?'zh-CN':'en-US',{hour:'2-digit',minute:'2-digit'});
    html+=`
    <div class="practice-status-card compact" onclick="openStudentDetail('${n}')">
      <div class="practice-indicator"></div>
      <div class="compact-content">
        <div class="student-name-compact">${n}</div>
        <div class="student-info-row">
          <span>${info.major||''}</span>
          <span class="info-divider">â€¢</span>
          <span>${info.grade||''}</span>
        </div>
        <div class="student-info-row">
          <span>ğŸ• ${startTime}</span>
          <span class="info-divider">â€¢</span>
          <span>ğŸ  ${p.room}</span>
        </div>
        <div class="practice-duration-large">${formatDuration(p.currentSec)}</div>
      </div>
    </div>`;
  });
  container.innerHTML=html;
}


// è®¾ç½®å¿«é€Ÿç»ƒç´ç­›é€‰ï¼ˆåŸæœ‰çš„ï¼‰
function setQuickPracticeFilter(type, val) {
    if (type === 'major') {
        document.getElementById('practiceMajorFilter').value = val;
        document.getElementById('practiceGradeFilter').value = '';
    } else {
        document.getElementById('practiceGradeFilter').value = val;
        document.getElementById('practiceMajorFilter').value = '';
    }
    document.getElementById('practiceStudentSearch').value = '';
    filterPracticeStatus();
}

// è®¾ç½®è€ƒå‹¤ç­›é€‰ï¼ˆæ–°å¢ï¼‰
function setAttendanceFilter(status) {
    const statusSelect = document.getElementById('attendanceStatusFilter');
    const searchInput = document.getElementById('attendanceStudentSearch');
    
    if (statusSelect) statusSelect.value = status;
    if (searchInput) searchInput.value = '';
    
    filterAttendanceSnapshot();
    
    // æ›´æ–°å¿«é€Ÿç­›é€‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
    updateAttendanceQuickFilterTags(status);
}

// æ¸…é™¤è€ƒå‹¤ç­›é€‰
function clearAttendanceFilters() {
    const statusSelect = document.getElementById('attendanceStatusFilter');
    const searchInput = document.getElementById('attendanceStudentSearch');
    
    if (statusSelect) statusSelect.value = '';
    if (searchInput) searchInput.value = '';
    
    filterAttendanceSnapshot();
    
    // æ¸…é™¤å¿«é€Ÿç­›é€‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
    updateAttendanceQuickFilterTags('');
}

// æ›´æ–°å¿«é€Ÿç­›é€‰æ ‡ç­¾çŠ¶æ€
function updateAttendanceQuickFilterTags(activeStatus) {
    const tags = document.querySelectorAll('#attendanceQuickFilters .quick-filter-tag');
    tags.forEach(tag => {
        const tagText = tag.textContent.trim();
        const isActive = tagText === getStatusDisplayName(activeStatus);
        tag.classList.toggle('active', isActive);
    });
}

// è·å–çŠ¶æ€æ˜¾ç¤ºåç§°
function getStatusDisplayName(status) {
    switch(status) {
        case 'present': return 'å‡ºå‹¤';
        case 'low_efficiency': return 'ä½æ•ˆ';
        case 'absent': return 'ç¼ºå‹¤';
        case 'excused': return 'è¯·å‡';
        default: return '';
    }
}

function clearPracticeFilters(){
  document.getElementById('practiceMajorFilter').value='';
  document.getElementById('practiceGradeFilter').value='';
  document.getElementById('practiceStudentSearch').value='';
  renderPracticeArea();
}

/* =============================
   10. å­¦ç”Ÿä¿¡æ¯ä¸åˆ—è¡¨
   ============================= */
function flattenStudents(){
  const arr=[];
  Object.keys(studentDatabase).forEach(major=>{
    const list=studentDatabase[major];
    if(Array.isArray(list)){
      list.forEach(s=>{
        if(typeof s==='string') arr.push({name:s,major});
        else if(s && typeof s==='object') arr.push({name:s.name,major,grade:s.grade||''});
      });
    }
  });
  return arr;
}
function getStudentInfo(name){
  for(const [major,arr] of Object.entries(studentDatabase)){
    if(Array.isArray(arr)){
      for(const s of arr){
        if(typeof s==='string' && s===name) return {name,major,grade:''};
        if(typeof s==='object' && s.name===name) return {name,major,grade:s.grade||''};
      }
    }
  }
  return {name,major:t('student.unknown_major','æœªçŸ¥ä¸“ä¸š'),grade:''};
}
function populateFilters(){
  // majorFilter / gradeFilter / practice filters å·²æœ‰å•ç‹¬é€»è¾‘ï¼Œè¿™é‡Œåªç”¨äºå­¦ç”Ÿåˆ—è¡¨
  const majorSel=document.getElementById('majorFilter');
  const gradeSel=document.getElementById('gradeFilter');
  if(majorSel){
    const val=majorSel.value;
    majorSel.innerHTML=`<option value="">${t('filter.all_majors','æ‰€æœ‰ä¸“ä¸š')}</option>`+
      Object.keys(studentDatabase).sort().map(m=>`<option value="${m}">${m}</option>`).join('');
    if(Object.keys(studentDatabase).includes(val)) majorSel.value=val;
  }
  if(gradeSel){
    const gradeSet=new Set();
    flattenStudents().forEach(s=>{ if(s.grade) gradeSet.add(s.grade); });
    const val=gradeSel.value;
    gradeSel.innerHTML=`<option value="">${t('filter.all_grades','æ‰€æœ‰å¹´çº§')}</option>`+
      [...gradeSet].sort().map(g=>`<option value="${g}">${g}</option>`).join('');
    if(gradeSet.has(val)) gradeSel.value=val;
  }
}
function renderStudentList(){
  const container=document.getElementById('studentList');
  if(!container)return;
  const all=flattenStudents();
  if(!all.length){
    container.innerHTML=`<div class="empty-state"><div class="empty-state-icon">ğŸ“‚</div><div class="empty-state-title">${t('empty.no_students','æš‚æ— å­¦ç”Ÿæ•°æ®')}</div></div>`;
    return;
  }
  const majorFilter=document.getElementById('majorFilter').value;
  const gradeFilter=document.getElementById('gradeFilter').value;
  const statusFilter=document.getElementById('statusFilter').value;
  const kw=document.getElementById('studentSearch').value.trim().toLowerCase();

  // æ„é€ ä»Šæ—¥è¯·å‡æ˜ å°„
  const today=formatDate(new Date());
  const todayExcuses=excuseData[today]||{};
  const presentSet=new Set();
  rooms.forEach(r=>{ if(r.student) presentSet.add(r.student); });

  // ğŸ”¥ æ–°å¢ï¼šè·å–å½“å‰æ—¶é—´å’Œæ˜ŸæœŸ
  const now = new Date();
  const currentDay = now.getDay(); // 0=å‘¨æ—¥, 1=å‘¨ä¸€, ..., 6=å‘¨å…­
  const currentTimeMinutes = now.getHours() * 60 + now.getMinutes();

  let filtered=all.filter(s=>{
    if(majorFilter && s.major!==majorFilter) return false;
    if(gradeFilter && s.grade!==gradeFilter) return false;
    if(kw && !s.name.toLowerCase().includes(kw)) return false;

    // ğŸ”¥ ä¿®æ”¹ï¼šæ›´æ™ºèƒ½çš„çŠ¶æ€åˆ¤æ–­
    let stat = getStudentCurrentStatus(s.name, presentSet, todayExcuses, currentDay, currentTimeMinutes);
    
    if(statusFilter && stat!==statusFilter) return false;
    s._status=stat;
    return true;
  });

  if(!filtered.length){
    container.innerHTML=`<div class="empty-state"><div class="empty-state-icon">ğŸ”</div><div class="empty-state-title">${t('filter.no_results','æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å­¦ç”Ÿ')}</div></div>`;
    return;
  }

  filtered.sort((a,b)=>a.name.localeCompare(b.name,'zh-CN'));
  let html='';
  filtered.forEach(s=>{
    const practice=realTimePracticeMap[s.name];
    const room=practice?practice.room:t('student.not_in_room','ä¸åœ¨ç´æˆ¿');
    const duration=practice?formatDuration(practice.currentSec):t('time.no_practice','0åˆ†é’Ÿ');
    const statusClass=getStatusClass(s._status);
    const statusText=getStatusText(s._status);
    html+=`
      <div class="practice-status-card compact ${statusClass}" onclick="openStudentDetail('${s.name}')">
        ${practice?'<div class="practice-indicator"></div>':''}
        <div class="compact-content">
          <div class="student-name-compact">${s.name}</div>
          <div class="student-info-row">
            <span>${s.major||''}</span>
            <span class="info-divider">â€¢</span>
            <span>${s.grade||t('student.not_set','æœªè®¾ç½®')}</span>
          </div>
          <div class="student-info-row">
            <span>${room}</span>
          </div>
          <div class="status-duration-row">
            <div class="student-status-compact ${statusClass}">${statusText}</div>
            <div class="practice-duration-large">${duration}</div>
          </div>
        </div>
      </div>
    `;
  });
  container.innerHTML=html;
}
/**
 * è·å–å­¦ç”Ÿå½“å‰çŠ¶æ€
 * @param {string} studentName - å­¦ç”Ÿå§“å
 * @param {Set} presentSet - å½“å‰åœ¨ç´æˆ¿çš„å­¦ç”Ÿé›†åˆ
 * @param {Object} todayExcuses - ä»Šæ—¥è¯·å‡æ•°æ®
 * @param {number} currentDay - å½“å‰æ˜ŸæœŸå‡  (0-6)
 * @param {number} currentTimeMinutes - å½“å‰æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
 * @returns {string} çŠ¶æ€ï¼špresent, absent, excused, pending
 */
function getStudentCurrentStatus(studentName, presentSet, todayExcuses, currentDay, currentTimeMinutes) {
    // 1. é¦–å…ˆæ£€æŸ¥è¯·å‡
    if (todayExcuses[studentName]) {
        return 'excused';
    }
    
    // 2. æ£€æŸ¥æ˜¯å¦åœ¨ç´æˆ¿
    if (presentSet.has(studentName)) {
        return 'present';
    }
    
    // 3. è·å–å­¦ç”Ÿä»Šæ—¥æ—¶é—´æ®µ
    const dayMap = {1: 'monday', 2: 'tuesday', 3: 'wednesday', 4: 'thursday', 5: 'friday'};
    const dayKey = dayMap[currentDay];
    
    // å‘¨æœ«æˆ–æ²¡æœ‰æ—¶é—´æ®µå®‰æ’
    if (!dayKey || !studentTimeSlots[studentName] || !studentTimeSlots[studentName][dayKey]) {
        return 'pending'; // å¾…è€ƒå‹¤ï¼ˆéç»ƒç´æ—¶é—´ï¼‰
    }
    
    const todaySlots = studentTimeSlots[studentName][dayKey];
    if (!todaySlots || todaySlots.length === 0) {
        return 'pending'; // ä»Šæ—¥æ— å®‰æ’
    }
    
    // 4. æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦åœ¨ä»»ä½•æ—¶é—´æ®µå†…
    const isInTimeSlot = todaySlots.some(slot => {
        const startMinutes = timeToMinutes(slot.start);
        const endMinutes = timeToMinutes(slot.end);
        return currentTimeMinutes >= startMinutes && currentTimeMinutes < endMinutes;
    });
    
    if (isInTimeSlot) {
        // åœ¨æ—¶é—´æ®µå†…ä½†ä¸åœ¨ç´æˆ¿ = ç¼ºå‹¤
        return 'absent';
    } else {
        // ä¸åœ¨æ—¶é—´æ®µå†… = å¾…è€ƒå‹¤
        return 'pending';
    }
}

/**
 * è·å–çŠ¶æ€å¯¹åº”çš„CSSç±»å
 */
function getStatusClass(status) {
    switch(status) {
        case 'present': return 'present';
        case 'absent': return 'absent';
        case 'excused': return 'excused';
        case 'pending': return 'pending';
        default: return 'pending';
    }
}

/**
 * è·å–çŠ¶æ€æ˜¾ç¤ºæ–‡æœ¬
 */
function getStatusText(status) {
    switch(status) {
        case 'present': return t('status.present', 'å‡ºå‹¤');
        case 'absent': return t('status.absent', 'ç¼ºå‹¤');
        case 'excused': return t('status.excused', 'è¯·å‡');
        case 'pending': return t('status.pending', 'å¾…è€ƒå‹¤');
        default: return t('status.pending', 'å¾…è€ƒå‹¤');
    }
}

/* =============================
   11. è¯·å‡é¢æ¿
   ============================= */
function renderExcusePanel(){
  const today=formatDate(new Date());
  const data=excuseData[today]||{};
  const keys=Object.keys(data);
  const panel=document.getElementById('excuseInfoPanel');
  const box=document.getElementById('excuseInfoContainer');
  if(!keys.length){
    panel.style.display='none';return;
  }
  panel.style.display='block';
  let html='<div class="student-grid">';
  keys.forEach(name=>{
    const ex=data[name];
    html+=`
      <div class="student-card excused" style="min-height:180px;">
        <div class="student-header">
          <div class="student-name">${name}</div>
          <div class="student-status excused">${t('status.excused','è¯·å‡')}</div>
        </div>
        <div class="student-details">
          <div class="detail-item">
            <div class="detail-label">${t('excuse.reason','è¯·å‡åŸå› ')}</div>
            <div class="detail-value">${ex.reason||t('excuse.not_filled','æœªå¡«å†™')}</div>
          </div>
          ${ex.durationText?`<div class="detail-item">
            <div class="detail-label">${t('excuse.duration_text','è¯·å‡æ—¶é•¿')}</div>
            <div class="detail-value">${ex.durationText}</div>
          </div>`:''}
          ${ex.endDate?`<div class="detail-item">
            <div class="detail-label">${t('excuse.end_date','ç»“æŸæ—¥æœŸ')}</div>
            <div class="detail-value">${ex.endDate}</div>
          </div>`:''}
        </div>
      </div>`;
  });
  html+='</div>';
  box.innerHTML=html;
}

/* =============================
   12. è€ƒå‹¤å¿«ç…§ï¼ˆattendanceRecordsï¼‰
   ============================= */
function loadAttendanceData(){
  const date=document.getElementById('dateSelect').value;
  if(!date) return;
  renderAttendanceSnapshot(date,true);
  if(isOnline){
    // æŒ‰éœ€åŠ è½½ï¼ˆå¦‚æœä¸æ˜¯å·²ç›‘å¬çš„ä»Šå¤©ï¼‰
    if(!attendanceRecordsCache[date] || date!==formatDate(new Date())){
      database.ref(`attendanceRecords/${date}`).once('value').then(snap=>{
        attendanceRecordsCache[date]=snap.val()||null;
        renderAttendanceSnapshot(date);
      }).catch(e=>{
        addSyncLog('âŒ åŠ è½½è€ƒå‹¤è®°å½•å¤±è´¥ '+e.message);
        renderAttendanceSnapshot(date);
      });
    }
  }
}
function renderAttendanceFilters(){
  const filtersHtml=`
    <div class="practice-filters">
      <div class="practice-filter-row">
        <div class="practice-filter-group">
          <label class="practice-filter-label">${t('filter.status', 'çŠ¶æ€ç­›é€‰')}</label>
          <select id="attendanceStatusFilter" class="practice-filter-select" onchange="filterAttendanceSnapshot()">
            <option value="">${t('filter.all_status', 'æ‰€æœ‰çŠ¶æ€')}</option>
            <option value="present">${t('status.present', 'å‡ºå‹¤')}</option>
            <option value="low_efficiency">${t('status.low_efficiency', 'ä½æ•ˆ')}</option>
            <option value="absent">${t('status.absent', 'ç¼ºå‹¤')}</option>
            <option value="excused">${t('status.excused', 'è¯·å‡')}</option>
          </select>
        </div>
        <div class="practice-filter-group">
          <label class="practice-filter-label">${t('filter.search', 'å­¦ç”Ÿæœç´¢')}</label>
          <input type="text" id="attendanceStudentSearch" class="practice-filter-input"
                 placeholder="${t('filter.search_placeholder', 'è¾“å…¥å­¦ç”Ÿå§“å...')}" oninput="debouncedFilterAttendanceSnapshot()">
        </div>
      </div>
      <div class="quick-filter-tags" id="attendanceQuickFilters">
        <div class="quick-filter-tag" onclick="setAttendanceFilter('present')">${t('status.present', 'å‡ºå‹¤')}</div>
        <div class="quick-filter-tag" onclick="setAttendanceFilter('low_efficiency')">${t('status.low_efficiency', 'ä½æ•ˆ')}</div>
        <div class="quick-filter-tag" onclick="setAttendanceFilter('absent')">${t('status.absent', 'ç¼ºå‹¤')}</div>
        <div class="quick-filter-tag" onclick="setAttendanceFilter('excused')">${t('status.excused', 'è¯·å‡')}</div>
        <div class="quick-filter-tag" style="background:#f8d7da;color:#721c24;border-color:#f5c6cb;" onclick="clearAttendanceFilters()">${t('filter.clear', 'æ¸…é™¤')}</div>
      </div>
      
      <div id="attendanceSnapshotGrid" class="student-grid" style="margin-top: 20px;"></div>
    </div>
  `;
  return filtersHtml;
}


function filterAttendanceSnapshot() {
    if (!window.attendanceSnapshotData) return;
    
    const statusFilter = document.getElementById('attendanceStatusFilter')?.value || '';
    const searchText = document.getElementById('attendanceStudentSearch')?.value.trim().toLowerCase() || '';
    
    let filtered = window.attendanceSnapshotData.filter(s => {
        // çŠ¶æ€ç­›é€‰
        if (statusFilter && s.finalAttendanceStatus !== statusFilter) {
            return false;
        }
        
        // å§“åæœç´¢
        if (searchText && !s.name.toLowerCase().includes(searchText)) {
            return false;
        }
        
        return true;
    });
    
    const grid = document.getElementById('attendanceSnapshotGrid');
    if (!grid) return;
    
    if (filtered.length === 0) {
        grid.innerHTML = `
            <div class="empty-state" style="grid-column: 1 / -1;">
                <div class="empty-state-icon">ğŸ”</div>
                <div class="empty-state-title">${t('filter.no_results', 'æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•')}</div>
                <div class="empty-state-description">${t('filter.try_different', 'è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶')}</div>
            </div>
        `;
        return;
    }
    
    grid.innerHTML = renderAttendanceCards(filtered);
    
    // æ›´æ–°å¿«é€Ÿç­›é€‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
    updateAttendanceQuickFilterTags(statusFilter);
}

// è®¾ç½®è€ƒå‹¤ç­›é€‰
function setAttendanceFilter(status) {
    const statusSelect = document.getElementById('attendanceStatusFilter');
    const searchInput = document.getElementById('attendanceStudentSearch');
    
    if (statusSelect) statusSelect.value = status;
    if (searchInput) searchInput.value = '';
    
    filterAttendanceSnapshot();
}

// æ¸…é™¤è€ƒå‹¤ç­›é€‰
function clearAttendanceFilters() {
    const statusSelect = document.getElementById('attendanceStatusFilter');
    const searchInput = document.getElementById('attendanceStudentSearch');
    
    if (statusSelect) statusSelect.value = '';
    if (searchInput) searchInput.value = '';
    
    filterAttendanceSnapshot();
}

// æ›´æ–°å¿«é€Ÿç­›é€‰æ ‡ç­¾çŠ¶æ€
function updateAttendanceQuickFilterTags(activeStatus) {
    const tags = document.querySelectorAll('#attendanceQuickFilters .quick-filter-tag');
    tags.forEach(tag => {
        const isActive = tag.textContent.trim() === getStatusDisplayName(activeStatus);
        tag.classList.toggle('active', isActive);
    });
}

function getStatusDisplayName(status) {
    switch(status) {
        case 'present': return t('status.present', 'å‡ºå‹¤');
        case 'low_efficiency': return t('status.low_efficiency', 'ä½æ•ˆ');
        case 'absent': return t('status.absent', 'ç¼ºå‹¤');
        case 'excused': return t('status.excused', 'è¯·å‡');
        default: return '';
    }
}

function renderAttendanceSnapshot(date, loading = false) {
    const box = document.getElementById('todaySnapshot');
    if (!box) return;
    
    if (loading) {
        box.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">' + t('msg.loading', 'åŠ è½½ä¸­...') + '</div></div>';
        return;
    }
    
    const rec = attendanceRecordsCache[date];
    if (!rec) {
        box.innerHTML = `
            ${renderAttendanceFilters()}
            <div class="empty-state" style="margin-top: 20px;">
                <div class="empty-state-icon">ğŸ“„</div>
                <div class="empty-state-title">${t('msg.no_data', 'æš‚æ— æ•°æ®')}</div>
                <div class="empty-state-description">${date} ${t('empty.no_attendance', 'è¿˜æ²¡æœ‰è€ƒå‹¤è®°å½•')}</div>
            </div>
        `;
        return;
    }
    
    // ç»“æ„å‡è®¾ï¼šrec.students / rec.endedSlots ï¼ˆæ¥è‡ªç´æˆ¿ç³»ç»ŸåŒæ­¥ï¼‰
    const list = [...(rec.students || []), ...(rec.endedSlots || [])];
    if (!list.length) {
        box.innerHTML = `
            ${renderAttendanceFilters()}
            <div class="empty-state" style="margin-top: 20px;">
                <div class="empty-state-icon">ğŸ“„</div>
                <div class="empty-state-title">${t('msg.no_data', 'æš‚æ— æ•°æ®')}</div>
            </div>
        `;
        return;
    }
    
    // ğŸ”¥ æ–°å¢ï¼šä¿å­˜å½“å‰ç­›é€‰çŠ¶æ€
    const currentStatusFilter = document.getElementById('attendanceStatusFilter')?.value || '';
    const currentSearchText = document.getElementById('attendanceStudentSearch')?.value || '';
    
    // å­˜å‚¨åŸå§‹æ•°æ®ç”¨äºç­›é€‰
    window.attendanceSnapshotData = list;
    
    // æ¸²æŸ“ç­›é€‰å™¨ï¼ˆå†…éƒ¨å·²åŒ…å«ç½‘æ ¼å®¹å™¨ï¼‰
    box.innerHTML = renderAttendanceFilters();
    
    // ğŸ”¥ æ–°å¢ï¼šæ¢å¤ç­›é€‰çŠ¶æ€
    if (currentStatusFilter) {
        const statusSelect = document.getElementById('attendanceStatusFilter');
        if (statusSelect) statusSelect.value = currentStatusFilter;
    }
    if (currentSearchText) {
        const searchInput = document.getElementById('attendanceStudentSearch');
        if (searchInput) searchInput.value = currentSearchText;
    }
    
    // æ¸²æŸ“åˆå§‹æ•°æ®åˆ°ç½‘æ ¼ä¸­
    const grid = document.getElementById('attendanceSnapshotGrid');
    if (grid) {
        grid.innerHTML = renderAttendanceCards(list);
    }
    
    // åº”ç”¨ç­›é€‰æ¡ä»¶ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
    if (currentStatusFilter || currentSearchText) {
        filterAttendanceSnapshot();
    }
}


// æ¸²æŸ“è€ƒå‹¤å¡ç‰‡çš„ç‹¬ç«‹å‡½æ•°
function renderAttendanceCards(list) {
    return list.sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')).map(s => {
        // æ ¹æ®è€ƒå‹¤çŠ¶æ€å†³å®šæ˜¾ç¤ºçš„ç´æˆ¿ä¿¡æ¯
        let roomDisplay = s.room || t('student.not_in_room', 'ä¸åœ¨ç´æˆ¿');
        
        // å¦‚æœæ˜¯ç¼ºå‹¤çŠ¶æ€ï¼Œä¸åº”è¯¥æ˜¾ç¤ºå…·ä½“ç´æˆ¿
        if (s.finalAttendanceStatus === 'absent') {
            roomDisplay = t('student.not_in_room', 'ä¸åœ¨ç´æˆ¿');
        } else if (s.finalAttendanceStatus === 'excused') {
            roomDisplay = t('status.excused', 'è¯·å‡');
        }
        
        return `
            <div class="student-card ${getStatusClassSimple(s.finalAttendanceStatus)}" style="min-height:160px;">
                <div class="student-header">
                    <div class="student-name">${s.name}</div>
                    <div class="student-status ${getStatusClassSimple(s.finalAttendanceStatus)}">${statusTextSimple(s.finalAttendanceStatus)}</div>
                </div>
                <div class="student-details">
                    <div class="detail-item">
                        <div class="detail-label">${t('student.time_slot', 'æ—¶é—´æ®µ')}</div>
                        <div class="detail-value">${s.start || '--'} - ${s.end || '--'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">${t('student.practice_duration', 'ç»ƒç´æ—¶é•¿')}</div>
                        <div class="detail-value">${s.practicedText || '0'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">${t('student.room', 'æ‰€åœ¨ç´æˆ¿')}</div>
                        <div class="detail-value">${roomDisplay}</div>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function getStatusClassSimple(stat){
  if(stat==='present')return 'present';
  if(stat==='excused')return 'excused';
  if(stat==='absent')return 'absent';
  if(stat==='low_efficiency')return 'low-efficiency';
  return 'pending';
}
function statusTextSimple(stat) {
    if (stat === 'present') return t('status.present', 'å‡ºå‹¤');
    if (stat === 'excused') return t('status.excused', 'è¯·å‡');
    if (stat === 'absent') return t('status.absent', 'ç¼ºå‹¤');
    if (stat === 'low_efficiency') return t('status.low_efficiency', 'ä½æ•ˆ');
    return t('status.pending', 'å¾…è€ƒå‹¤');
}


// =============== ç»ƒç´è®°å½•ç³»ç»Ÿï¼ˆæ—¶æ®µå†… / æ—¶æ®µå¤–ï¼‰ ===============
function getTodayDateString(){
  const d=new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}
function toDateKey(x){
  if(!x) return null;
  if(/^\d{4}-\d{2}-\d{2}$/.test(x)) return x;
  const d=new Date(x);
  if(isNaN(d)) return null;
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}
function timeToMinutes(t){
  const [H,M]=t.split(':').map(Number);
  return H*60+M;
}
function getStudentTodaySlots(name){
  const wd=new Date().getDay();
  const MAP={1:'monday',2:'tuesday',3:'wednesday',4:'thursday',5:'friday'};
  const key=MAP[wd];
  if(!key || !studentTimeSlots[name]) return [];
  return studentTimeSlots[name][key]||[];
}
function findCurrentTimeSlot(slots,ts){
  const d=new Date(ts);
  const m=d.getHours()*60+d.getMinutes();
  return slots.find(s=>{
    const sm=timeToMinutes(s.start);
    const em=timeToMinutes(s.end);
    return m>=sm && m<em;
  })||null;
}
function startPracticeSession(student,room,registerTime){
  const sid=`${student}__${room}__${registerTime}`;
  if(practiceSessionTracker.has(sid)) return practiceSessionTracker.get(sid);
  const now=Date.now();
  const slots=getStudentTodaySlots(student);
  const currentSlot=findCurrentTimeSlot(slots,now);
  const sess={
    sessionId:sid,
    studentName:student,
    roomName:room,
    startTime:registerTime,
    prepEndTime:registerTime+60000,
    actualStartTime:null,
    endTime:null,
    inSlotTime:0,
    outSlotTime:0,
    currentSlot,
    slotTransitions:[],
    isActive:true
  };
  practiceSessionTracker.set(sid,sess);
  return sess;
}
function updatePracticeSessions(){
  const now=Date.now();
  practiceSessionTracker.forEach((sess,sid)=>{
    if(!sess.isActive) return;
    const still=rooms.find(r=>r.student===sess.studentName && r.name===sess.roomName && r.registerTime===sess.startTime);
    if(!still){
      endPracticeSession(sid,now,'æ¶ˆå¤±');
      return;
    }
    if(now<sess.prepEndTime) return;
    if(!sess.actualStartTime) sess.actualStartTime=sess.prepEndTime;
    const slots=getStudentTodaySlots(sess.studentName);
    const curSlot=findCurrentTimeSlot(slots,now);
    if(JSON.stringify(curSlot)!==JSON.stringify(sess.currentSlot)){
      sess.slotTransitions.push({time:now,from:sess.currentSlot,to:curSlot});
      sess.currentSlot=curSlot;
    }
    let inc=60;
    if(sess._lastTick){
      const dt=Math.floor((now-sess._lastTick)/1000);
      if(dt>=10 && dt<=120) inc=dt;
    }
    sess._lastTick=now;
    if(sess.currentSlot) sess.inSlotTime+=inc;
    else sess.outSlotTime+=inc;
  });
}
function endPracticeSession(sid,endTime,reason='ç»“æŸ'){
  const sess=practiceSessionTracker.get(sid);
  if(!sess || !sess.isActive) return;
  sess.isActive=false;
  sess.endTime=endTime;
  if(endTime<sess.prepEndTime){
    practiceSessionTracker.delete(sid);
    return;
  }
  if(!sess.actualStartTime) sess.actualStartTime=sess.prepEndTime;
  recalcSessionTimes(sess);
  recordDailyPractice(sess);
  sess.endReason=reason;
  practiceSessionTracker.delete(sid);
}
function recalcSessionTimes(sess){
  if(!sess.actualStartTime||!sess.endTime) return;
  const startMin=Math.floor(sess.actualStartTime/60000)*60000;
  const endMin=Math.floor(sess.endTime/60000)*60000;
  const slots=getStudentTodaySlots(sess.studentName);
  let inSlot=0,outSlot=0;
  for(let t=startMin;t<endMin;t+=60000){
    const slot=findCurrentTimeSlot(slots,t);
    if(slot) inSlot+=60; else outSlot+=60;
  }
  sess.inSlotTime=inSlot;
  sess.outSlotTime=outSlot;
}
function recordDailyPractice(sess){
  const dk=toDateKey(new Date(sess.startTime))||getTodayDateString();
  if(!dailyPracticeRecords[dk]) dailyPracticeRecords[dk]={};
  if(!dailyPracticeRecords[dk][sess.studentName]){
    dailyPracticeRecords[dk][sess.studentName]={inSlot:0,outSlot:0,totalSessions:0,sessions:[],lastUpdated:Date.now()};
  }
  const rec=dailyPracticeRecords[dk][sess.studentName];
  rec.inSlot+=sess.inSlotTime;
  rec.outSlot+=sess.outSlotTime;
  rec.totalSessions++;
  rec.lastUpdated=Date.now();
  rec.sessions.push({
    room:sess.roomName,
    start:sess.startTime,
    end:sess.endTime,
    inSlot:sess.inSlotTime,
    outSlot:sess.outSlotTime,
    endReason:sess.endReason||'æ­£å¸¸'
  });
  try{
    localStorage.setItem('practiceRecords_'+dk,JSON.stringify(dailyPracticeRecords[dk]));
  }catch(e){}
}
function getStudentPracticeRecord(name,dk){
  if(!dk) dk=getTodayDateString();
  if(!dailyPracticeRecords[dk]){
    const raw=localStorage.getItem('practiceRecords_'+dk);
    if(raw){
      try{dailyPracticeRecords[dk]=JSON.parse(raw);}catch(e){}
    }
  }
  return dailyPracticeRecords[dk]?.[name]||{inSlot:0,outSlot:0,totalSessions:0,sessions:[],lastUpdated:0};
}
function estimateLiveSessionInOut(sess){
  if(!sess.isActive) return null;
  const now=Date.now();
  if(now<sess.prepEndTime) return {tempIn:0,tempOut:0};
  const baseIn=sess.inSlotTime;
  const baseOut=sess.outSlotTime;
  let extra=0;
  if(sess._lastTick){
    const dt=Math.floor((now-sess._lastTick)/1000);
    if(dt>0 && dt<900) extra=dt;
  }
  const curSlot=findCurrentTimeSlot(getStudentTodaySlots(sess.studentName),now);
  if(curSlot) return {tempIn:baseIn+extra,tempOut:baseOut};
  return {tempIn:baseIn,tempOut:baseOut+extra};
}
function getStudentPracticeStats(name,days=7){
  const stats={totalDays:0,totalInSlot:0,totalOutSlot:0,totalSessions:0,dailyDetails:[]};
  const today=new Date();
  for(let i=0;i<days;i++){
    const d=new Date(today.getTime()-i*86400000);
    const dk=toDateKey(d);
    const rec=getStudentPracticeRecord(name,dk);
    if(rec.totalSessions>0){
      stats.totalDays++;
      stats.totalInSlot+=rec.inSlot;
      stats.totalOutSlot+=rec.outSlot;
      stats.totalSessions+=rec.totalSessions;
    }
    stats.dailyDetails.push({date:dk,inSlot:rec.inSlot,outSlot:rec.outSlot,sessions:rec.totalSessions});
  }
  return stats;
}
function calculateDailyTotalDuration(name){
  const rec=getStudentPracticeRecord(name,getTodayDateString());
  let total=rec.inSlot+rec.outSlot;
  for(const [sid,sess] of practiceSessionTracker.entries()){
    if(sess.studentName===name && sess.isActive){
      const live=estimateLiveSessionInOut(sess);
      if(live){
        total += live.tempIn + live.tempOut - (sess.inSlotTime + sess.outSlotTime);
      }
    }
  }
  return total;
}
function formatDailyTotalDuration(name){
  return formatDuration(calculateDailyTotalDuration(name));
}

/* =============================
   13. å­¦ç”Ÿè¯¦æƒ…
   ============================= */
function openStudentDetail(name){
    const info = getStudentInfo(name);
    const practice = realTimePracticeMap[name];
    const today = formatDate(new Date());
    const excuse = (excuseData[today] || {})[name];

    // ğŸ”¥ æ–°å¢ï¼šæ™ºèƒ½çŠ¶æ€åˆ¤æ–­
    const now = new Date();
    const currentDay = now.getDay();
    const currentTimeMinutes = now.getHours() * 60 + now.getMinutes();
    const presentSet = new Set();
    rooms.forEach(r => { if(r.student) presentSet.add(r.student); });
    const todayExcuses = excuseData[today] || {};
    
    const currentStatus = getStudentCurrentStatus(name, presentSet, todayExcuses, currentDay, currentTimeMinutes);

    // è¿‘7å¤©è€ƒå‹¤ - æŒ‰ä»ä»Šå¤©åˆ°7å¤©å‰çš„é¡ºåº
    const todayDate = new Date();
    const history = [];
    for (let i = 0; i < 7; i++) {
        const date = new Date(todayDate.getFullYear(), todayDate.getMonth(), todayDate.getDate() - i);
        const dateStr = formatDate(date);
        const rec = attendanceRecordsCache[dateStr];
        let status = 'no-data';
        if (rec) {
            const found = [ ...(rec.students||[]), ...(rec.endedSlots||[]) ].find(s=>s.name===name);
            if (found) status = found.finalAttendanceStatus || 'no-data';
        }
        history.push({ date: dateStr, status });
    }

    // ç»ƒç´ç»Ÿè®¡ - åªç”¨äºç”Ÿæˆæ˜ç»†è¡¨æ ¼
    const pStats = getStudentPracticeStats(name,7);
    const todayRec = getStudentPracticeRecord(name,getTodayDateString());
    let liveIn = 0, liveOut = 0;
    
    // å¦‚æœå­¦ç”Ÿå½“å‰æ­£åœ¨ç»ƒç´ï¼Œè®¡ç®—å®æ—¶ç´¯ç§¯æ—¶é—´
    if (practice) {
        // è·å–å­¦ç”Ÿä»Šæ—¥æ—¶é—´æ®µ
        const slots = getStudentTodaySlots(name);
        const now = Date.now();
        const startTime = practice.startTime;
        
        // è®¡ç®—ä»å¼€å§‹åˆ°ç°åœ¨çš„æ€»æ—¶é•¿ï¼ˆç§’ï¼‰
        const totalSeconds = Math.floor((now - startTime) / 1000);
        
        // æŒ‰åˆ†é’Ÿè®¡ç®—æ—¶æ®µå†…å¤–æ—¶é—´
        let inSlotSeconds = 0;
        let outSlotSeconds = 0;
        
        // ä»å¼€å§‹æ—¶é—´æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦åœ¨æ—¶é—´æ®µå†…
        for (let t = startTime; t < now; t += 60000) {
            const currentSlot = findCurrentTimeSlot(slots, t);
            if (currentSlot) {
                inSlotSeconds += 60;
            } else {
                outSlotSeconds += 60;
            }
        }
        
        // åŠ ä¸Šå†å²è®°å½•
        liveIn = todayRec.inSlot + inSlotSeconds;
        liveOut = todayRec.outSlot + outSlotSeconds;
    } else {
        // ä¸åœ¨ç»ƒç´æ—¶åªæ˜¾ç¤ºå†å²è®°å½•
        liveIn = todayRec.inSlot;
        liveOut = todayRec.outSlot;
    }
    
    const todayInMin   = Math.floor(liveIn / 60);
    const todayOutMin  = Math.floor(liveOut / 60);
    const todayTotalMin = todayInMin + todayOutMin;

    const practiceRows = pStats.dailyDetails
        .sort((a,b)=>b.date.localeCompare(a.date))
        .map(d=>{
            let inM  = Math.floor(d.inSlot/60);
            let outM = Math.floor(d.outSlot/60);
            let sessions = d.sessions;
            
            // å¦‚æœæ˜¯ä»Šå¤©ä¸”å­¦ç”Ÿæ­£åœ¨ç»ƒç´ï¼ŒåŠ ä¸Šå®æ—¶æ•°æ®
            if (d.date === getTodayDateString() && practice) {
                const slots = getStudentTodaySlots(name);
                const now = Date.now();
                const startTime = practice.startTime;
                
                // è®¡ç®—å®æ—¶æ—¶æ®µå†…å¤–æ—¶é—´
                let realtimeInSeconds = 0;
                let realtimeOutSeconds = 0;
                
                for (let t = startTime; t < now; t += 60000) {
                    const currentSlot = findCurrentTimeSlot(slots, t);
                    if (currentSlot) {
                        realtimeInSeconds += 60;
                    } else {
                        realtimeOutSeconds += 60;
                    }
                }
                
                inM = Math.floor((d.inSlot + realtimeInSeconds) / 60);
                outM = Math.floor((d.outSlot + realtimeOutSeconds) / 60);
                sessions = d.sessions + 1; // å½“å‰ä¼šè¯ç®—ä½œä¸€æ¬¡
            }
            
            // ä»Šå¤©çš„è¡Œæ·»åŠ ç‰¹æ®Šæ ·å¼
            const isToday = d.date === getTodayDateString();
            const rowClass = isToday ? ' class="today-row"' : '';
            const dateDisplay = isToday ? `${d.date} <small style="color:#007bff;">(ä»Šå¤©)</small>` : d.date;
            
            return `<tr${rowClass}>
                <td class="date-cell">${dateDisplay}</td>
                <td>${inM}</td>
                <td>${outM}</td>
                <td class="total-duration-cell">${inM+outM}</td>
            </tr>`;
        }).join('') || `<tr><td colspan="4" style="text-align:center;color:#999;">æ— è®°å½•</td></tr>`;

    const modal   = document.getElementById('studentDetailModal');
    if (!modal) return;
    document.getElementById('studentDetailTitle').textContent = name + ' - ' + t('student.detail.title','å­¦ç”Ÿè¯¦æƒ…');
    const content = document.getElementById('studentDetailContent');

    // ğŸ”¥ ä¿®æ”¹ï¼šä½¿ç”¨æ™ºèƒ½çŠ¶æ€åˆ¤æ–­çš„ç»“æœ
    const statusNow = getStatusText(currentStatus);

    const duration  = practice ? formatDuration(practice.currentSec) : t('time.no_practice','0åˆ†é’Ÿ');
    const startTime = practice
        ? new Date(practice.startTime).toLocaleTimeString(
            currentLanguage==='zh'?'zh-CN':'en-US',
            {hour:'2-digit',minute:'2-digit'}
        )
        : t('student.not_started','æœªå¼€å§‹');

    let historyHtml = '';
    history.forEach((h, index)=>{
        const cls = getStatusClassSimple(h.status);
        const day = index + 1; // 1æ˜¯ä»Šå¤©ï¼Œ2æ˜¯æ˜¨å¤©ï¼Œä»¥æ­¤ç±»æ¨
        historyHtml += `<div class="history-day ${cls}" onclick="showDayAttendanceDetail('${name}', '${h.date}', ${day})" title="ç‚¹å‡»æŸ¥çœ‹${h.date}è¯¦æƒ…">${day}</div>`;
    });

    // ğŸ”¥ æ–°å¢ï¼šæ ¹æ®å½“å‰çŠ¶æ€æ˜¾ç¤ºæ—¶é—´æ®µä¿¡æ¯
    let timeSlotInfo = '';
    if (currentStatus !== 'excused') {
        const dayMap = {1: 'monday', 2: 'tuesday', 3: 'wednesday', 4: 'thursday', 5: 'friday'};
        const dayKey = dayMap[currentDay];
        
        if (dayKey && studentTimeSlots[name] && studentTimeSlots[name][dayKey]) {
            const todaySlots = studentTimeSlots[name][dayKey];
                        if (todaySlots && todaySlots.length > 0) {
                const slotsHtml = todaySlots.map(slot => {
                    const startMinutes = timeToMinutes(slot.start);
                    const endMinutes = timeToMinutes(slot.end);
                    const isCurrent = currentTimeMinutes >= startMinutes && currentTimeMinutes < endMinutes;
                    const currentClass = isCurrent ? ' current' : '';
                    const statusIcon = isCurrent ? 'ğŸµ ' : '';
                    return `<span class="time-slot-tag${currentClass}">${statusIcon}${slot.start}-${slot.end}</span>`;
                }).join('');
                
                timeSlotInfo = `
                    <div class="metric-item time-slots-container">
                        <div class="metric-icon">ğŸ“…</div>
                        <div class="metric-content">
                            <div class="metric-label">è€ƒå‹¤æ—¶é—´æ®µ</div>
                            <div class="metric-value time-slots-wrapper">${slotsHtml}</div>
                        </div>
                    </div>
                `;

            } else {
                timeSlotInfo = `
                    <div class="metric-item">
                        <div class="metric-icon">ğŸ“…</div>
                        <div class="metric-content">
                            <div class="metric-label">ä»Šæ—¥æ—¶é—´æ®µ</div>
                            <div class="metric-value">æ— å®‰æ’</div>
                        </div>
                    </div>
                `;
            }
        } else {
            const dayNames = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            timeSlotInfo = `
                <div class="metric-item">
                    <div class="metric-icon">ğŸ“…</div>
                    <div class="metric-content">
                        <div class="metric-label">è€ƒå‹¤æ—¶é—´æ®µ</div>
                        <div class="metric-value">${dayNames[currentDay]} æ— å®‰æ’</div>
                    </div>
                </div>
            `;
        }
    }

    content.innerHTML = `
        <div class="student-detail-content">
            <div class="student-profile-card">
                <h2 class="profile-name">${name}</h2>
                <div class="profile-meta">
                    <span>${info.major||''}</span><span class="meta-divider">â€¢</span>
                    <span>${info.grade||t('student.not_set','æœªè®¾ç½®')}</span>
                </div>
            </div>

            <div class="today-status-card ${getStatusClass(currentStatus)}">
                <div class="status-header">
                    <h3 class="status-title">${t('student.today_attendance','ä»Šæ—¥è€ƒå‹¤')}</h3>
                    <div class="status-badge ${getStatusClass(currentStatus)}">${statusNow}</div>
                </div>
                <div class="status-metrics">
                    ${timeSlotInfo}
                    <div class="metric-item practice-status-container">
                        <div class="metric-icon">ğŸµ</div>
                        <div class="metric-content">
                            <div class="metric-label">ç»ƒç´çŠ¶æ€</div>
                            <div class="metric-value practice-status-compact">
                                <div class="practice-info-row">
                                    <span class="practice-info-item">
                                        <span class="practice-label">å¼€å§‹æ—¶é—´:</span>
                                        <strong class="practice-value">${startTime}</strong>
                                    </span>
                                </div>
                                <div class="practice-info-row">
                                    <span class="practice-info-item">
                                        <span class="practice-label">ç´æˆ¿:</span>
                                        <strong class="practice-value">${practice?practice.room:t('student.not_in_room','ä¸åœ¨ç´æˆ¿')}</strong>
                                    </span>
                                </div>
                                <div class="practice-info-row">
                                    <span class="practice-info-item">
                                        <span class="practice-label">å½“å‰ç»ƒä¹ :</span>
                                        <strong class="practice-value current-practice">${duration}</strong>
                                    </span>
                                </div>
                                <div class="practice-info-row">
                                    <span class="practice-info-item">
                                        <span class="practice-label">ä»Šæ—¥æ€»è®¡:</span>
                                        <strong class="practice-value total-practice">${todayTotalMin} åˆ†é’Ÿ</strong>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                ${excuse?`
                <div class="excuse-info">
                    <div class="excuse-header">
                        <i class="excuse-icon">ğŸ“</i><span class="excuse-title">${t('excuse.reason','è¯·å‡åŸå› ')}</span>
                    </div>
                    <div class="excuse-content">
                        <p class="excuse-reason">${excuse.reason||''}</p>
                        ${excuse.durationText?`<p class="excuse-approver">${t('excuse.duration_text','è¯·å‡æ—¶é•¿')}: ${excuse.durationText}</p>`:''}
                        ${excuse.endDate?`<p class="excuse-approver">${t('excuse.end_date','ç»“æŸæ—¥æœŸ')}: ${excuse.endDate}</p>`:''}
                    </div>
                </div>`:''}
            </div>

            <div class="card attendance-history">
                <div class="history-title">${t('attendance.history','æœ€è¿‘7å¤©è€ƒå‹¤')}</div>
                <div class="history-timeline">${historyHtml}</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">ğŸ—“ï¸ æœ€è¿‘7å¤©ç»ƒç´æ˜ç»†</h4>
                    <p style="font-size:0.75rem;color:var(--medium-gray);margin:8px 0 0 0;line-height:1.3;">
                        æ®µå†…=è§„å®šç»ƒç´æ—¶æ®µï¼Œæ®µå¤–=éè§„å®šç»ƒç´æ—¶æ®µï¼Œæ—¶é•¿å•ä½ï¼šåˆ†é’Ÿ
                    </p>
                </div>
                <div class="data-table-container" style="max-height:230px;overflow-y:auto;">
                    <table class="data-table">
                        <thead>
                            <tr><th>${t('report.date', 'æ—¥æœŸ')}</th><th>${t('practice.in_slot', 'æ®µå†…')}</th><th>${t('practice.out_slot', 'æ®µå¤–')}</th><th>${t('report.total', 'æ€»è®¡')}</th></tr>
                        </thead>
                        <tbody>${practiceRows}</tbody>
                    </table>
                </div>
            </div>
        </div>
    `;

    // ---- å…³é”®æ˜¾ç¤ºé€»è¾‘ä¿®å¤ï¼šç¡®ä¿äºŒæ¬¡æ‰“å¼€å¯è§ ----
    // å…ˆæ¸…é™¤å¯èƒ½æ®‹ç•™çš„ inline éšè—
    modal.style.display = 'flex';
    // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
    document.body.classList.add('modal-open');
    
    // è‹¥éœ€è¦æ·¡å…¥åŠ¨ç”»ï¼Œä½¿ç”¨ä¸‹ä¸€å¸§å†åŠ ç±»
    if (!modal.classList.contains('show')) {
        requestAnimationFrame(()=> modal.classList.add('show'));
    }
}

/**
 * è·å–å¤©æ•°æè¿°
 * @param {number} dayNumber - å¤©æ•°ï¼ˆ1-7ï¼‰
 * @returns {string} æè¿°æ–‡æœ¬
 */
function getDayDescription(dayNumber) {
    if (currentLanguage === 'en') {
        const descriptions = {
            1: 'Today',
            2: 'Yesterday', 
            3: '2 days ago',
            4: '3 days ago',
            5: '4 days ago',
            6: '5 days ago',
            7: '6 days ago'
        };
        return descriptions[dayNumber] || `${dayNumber-1} days ago`;
    } else {
        const descriptions = {
            1: 'ä»Šå¤©',
            2: 'æ˜¨å¤©', 
            3: 'å‰å¤©',
            4: 'ç¬¬4å¤©å‰',
            5: 'ç¬¬5å¤©å‰',
            6: 'ç¬¬6å¤©å‰',
            7: 'ç¬¬7å¤©å‰'
        };
        return descriptions[dayNumber] || `ç¬¬${dayNumber}å¤©`;
    }
}


/**
 * æ˜¾ç¤ºæŸå¤©çš„è€ƒå‹¤è¯¦æƒ…
 * @param {string} studentName - å­¦ç”Ÿå§“å
 * @param {string} date - æ—¥æœŸ YYYY-MM-DD
 * @param {number} dayNumber - æ˜¾ç¤ºçš„å¤©æ•°ï¼ˆ1-7ï¼‰
 */
function showDayAttendanceDetail(studentName, date, dayNumber) {
    // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…å…³é—­æ¨¡æ€æ¡†
    event.stopPropagation();
    
    // è·å–è¯¥æ—¥æœŸçš„è€ƒå‹¤è®°å½•
    const rec = attendanceRecordsCache[date];
    const today = formatDate(new Date());
    const todayExcuses = excuseData[date] || {};
    
    let detailInfo = {
        present: 0,
        absent: 0,
        excused: 0,
        lowEfficiency: 0,
        details: []
    };
    
    if (rec) {
        // ä»è€ƒå‹¤è®°å½•ä¸­æŸ¥æ‰¾è¯¥å­¦ç”Ÿ
        const allRecords = [...(rec.students || []), ...(rec.endedSlots || [])];
        const studentRecords = allRecords.filter(s => s.name === studentName);
        
        studentRecords.forEach(record => {
            const status = record.finalAttendanceStatus;
            const timeSlot = `${record.start || '--'} - ${record.end || '--'}`;
            const practiceTime = record.practicedText || '0åˆ†é’Ÿ';
            
            // æ ¹æ®çŠ¶æ€å†³å®šç´æˆ¿æ˜¾ç¤º
            let roomDisplay = record.room || 'å¾…è€ƒå‹¤';
            if (status === 'absent') {
                roomDisplay = 'ä¸åœ¨ç´æˆ¿';
            } else if (status === 'excused') {
                roomDisplay = 'è¯·å‡';
            }
            
            switch(status) {
                case 'present':
                    detailInfo.present++;
                    break;
                case 'absent':
                    detailInfo.absent++;
                    break;
                case 'excused':
                    detailInfo.excused++;
                    break;
                case 'low_efficiency':
                    detailInfo.lowEfficiency++;
                    break;
            }
            
            detailInfo.details.push({
                timeSlot,
                status,
                practiceTime,
                room: roomDisplay,
                statusText: getStatusText(status)
            });
        });
    }
    
    // æ£€æŸ¥è¯·å‡ä¿¡æ¯
    if (todayExcuses[studentName]) {
        detailInfo.excused++;
        detailInfo.details.push({
            timeSlot: 'å…¨å¤©',
            status: 'excused',
            practiceTime: 'è¯·å‡',
            room: 'è¯·å‡',
            statusText: 'è¯·å‡',
            excuseReason: todayExcuses[studentName].reason || 'æœªå¡«å†™åŸå› '
        });
    }
    
    // å¦‚æœæ²¡æœ‰ä»»ä½•è®°å½•ï¼Œé»˜è®¤ä¸ºç¼ºå‹¤
    if (detailInfo.details.length === 0) {
        detailInfo.absent = 1;
        detailInfo.details.push({
            timeSlot: 'æ— è®°å½•',
            status: 'absent',
            practiceTime: '0åˆ†é’Ÿ',
            room: 'ä¸åœ¨ç´æˆ¿',
            statusText: 'ç¼ºå‹¤'
        });
    }
    
    // æ˜¾ç¤ºè¯¦æƒ…å¼¹çª—
    showAttendanceDetailModal(studentName, date, dayNumber, detailInfo);
}


/**
 * è·å–çŠ¶æ€æ–‡æœ¬
 */
function getStatusText(status) {
    switch(status) {
        case 'present': return t('status.present', 'å‡ºå‹¤');
        case 'absent': return t('status.absent', 'ç¼ºå‹¤');
        case 'excused': return t('status.excused', 'è¯·å‡');
        case 'low_efficiency': return t('status.low_efficiency', 'ä½æ•ˆ');
        default: return t('status.unknown', 'å¾…è€ƒå‹¤');
    }
}

/**
 * æ˜¾ç¤ºè€ƒå‹¤è¯¦æƒ…æ¨¡æ€æ¡† - è°ƒæ•´é—´è·
 */
function showAttendanceDetailModal(studentName, date, dayNumber, detailInfo) {
    // åˆ›å»ºæ¨¡æ€æ¡†å†…å®¹ - è°ƒæ•´é—´è·
    const modalContent = `
        <div class="modal-header">
            <h3 class="modal-title">${studentName} - ${getDayDescription(dayNumber)}${t('attendance.detail.suffix', 'è€ƒå‹¤è¯¦æƒ…')}</h3>
            <button class="modal-close" onclick="closeAttendanceDetailModal()">&times;</button>
        </div>
        <div style="padding: 25px 20px 20px 20px;">
            <div class="card" style="margin-bottom: 25px;">
                <h4 style="margin-bottom: 20px;">ğŸ“… ${date} ${t('attendance.summary', 'è€ƒå‹¤æ±‡æ€»')}</h4>
                <div class="stats-grid-detailed" style="grid-template-columns: repeat(4, 1fr); gap: 12px;">
                    <div class="stat-item present">
                        <div class="stat-icon">âœ…</div>
                        <div class="stat-content">
                            <div class="stat-number">${detailInfo.present}</div>
                            <div class="stat-label">${t('stats.present', 'å‡ºå‹¤')}</div>
                        </div>
                    </div>
                    <div class="stat-item absent">
                        <div class="stat-icon">âŒ</div>
                        <div class="stat-content">
                            <div class="stat-number">${detailInfo.absent}</div>
                            <div class="stat-label">${t('stats.absent', 'ç¼ºå‹¤')}</div>
                        </div>
                    </div>
                    <div class="stat-item" style="background: linear-gradient(135deg, #ffeaa7, #fdcb6e);">
                        <div class="stat-icon">âš ï¸</div>
                        <div class="stat-content">
                            <div class="stat-number">${detailInfo.lowEfficiency}</div>
                            <div class="stat-label">${t('status.low_efficiency', 'ä½æ•ˆ')}</div>
                        </div>
                    </div>
                    <div class="stat-item excused">
                        <div class="stat-icon">ğŸ“</div>
                        <div class="stat-content">
                            <div class="stat-number">${detailInfo.excused}</div>
                            <div class="stat-label">${t('stats.excused', 'è¯·å‡')}</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h4 style="margin-bottom: 20px;">ğŸ“‹ ${t('attendance.detailed_records', 'è¯¦ç»†è®°å½•')}</h4>
                <div class="data-table-container" style="max-height: 300px; overflow-y: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>${t('student.time_slot', 'æ—¶é—´æ®µ')}</th>
                                <th>${t('filter.status', 'çŠ¶æ€')}</th>
                                <th>${t('student.practice_duration', 'ç»ƒç´æ—¶é•¿')}</th>
                                <th>${t('student.room', 'ç´æˆ¿')}</th>
                                ${detailInfo.details.some(d => d.excuseReason) ? `<th>${t('attendance.remarks', 'å¤‡æ³¨')}</th>` : ''}
                            </tr>
                        </thead>
                        <tbody>
                            ${detailInfo.details.map(detail => `
                                <tr>
                                    <td>${detail.timeSlot}</td>
                                    <td><span class="table-status-badge ${getStatusClassSimple(detail.status)}">${detail.statusText}</span></td>
                                    <td>${detail.practiceTime}</td>
                                    <td>${detail.room}</td>
                                    ${detail.excuseReason ? `<td>${detail.excuseReason}</td>` : (detailInfo.details.some(d => d.excuseReason) ? '<td>-</td>' : '')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `;
    
    // å…¶ä½™ä»£ç ä¿æŒä¸å˜...
    let detailModal = document.getElementById('attendanceDetailModal');
    if (!detailModal) {
        detailModal = document.createElement('div');
        detailModal.id = 'attendanceDetailModal';
        detailModal.className = 'modal';
        detailModal.innerHTML = `<div class="modal-content" style="max-width: 800px;"></div>`;
        document.body.appendChild(detailModal);
    }
    
    detailModal.classList.remove('hiding');
    detailModal.querySelector('.modal-content').innerHTML = modalContent;
    detailModal.style.display = 'flex';
    
    // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
    document.body.classList.add('modal-open');
    
    requestAnimationFrame(() => {
        detailModal.classList.add('show');
    });
}

/**
 * å…³é—­è€ƒå‹¤è¯¦æƒ…æ¨¡æ€æ¡† - ç®€å•æ¸éšåŠ¨ç”»
 */
function closeAttendanceDetailModal() {
    const modal = document.getElementById('attendanceDetailModal');
    if (modal && modal.classList.contains('show')) {
        // ç›´æ¥è®¾ç½®é€æ˜åº¦ä¸º0ï¼Œè§¦å‘æ¸éšåŠ¨ç”»
        modal.style.opacity = '0';
        modal.classList.remove('show');
        
        // æ¢å¤èƒŒæ™¯æ»šåŠ¨
        document.body.classList.remove('modal-open');
        
        // ç­‰å¾…æ¸éšåŠ¨ç”»å®Œæˆåéšè—
        setTimeout(() => {
            modal.style.display = 'none';
            modal.style.opacity = '1'; // é‡ç½®é€æ˜åº¦ï¼Œä¸ºä¸‹æ¬¡æ˜¾ç¤ºåšå‡†å¤‡
        }, 300);
    }
}




/* =============================
   14. æŠ¥å‘Šï¼ˆåŸºäº attendanceRecordsCacheï¼‰
   ============================= */
function generateReport(){
  const start=document.getElementById('startDate').value;
  const end=document.getElementById('endDate').value;
  if(!start||!end){
    alert(t('msg.select_dates','è¯·é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸ'));
    return;
  }
  if(new Date(start)>new Date(end)){
    alert(t('msg.date_range_error','å¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸ'));
    return;
  }
  const content=document.getElementById('reportContent');
  content.innerHTML='<div class="loading"><div class="spinner"></div></div>';
  // æŒ‰éœ€åŠ è½½æ—¥æœŸèŒƒå›´å†…çš„è®°å½•
  loadAttendanceRange(start,end).then(()=> {
    const data=collectReportData(start,end);
    content.innerHTML=renderReportHTML(data,start,end);
  }).catch(e=>{
    content.innerHTML=`<div class="empty-state"><div class="empty-state-icon">âš ï¸</div><div class="empty-state-title">${t('empty.load_failed','åŠ è½½å¤±è´¥')}</div><div class="empty-state-description">${e.message}</div></div>`;
  });
}
function loadAttendanceRange(start,end){
  if(!isOnline) return Promise.resolve();
  const dates=getDateSpan(start,end);
  const tasks=[];
  dates.forEach(d=>{
    if(!attendanceRecordsCache[d]){
      tasks.push(database.ref(`attendanceRecords/${d}`).once('value').then(snap=>{
        attendanceRecordsCache[d]=snap.val()||null;
      }));
    }
  });
  return Promise.all(tasks);
}
function getDateSpan(start,end){
  const res=[];
  let d=new Date(start);
  const ed=new Date(end);
  while(d<=ed){
    res.push(formatDate(d));
    d.setDate(d.getDate()+1);
  }
  return res;
}
function collectReportData(start,end){
  const dates=getDateSpan(start,end);
  const daily=[];
  const studentAgg=new Map();
  dates.forEach(date=>{
    const rec=attendanceRecordsCache[date];
    if(!rec){
      daily.push({date,total:0,present:0,absent:0,excused:0,rate:0});
      return;
    }
    const all=[...(rec.students||[]),...(rec.endedSlots||[])];
    let present=0,excused=0,absent=0,total=all.length;
    all.forEach(s=>{
      const stat=s.finalAttendanceStatus;
      if(stat==='present') present++;
      else if(stat==='excused') excused++;
      else if(stat==='absent') absent++;
      // èšåˆå­¦ç”Ÿ
      if(!studentAgg.has(s.name)){
        studentAgg.set(s.name,{name:s.name,major:s.major||'',present:0,excused:0,absent:0,total:0});
      }
      const ag=studentAgg.get(s.name);
      ag.total++;
      if(stat==='present') ag.present++;
      else if(stat==='excused') ag.excused++;
      else if(stat==='absent') ag.absent++;
    });
    const eff=total>0?((present+excused)/total*100).toFixed(1):0;
    daily.push({date,total,present,absent,excused,rate:eff});
  });
  const students=[...studentAgg.values()].map(s=>{
    s.rate=s.total>0?((s.present+s.excused)/s.total*100).toFixed(1):'0.0';
    return s;
  }).sort((a,b)=>b.rate - a.rate);
  return {daily,students};
}
function renderReportHTML(data,start,end){
  return `
    <div class="card">
      <h4>${t('report.analysis_title','ğŸ“Š è€ƒå‹¤åˆ†ææŠ¥å‘Š')}</h4>
      <div class="student-details">
        <div class="detail-item">
          <div class="detail-label">${t('report.period','ç»Ÿè®¡å‘¨æœŸ')}</div>
          <div class="detail-value">${start} ${t('report.to','è‡³')} ${end} (${data.daily.length}${t('report.days','å¤©')})</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">${t('report.participants','å‚ä¸å­¦ç”Ÿ')}</div>
          <div class="detail-value">${data.students.length}${t('report.people','äºº')}</div>
        </div>
      </div>
    </div>
    <div class="card">
      <h4>${t('report.daily_trend','ğŸ“ˆ æ¯æ—¥è€ƒå‹¤è¶‹åŠ¿')}</h4>
      <div class="data-table-container" style="max-height:300px;overflow-y:auto;">
        <table class="data-table daily-trend">
          <thead><tr>
            <th>${t('report.date','æ—¥æœŸ')}</th>
            <th>${t('report.total','åˆè®¡')}</th>
            <th>${t('stats.present','å‡ºå‹¤')}</th>
            <th>${t('stats.absent','ç¼ºå‹¤')}</th>
            <th>${t('stats.excused','è¯·å‡')}</th>
            <th>${t('attendance.rate','å‡ºå‹¤ç‡')}</th>
          </tr></thead>
          <tbody>
            ${data.daily.map(d=>`<tr>
              <td>${d.date}</td>
              <td>${d.total}</td>
              <td>${d.present}</td>
              <td>${d.absent}</td>
              <td>${d.excused}</td>
              <td>${d.rate}%</td>
            </tr>`).join('')}
          </tbody>
        </table>
      </div>
    </div>
    <div class="card">
      <h4>${t('report.student_stats','ğŸ‘¥ å­¦ç”Ÿè€ƒå‹¤ç»Ÿè®¡')}</h4>
      <div class="data-table-container" style="max-height:400px;overflow-y:auto;">
        <table class="data-table student-stats">
          <thead><tr>
            <th>${t('student.name','å§“å')}</th>
            <th>${t('student.major','ä¸“ä¸š')}</th>
            <th>${t('stats.present','å‡ºå‹¤')}</th>
            <th>${t('stats.absent','ç¼ºå‹¤')}</th>
            <th>${t('stats.excused','è¯·å‡')}</th>
            <th>${t('attendance.rate','å‡ºå‹¤ç‡')}</th>
          </tr></thead>
          <tbody>
            ${data.students.map(s=>`<tr>
              <td>${s.name}</td>
              <td>${s.major}</td>
              <td>${s.present}</td>
              <td>${s.absent}</td>
              <td>${s.excused}</td>
              <td>${s.rate}%</td>
            </tr>`).join('')}
          </tbody>
        </table>
      </div>
      <div class="export-options">
        <button class="btn btn-primary" onclick="generateReport()"><span>ğŸ”„</span>${t('report.regenerate','é‡æ–°ç”Ÿæˆ')}</button>
      </div>
    </div>
  `;
}


/* =============================
   15. åŒæ­¥ & ç¼“å­˜
   ============================= */
function forceSync(){
  if(!isOnline){
    alert(t('msg.sync_required','éœ€è¦ç½‘ç»œè¿æ¥æ‰èƒ½åŒæ­¥æ•°æ®'));
    return;
  }
  addSyncLog('ğŸ”„ '+t('sync.force_sync','å¼ºåˆ¶åŒæ­¥'));
  loadAllCoreData(true);
}
function loadAllCoreData(force=false){
  if(!database) return;
  const today=formatDate(new Date());
  const tasks=[];
  tasks.push(database.ref('rooms').once('value').then(s=>{ if(Array.isArray(s.val())){rooms=s.val();buildRealTimePracticeFromRooms();}}));
  tasks.push(database.ref('studentDatabase').once('value').then(s=>{ if(s.val()) studentDatabase=s.val();}));
  tasks.push(database.ref('excuseData').once('value').then(s=>{ if(s.val()) excuseData=s.val(); }));
  tasks.push(database.ref(`attendanceRecords/${today}`).once('value').then(s=>{ attendanceRecordsCache[today]=s.val()||null; }));
  Promise.all(tasks).then(()=>{
    addSyncLog('âœ… æ ¸å¿ƒæ•°æ®åŠ è½½å®Œæˆ');
    updateStatsPanel();
    renderPracticeArea();
    renderExcusePanel();
    renderAttendanceSnapshot(today);
    if(currentTab==='students') renderStudentList();
  }).catch(e=>{
    addSyncLog('âŒ åŠ è½½å¤±è´¥ '+e.message);
  });
}
function clearLocalCache(){
  if(!confirm(t('msg.clear_cache_confirm','ç¡®å®šè¦æ¸…é™¤æœ¬åœ°ç¼“å­˜å—ï¼Ÿ'))) return;
  Object.keys(localStorage).forEach(k=>{
    if(k.startsWith('attendance_')||k==='studentData'||k==='excuseData') localStorage.removeItem(k);
  });
  addSyncLog('ğŸ—‘ï¸ '+t('msg.cache_cleared','æœ¬åœ°ç¼“å­˜å·²æ¸…é™¤'));
  alert(t('msg.cache_cleared','æœ¬åœ°ç¼“å­˜å·²æ¸…é™¤'));
}

/* =============================
   16. Tab åˆ‡æ¢
   ============================= */
function switchTab(tab){
  currentTab=tab;
  document.querySelectorAll('.nav-tab').forEach(b=>b.classList.toggle('active', b.getAttribute('onclick').includes(tab)));
  document.querySelectorAll('.tab-content').forEach(div=>div.style.display='none');
  document.getElementById(tab+'Tab').style.display='block';
  
  if(tab==='dashboard'){
    updateStatsPanel();
    renderPracticeArea();
    renderExcusePanel();
    // ğŸ”¥ ä¿®æ”¹ï¼šåªåœ¨å¿…è¦æ—¶é‡æ–°åŠ è½½è€ƒå‹¤æ•°æ®
    const currentDate = document.getElementById('dateSelect').value;
    if (currentDate && attendanceRecordsCache[currentDate] !== undefined) {
      // å¦‚æœå·²æœ‰æ•°æ®ï¼Œç›´æ¥æ¸²æŸ“
      renderAttendanceSnapshot(currentDate);
    } else {
      // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ‰é‡æ–°åŠ è½½
      loadAttendanceData();
    }
  }else if(tab==='students'){
    renderStudentList();
  }
}


/* =============================
   17. å…¶å®ƒè¾…åŠ©
   ============================= */
function refreshCurrentTabContent(){
  if(currentTab==='dashboard'){
    updateStatsPanel();
    renderPracticeArea();
    renderExcusePanel();
    // ğŸ”¥ ä¿®æ”¹ï¼šé¿å…ä¸å¿…è¦çš„é‡æ–°åŠ è½½
    const currentDate = document.getElementById('dateSelect').value;
    if (currentDate && window.attendanceSnapshotData) {
      // å¦‚æœå·²æœ‰æ•°æ®ï¼Œç›´æ¥é‡æ–°æ¸²æŸ“
      renderAttendanceSnapshot(currentDate);
    }
  }else if(currentTab==='students'){
    renderStudentList();
  }
}
// ğŸ”¥ æ–°å¢ï¼šé˜²æŠ–å‡½æ•°
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// ğŸ”¥ æ–°å¢ï¼šé˜²æŠ–ç‰ˆæœ¬çš„ç­›é€‰å‡½æ•°
const debouncedFilterAttendanceSnapshot = debounce(filterAttendanceSnapshot, 300);

// ä¿®æ”¹HTMLä¸­çš„è°ƒç”¨
// å°† oninput="filterAttendanceSnapshot()" æ”¹ä¸º oninput="debouncedFilterAttendanceSnapshot()"

/* æš´éœ²å¿…è¦å‡½æ•°åˆ°å…¨å±€ï¼ˆHTML å†…è”è°ƒç”¨ï¼‰ */
window.switchLanguage=switchLanguage;
window.switchTab=switchTab;
window.filterPracticeStatus=filterPracticeStatus;
window.clearPracticeFilters=clearPracticeFilters;
window.openStudentDetail=openStudentDetail;
window.closeModal=closeModal;
window.generateReport=generateReport;
window.loadAttendanceData=loadAttendanceData;
window.forceSync=forceSync;
window.clearLocalCache=clearLocalCache;
window.filterStudents=renderStudentList;
window.showDayAttendanceDetail = showDayAttendanceDetail;
window.closeAttendanceDetailModal = closeAttendanceDetailModal;
// åœ¨æ–‡ä»¶æœ«å°¾çš„å…¨å±€å‡½æ•°æš´éœ²éƒ¨åˆ†æ·»åŠ 
window.filterAttendanceSnapshot = filterAttendanceSnapshot;
window.setAttendanceFilter = setAttendanceFilter;
window.clearAttendanceFilters = clearAttendanceFilters;
window.updateAttendanceQuickFilterTags = updateAttendanceQuickFilterTags;
window.renderAttendanceCards = renderAttendanceCards;
// åœ¨æ–‡ä»¶æœ«å°¾çš„å…¨å±€å‡½æ•°æš´éœ²éƒ¨åˆ†æ·»åŠ 
window.debouncedFilterAttendanceSnapshot = debounce(filterAttendanceSnapshot, 300);


/* =============================
   18. å®šæ—¶åˆ·æ–°ï¼ˆç»ƒç´æ—¶é•¿æ¯ 30s æ›´æ–° UIï¼‰
   ============================= */
setInterval(()=>{
  // æ›´æ–° duration
  const now=Date.now();
  Object.keys(realTimePracticeMap).forEach(n=>{
    const p=realTimePracticeMap[n];
    p.currentSec=Math.floor((now-p.startTime)/1000);
  });
  if(currentTab==='dashboard') renderPracticeArea();
  if(currentTab==='students') renderStudentList();
},30000);
// æ¯ 10 ç§’æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ 1 åˆ†é’Ÿè¾¹ç•Œï¼Œåšä¸€æ¬¡ä¼šè¯ç´¯ç§¯
setInterval(()=>{
  const now=Date.now();
  if(now - lastPracticeSessionSweep >= PRACTICE_UPDATE_INTERVAL_MS - 500){
    updatePracticeSessions();
    lastPracticeSessionSweep=now;
  }
},10000);


</script>
</body>
</html>
